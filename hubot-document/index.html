<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222"><link rel="manifest" href="/images/site.webmanifest"><meta name="google-site-verification" content="k5HBUjLU81xJuWb8xJnZv0UgiQblDBrNU3i_164wuTI"><meta name="msvalidate.01" content="B8100FBA99CDE591E1C042A3608C96E9"><meta name="yandex-verification" content="d950e9c7ce2375f9"><meta name="baidu-site-verification" content="7CEDnF5GIr"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"blog.xyang.xin","root":"/","images":"/images","scheme":"Mist","version":"8.7.1","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script><meta name="description" content="Hubot å®˜æ–¹æ–‡æ¡£åŸæ–‡é“¾æ¥ğŸ”— æ¦‚è§ˆHubot èµ·æ­¥æ‚¨éœ€è¦node.jså’Œnpmã€‚å®‰è£…å®ƒä»¬åï¼Œæˆ‘ä»¬å°±å¯ä»¥å®‰è£… hubot ç”Ÿæˆå™¨ï¼š 1$ npm install -g yo generator-hubot  è¿™æ¡å‘½ä»¤å°†ç»™æˆ‘ä»¬å¸¦æ¥hubot yeomanç”Ÿæˆå™¨ã€‚ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªçš„æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨é‡Œé¢ç”Ÿæˆä¸€ä¸ªæ–°çš„hubotå®ä¾‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åˆ¶é€ ä¸€ä¸ªå« myhubotçš„æœºå™¨äººï¼š 123$ m"><meta property="og:type" content="article"><meta property="og:title" content="Hubot å®˜æ–¹æ–‡æ¡£ï¼ˆè¯‘ï¼‰"><meta property="og:url" content="http://blog.xyang.xin/hubot-document/index.html"><meta property="og:site_name" content="éŸ¶ å…‰"><meta property="og:description" content="Hubot å®˜æ–¹æ–‡æ¡£åŸæ–‡é“¾æ¥ğŸ”— æ¦‚è§ˆHubot èµ·æ­¥æ‚¨éœ€è¦node.jså’Œnpmã€‚å®‰è£…å®ƒä»¬åï¼Œæˆ‘ä»¬å°±å¯ä»¥å®‰è£… hubot ç”Ÿæˆå™¨ï¼š 1$ npm install -g yo generator-hubot  è¿™æ¡å‘½ä»¤å°†ç»™æˆ‘ä»¬å¸¦æ¥hubot yeomanç”Ÿæˆå™¨ã€‚ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªçš„æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨é‡Œé¢ç”Ÿæˆä¸€ä¸ªæ–°çš„hubotå®ä¾‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åˆ¶é€ ä¸€ä¸ªå« myhubotçš„æœºå™¨äººï¼š 123$ m"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://images.xyang.xin/2021%2F09%2F01%2Fhubot-avatar.png"><meta property="article:published_time" content="2021-09-02T20:27:46.000Z"><meta property="article:modified_time" content="2021-09-07T09:34:51.569Z"><meta property="article:author" content="æ¨æ¬£é›¨"><meta property="article:tag" content="hubot"><meta property="article:tag" content="chatops"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://images.xyang.xin/2021%2F09%2F01%2Fhubot-avatar.png"><link rel="canonical" href="http://blog.xyang.xin/hubot-document/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://blog.xyang.xin/hubot-document/","path":"hubot-document/","title":"Hubot å®˜æ–¹æ–‡æ¡£ï¼ˆè¯‘ï¼‰"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Hubot å®˜æ–¹æ–‡æ¡£ï¼ˆè¯‘ï¼‰ | éŸ¶ å…‰</title><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><link rel="alternate" href="/atom.xml" title="éŸ¶ å…‰" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">éŸ¶ å…‰</h1><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Yang Xinyu's Personal Blog</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-ä¿¡æ¯æŠ€æœ¯"><a href="/categories/%E4%BF%A1%E6%81%AF%E6%8A%80%E6%9C%AF/" rel="section"><i class="fa fa-bolt fa-fw"></i>ä¿¡æ¯æŠ€æœ¯</a></li><li class="menu-item menu-item-æ€æƒ³æ–‡åŒ–"><a href="/categories/%E6%80%9D%E6%83%B3%E6%96%87%E5%8C%96/" rel="section"><i class="fa fa-bookmark fa-fw"></i>æ€æƒ³æ–‡åŒ–</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> æœç´¢</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="æœç´¢..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">æ–‡ç« ç›®å½•</li><li class="sidebar-nav-overview">ç«™ç‚¹æ¦‚è§ˆ</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Hubot-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3"><span class="nav-number">1.</span> <span class="nav-text">Hubot å®˜æ–¹æ–‡æ¡£</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E8%A7%88"><span class="nav-number">1.1.</span> <span class="nav-text">æ¦‚è§ˆ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Hubot-%E8%B5%B7%E6%AD%A5"><span class="nav-number">1.1.1.</span> <span class="nav-text">Hubot èµ·æ­¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC"><span class="nav-number">1.1.2.</span> <span class="nav-text">è„šæœ¬</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%82%E9%85%8D%E5%99%A8"><span class="nav-number">1.1.3.</span> <span class="nav-text">é€‚é…å™¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2"><span class="nav-number">1.1.4.</span> <span class="nav-text">éƒ¨ç½²</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.1.5.</span> <span class="nav-text">æ¨¡å¼</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC-1"><span class="nav-number">1.2.</span> <span class="nav-text">è„šæœ¬</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC%E5%89%96%E6%9E%90"><span class="nav-number">1.2.1.</span> <span class="nav-text">è„šæœ¬å‰–æ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%81%86%E5%90%AC%E5%92%8C%E5%93%8D%E5%BA%94"><span class="nav-number">1.2.2.</span> <span class="nav-text">è†å¬å’Œå“åº”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%91%E9%80%81%E5%92%8C%E5%9B%9E%E5%A4%8D"><span class="nav-number">1.2.3.</span> <span class="nav-text">å‘é€å’Œå›å¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%99%E6%88%BF%E9%97%B4%E6%88%96%E7%94%A8%E6%88%B7%E7%9A%84%E6%B6%88%E6%81%AF"><span class="nav-number">1.2.4.</span> <span class="nav-text">ç»™æˆ¿é—´æˆ–ç”¨æˆ·çš„æ¶ˆæ¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8D%95%E8%8E%B7%E6%95%B0%E6%8D%AE"><span class="nav-number">1.2.5.</span> <span class="nav-text">æ•è·æ•°æ®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E7%94%A8-HTTP"><span class="nav-number">1.2.6.</span> <span class="nav-text">è°ƒç”¨ HTTP</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#JSON"><span class="nav-number">1.2.6.1.</span> <span class="nav-text">JSON</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#XML"><span class="nav-number">1.2.6.2.</span> <span class="nav-text">XML</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%90%A4%E5%B9%95%E6%8A%93%E5%8F%96"><span class="nav-number">1.2.6.3.</span> <span class="nav-text">è¤å¹•æŠ“å–</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7-HTTP-%E5%92%8C-HTTPS-%E8%AE%BE%E7%BD%AE"><span class="nav-number">1.2.6.4.</span> <span class="nav-text">é«˜çº§ HTTP å’Œ HTTPS è®¾ç½®</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9A%8F%E6%9C%BA"><span class="nav-number">1.2.7.</span> <span class="nav-text">éšæœº</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E9%A2%98"><span class="nav-number">1.2.8.</span> <span class="nav-text">ä¸»é¢˜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A0%E5%85%A5%E5%92%8C%E7%A6%BB%E5%BC%80"><span class="nav-number">1.2.9.</span> <span class="nav-text">åŠ å…¥å’Œç¦»å¼€</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%91%E5%90%AC%E5%99%A8"><span class="nav-number">1.2.10.</span> <span class="nav-text">è‡ªå®šä¹‰ç›‘å¬å™¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-number">1.2.11.</span> <span class="nav-text">ç¯å¢ƒå˜é‡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96"><span class="nav-number">1.2.12.</span> <span class="nav-text">ä¾èµ–</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B6%85%E6%97%B6%E5%92%8C%E9%97%B4%E9%9A%94"><span class="nav-number">1.2.13.</span> <span class="nav-text">è¶…æ—¶å’Œé—´éš”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP-%E7%9B%91%E5%90%AC%E5%99%A8"><span class="nav-number">1.2.14.</span> <span class="nav-text">HTTP ç›‘å¬å™¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6"><span class="nav-number">1.2.15.</span> <span class="nav-text">äº‹ä»¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="nav-number">1.2.16.</span> <span class="nav-text">é”™è¯¯å¤„ç†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC%E6%96%87%E6%A1%A3"><span class="nav-number">1.2.17.</span> <span class="nav-text">è„šæœ¬æ–‡æ¡£</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96"><span class="nav-number">1.2.18.</span> <span class="nav-text">æŒä¹…åŒ–</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC%E5%8A%A0%E8%BD%BD"><span class="nav-number">1.2.19.</span> <span class="nav-text">è„šæœ¬åŠ è½½</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E4%BA%AB%E8%84%9A%E6%9C%AC"><span class="nav-number">1.2.20.</span> <span class="nav-text">åˆ†äº«è„šæœ¬</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E8%84%9A%E6%9C%AC%E6%98%AF%E5%90%A6%E5%B7%B2%E5%AD%98%E5%9C%A8"><span class="nav-number">1.2.20.1.</span> <span class="nav-text">æŸ¥çœ‹è„šæœ¬æ˜¯å¦å·²å­˜åœ¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E8%84%9A%E6%9C%AC%E7%A8%8B%E5%BA%8F%E5%8C%85"><span class="nav-number">1.2.20.2.</span> <span class="nav-text">åˆ›å»ºä¸€ä¸ªè„šæœ¬ç¨‹åºåŒ…</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%91%E5%90%AC%E5%99%A8%E5%85%83%E6%95%B0%E6%8D%AE"><span class="nav-number">1.2.21.</span> <span class="nav-text">ç›‘å¬å™¨å…ƒæ•°æ®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">1.2.22.</span> <span class="nav-text">ä¸­é—´ä»¶</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B%E5%92%8C-API"><span class="nav-number">1.2.22.1.</span> <span class="nav-text">æ‰§è¡Œè¿‡ç¨‹å’Œ API</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86-1"><span class="nav-number">1.2.22.2.</span> <span class="nav-text">é”™è¯¯å¤„ç†</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Listener-%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">1.2.23.</span> <span class="nav-text">Listener ä¸­é—´ä»¶</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Listener-%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%A4%BA%E4%BE%8B"><span class="nav-number">1.2.23.1.</span> <span class="nav-text">Listener ä¸­é—´ä»¶ç¤ºä¾‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Listener-%E4%B8%AD%E9%97%B4%E4%BB%B6-API"><span class="nav-number">1.2.23.2.</span> <span class="nav-text">Listener ä¸­é—´ä»¶ API</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Receive-%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">1.2.24.</span> <span class="nav-text">Receive ä¸­é—´ä»¶</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Receive-%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%A4%BA%E4%BE%8B"><span class="nav-number">1.2.24.1.</span> <span class="nav-text">Receive ä¸­é—´ä»¶ç¤ºä¾‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Receive-%E4%B8%AD%E9%97%B4%E4%BB%B6-API"><span class="nav-number">1.2.24.2.</span> <span class="nav-text">Receive ä¸­é—´ä»¶ API</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Response-%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">1.2.25.</span> <span class="nav-text">Response ä¸­é—´ä»¶</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Response-%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%A4%BA%E4%BE%8B"><span class="nav-number">1.2.25.1.</span> <span class="nav-text">Response ä¸­é—´ä»¶ç¤ºä¾‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Response-%E4%B8%AD%E9%97%B4%E4%BB%B6-API"><span class="nav-number">1.2.25.2.</span> <span class="nav-text">Response ä¸­é—´ä»¶ API</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95-hubot-%E8%84%9A%E6%9C%AC"><span class="nav-number">1.2.26.</span> <span class="nav-text">æµ‹è¯• hubot è„šæœ¬</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E5%BC%8F-1"><span class="nav-number">1.3.</span> <span class="nav-text">æ¨¡å¼</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E5%91%BD%E5%90%8Dhubot%E5%AE%9E%E4%BE%8B"><span class="nav-number">1.3.1.</span> <span class="nav-text">é‡å‘½åhubotå®ä¾‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%83%E7%94%A8%E6%88%96%E9%87%8D%E5%91%BD%E5%90%8D%E7%9B%91%E5%90%AC%E5%99%A8"><span class="nav-number">1.3.2.</span> <span class="nav-text">å¼ƒç”¨æˆ–é‡å‘½åç›‘å¬å™¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E4%BB%A3%E7%90%86%E8%BD%AC%E5%8F%91%E6%89%80%E6%9C%89-HTTP-%E8%AF%B7%E6%B1%82"><span class="nav-number">1.3.3.</span> <span class="nav-text">é€šè¿‡ä»£ç†è½¬å‘æ‰€æœ‰ HTTP è¯·æ±‚</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B6%88%E6%81%AF%E7%9A%84%E5%8A%A8%E6%80%81%E5%8C%B9%E9%85%8D"><span class="nav-number">1.3.4.</span> <span class="nav-text">æ¶ˆæ¯çš„åŠ¨æ€åŒ¹é…</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%99%90%E5%88%B6%E5%91%BD%E4%BB%A4%E8%AE%BF%E9%97%AE"><span class="nav-number">1.3.5.</span> <span class="nav-text">é™åˆ¶å‘½ä»¤è®¿é—®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E7%9A%84%E6%AF%8F%E4%B8%AA%E7%9B%91%E5%90%AC%E5%99%A8%E8%AE%BF%E9%97%AE"><span class="nav-number">1.3.5.1.</span> <span class="nav-text">ç®€å•çš„æ¯ä¸ªç›‘å¬å™¨è®¿é—®</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AF%8F%E4%B8%AA%E7%9B%91%E5%90%AC%E5%99%A8%E7%89%B9%E5%AE%9A%E7%9A%84%E8%AE%BF%E9%97%AE%E8%A7%84%E5%88%99"><span class="nav-number">1.3.5.2.</span> <span class="nav-text">æ¯ä¸ªç›‘å¬å™¨ç‰¹å®šçš„è®¿é—®è§„åˆ™</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AF%8F%E4%B8%AA%E6%88%BF%E9%97%B4%E7%89%B9%E5%AE%9A%E7%9A%84%E8%AE%BF%E9%97%AE%E8%A7%84%E5%88%99"><span class="nav-number">1.3.5.3.</span> <span class="nav-text">æ¯ä¸ªæˆ¿é—´ç‰¹å®šçš„è®¿é—®è§„åˆ™</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%82%E9%85%8D%E5%99%A8-1"><span class="nav-number">1.4.</span> <span class="nav-text">é€‚é…å™¨</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E6%82%A8%E8%87%AA%E5%B7%B1%E7%9A%84%E9%80%82%E9%85%8D%E5%99%A8"><span class="nav-number">1.4.1.</span> <span class="nav-text">ç¼–å†™æ‚¨è‡ªå·±çš„é€‚é…å™¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Campfire-%E9%80%82%E9%85%8D%E5%99%A8"><span class="nav-number">1.4.2.</span> <span class="nav-text">Campfire é€‚é…å™¨</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B5%B7%E6%AD%A5"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">èµ·æ­¥</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">é…ç½®</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Campfire-API-%E4%BB%A4%E7%89%8C"><span class="nav-number">1.4.2.2.1.</span> <span class="nav-text">Campfire API ä»¤ç‰Œ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Campfire-%E6%88%BF%E9%97%B4%E5%8F%B7"><span class="nav-number">1.4.2.2.2.</span> <span class="nav-text">Campfire æˆ¿é—´å·</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Campfire-%E8%B4%A6%E6%88%B7"><span class="nav-number">1.4.2.2.3.</span> <span class="nav-text">Campfire è´¦æˆ·</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9C%A8-Heroku-%E4%B8%8A%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-number">1.4.2.2.4.</span> <span class="nav-text">åœ¨ Heroku ä¸Šé…ç½®ç¯å¢ƒå˜é‡</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9C%A8-Unix-%E4%B8%8A%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-number">1.4.2.2.5.</span> <span class="nav-text">åœ¨ Unix ä¸Šé…ç½®ç¯å¢ƒå˜é‡</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9C%A8-Windows-%E4%B8%8A%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-number">1.4.2.2.6.</span> <span class="nav-text">åœ¨ Windows ä¸Šé…ç½®ç¯å¢ƒå˜é‡</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Shell-%E9%80%82%E9%85%8D%E5%99%A8"><span class="nav-number">1.4.3.</span> <span class="nav-text">Shell é€‚é…å™¨</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B5%B7%E6%AD%A5-1"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">èµ·æ­¥</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-1"><span class="nav-number">1.4.3.2.</span> <span class="nav-text">é…ç½®</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E9%80%82%E9%85%8D%E5%99%A8"><span class="nav-number">1.4.4.</span> <span class="nav-text">å¼€å‘é€‚é…å™¨</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%82%E9%85%8D%E5%99%A8%E5%9F%BA%E7%A1%80"><span class="nav-number">1.4.4.1.</span> <span class="nav-text">é€‚é…å™¨åŸºç¡€</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%82%A8%E7%9A%84%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="nav-number">1.4.4.2.</span> <span class="nav-text">é…ç½®æ‚¨çš„å¼€å‘ç¯å¢ƒ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Gochas"><span class="nav-number">1.4.4.3.</span> <span class="nav-text">Gochas</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2-1"><span class="nav-number">1.5.</span> <span class="nav-text">éƒ¨ç½²</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E5%88%B0-Heroku"><span class="nav-number">1.5.1.</span> <span class="nav-text">éƒ¨ç½²åˆ° Heroku</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E5%88%B0-Unix"><span class="nav-number">1.5.2.</span> <span class="nav-text">éƒ¨ç½²åˆ° Unix</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#node-%E5%92%8C-npm"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">node å’Œ npm</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E6%9B%B4%E6%96%B0%E4%BB%A3%E7%A0%81"><span class="nav-number">1.5.2.2.</span> <span class="nav-text">åœ¨æœåŠ¡å™¨ä¸Šæ›´æ–°ä»£ç </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E3%80%81%E5%81%9C%E6%AD%A2%E5%92%8C%E9%87%8D%E5%90%AF-hubot"><span class="nav-number">1.5.2.3.</span> <span class="nav-text">å¯åŠ¨ã€åœæ­¢å’Œé‡å¯ hubot</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BB%BA%E8%AE%AE"><span class="nav-number">1.5.2.4.</span> <span class="nav-text">å»ºè®®</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E5%88%B0-Windows"><span class="nav-number">1.5.3.</span> <span class="nav-text">éƒ¨ç½²åˆ° Windows</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#node-%E5%92%8C-npm-1"><span class="nav-number">1.5.3.1.</span> <span class="nav-text">node å’Œ npm</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84%E4%BB%A3%E7%A0%81"><span class="nav-number">1.5.3.2.</span> <span class="nav-text">æ›´æ–°æœåŠ¡å™¨ä¸Šçš„ä»£ç </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-number">1.5.3.3.</span> <span class="nav-text">è®¾ç½®ç¯å¢ƒå˜é‡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E3%80%81%E5%81%9C%E6%AD%A2%E5%92%8C%E9%87%8D%E5%90%AF-hubot-1"><span class="nav-number">1.5.3.4.</span> <span class="nav-text">å¯åŠ¨ã€åœæ­¢å’Œé‡å¯ hubot</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%A9%E5%85%85%E6%96%87%E6%A1%A3"><span class="nav-number">1.5.3.5.</span> <span class="nav-text">æ‰©å……æ–‡æ¡£</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E5%88%B0-Azure"><span class="nav-number">1.5.4.</span> <span class="nav-text">éƒ¨ç½²åˆ° Azure</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4%E6%8F%90%E7%A4%BA%E5%92%8C%E6%8A%80%E5%B7%A7"><span class="nav-number">1.5.4.1.</span> <span class="nav-text">æ•…éšœæ’é™¤æç¤ºå’ŒæŠ€å·§</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="æ¨æ¬£é›¨" src="https://images.xyang.xin/2018-12/war-soldier.jpeg"><p class="site-author-name" itemprop="name">æ¨æ¬£é›¨</p><div class="site-description" itemprop="description">éŸ¶åæ˜“é€ï¼Œäº«å—è¿™æ¬¢ä¹çš„ç¾å¦™æ—¶å…‰ã€‚</div></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">42</span> <span class="site-state-item-name">æ—¥å¿—</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">2</span> <span class="site-state-item-name">åˆ†ç±»</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">45</span> <span class="site-state-item-name">æ ‡ç­¾</span></a></div></nav></div><div class="links-of-author site-overview-item animated"><span class="links-of-author-item"><a href="https://github.com/yangxyo" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;yangxyo" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span></div><div class="cc-license site-overview-item animated" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zsh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_nd.svg" alt="Creative Commons"></a></div><div class="links-of-blogroll site-overview-item animated"><div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="http://www.ruanyifeng.com/blog/" title="http:&#x2F;&#x2F;www.ruanyifeng.com&#x2F;blog&#x2F;" rel="noopener" target="_blank">é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—</a></li></ul></div></div></div></div></div></aside><div class="sidebar-dimmer"></div></header><div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://blog.xyang.xin/hubot-document/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://images.xyang.xin/2018-12/war-soldier.jpeg"><meta itemprop="name" content="æ¨æ¬£é›¨"><meta itemprop="description" content="éŸ¶åæ˜“é€ï¼Œäº«å—è¿™æ¬¢ä¹çš„ç¾å¦™æ—¶å…‰ã€‚"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="éŸ¶ å…‰"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Hubot å®˜æ–¹æ–‡æ¡£ï¼ˆè¯‘ï¼‰</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºæ—¶é—´ï¼š2021-09-02 20:27:46" itemprop="dateCreated datePublished" datetime="2021-09-02T20:27:46Z">2021-09-02</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">æ›´æ–°äº</span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-09-07 09:34:51" itemprop="dateModified" datetime="2021-09-07T09:34:51Z">2021-09-07</time></span></div></div></header><div class="post-body" itemprop="articleBody"><h1 id="Hubot-å®˜æ–¹æ–‡æ¡£"><a href="#Hubot-å®˜æ–¹æ–‡æ¡£" class="headerlink" title="Hubot å®˜æ–¹æ–‡æ¡£"></a>Hubot å®˜æ–¹æ–‡æ¡£</h1><p><a target="_blank" rel="noopener" href="https://hubot.github.com/docs/">åŸæ–‡é“¾æ¥ğŸ”—</a><br><img data-src="https://images.xyang.xin/2021%2F09%2F01%2Fhubot-avatar.png" alt="hubot-avatar.png"></p><h2 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h2><h3 id="Hubot-èµ·æ­¥"><a href="#Hubot-èµ·æ­¥" class="headerlink" title="Hubot èµ·æ­¥"></a>Hubot èµ·æ­¥</h3><p>æ‚¨éœ€è¦<a target="_blank" rel="noopener" href="https://docs.npmjs.com/getting-started/installing-node">node.jså’Œnpm</a>ã€‚å®‰è£…å®ƒä»¬åï¼Œæˆ‘ä»¬å°±å¯ä»¥å®‰è£… hubot ç”Ÿæˆå™¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm install -g yo generator-hubot</span></span><br></pre></td></tr></table></figure><p>è¿™æ¡å‘½ä»¤å°†ç»™æˆ‘ä»¬å¸¦æ¥hubot <a target="_blank" rel="noopener" href="http://yeoman.io/">yeoman</a>ç”Ÿæˆå™¨ã€‚ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªçš„æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨é‡Œé¢ç”Ÿæˆä¸€ä¸ªæ–°çš„hubotå®ä¾‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åˆ¶é€ ä¸€ä¸ªå« myhubotçš„æœºå™¨äººï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir myhubot</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> myhubot</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yo hubot</span></span><br></pre></td></tr></table></figure><span id="more"></span><p>æ‰§è¡Œå‘½ä»¤åï¼Œæ‚¨å°†è¢«é—®åˆ°ä¸€äº›å…³äºè°åœ¨åˆ›å»ºæœºå™¨äººå’Œæ‚¨å°†ä½¿ç”¨å“ªä¸ªé€‚é…å™¨çš„é—®é¢˜ã€‚é€‚é…å™¨æ˜¯hubotä¸ä¸åŒèŠå¤©æä¾›å•†é›†æˆçš„æ–¹å¼ã€‚</p><p>å¦‚æœæ‚¨å¸Œæœ›åœ¨æ²¡æœ‰äº¤äº’æç¤ºé…ç½®çš„æƒ…å†µä¸‹è‡ªåŠ¨åŒ–æ‚¨çš„ hubot æ„å»ºï¼Œæ‚¨å¯ä»¥å°†ä»¥ä¸‹é€‰é¡¹æ·»åŠ åˆ° <code>yo hubot</code> å‘½ä»¤ä¸­ï¼š</p><table><thead><tr><th>Option</th><th>Description</th></tr></thead><tbody><tr><td>--owner=â€Bot Wrangler <a href="mailto:&#98;&#x77;&#64;&#101;&#120;&#x61;&#109;&#112;&#x6c;&#x65;&#46;&#x63;&#111;&#x6d;">&#98;&#x77;&#64;&#101;&#120;&#x61;&#109;&#112;&#x6c;&#x65;&#46;&#x63;&#111;&#x6d;</a>â€œ</td><td>Bot owner, e.g. â€œBot Wrangler <a href="mailto:bw@example.com">bw@example.com</a>â€</td></tr><tr><td>--name=â€Hubotâ€</td><td>bot å, e.g. â€œHubotâ€</td></tr><tr><td>--description=â€Delightfully aware robuttâ€</td><td>bot æè¿°, e.g. â€œDelightfully aware robuttâ€</td></tr><tr><td>--adapter=campfire</td><td>bot é€‚é…å™¨, e.g. â€œcampfireâ€</td></tr><tr><td>--defaults</td><td>æ‰€æœ‰å£°æ˜éƒ½è®¾ç½®ä¸ºé»˜è®¤å€¼ä¸”æ— éœ€æç¤º</td></tr></tbody></table><p>æ‚¨ç°åœ¨å°±æ‹¥æœ‰äº†è‡ªå·±çš„ä¸€ä¸ªå¤šåŠŸèƒ½çš„ hubotï¼ä¸ºæ–¹ä¾¿èµ·è§ï¼Œæœ‰ä¸€ä¸ª<code>bin/hubot</code>å‘½ä»¤ï¼Œç”¨äºå¤„ç†å®‰è£… npm ä¾èµ–é¡¹ã€åŠ è½½è„šæœ¬ï¼Œç„¶åå¯åŠ¨æ‚¨çš„ hubotã€‚</p><p>Hubot éœ€è¦ Redis æ¥æŒä¹…åŒ–æ•°æ®ï¼Œå› æ­¤åœ¨æ‚¨å¯ä»¥åœ¨è‡ªå·±çš„è®¡ç®—æœºä¸Šå¯åŠ¨ hubot ä¹‹å‰ï¼Œæ‚¨åº”è¯¥åœ¨æœ¬åœ°ä¸»æœºä¸Šå®‰è£… Redisã€‚å¦‚æœåªæ˜¯æƒ³åœ¨æ²¡æœ‰ Redis çš„æƒ…å†µä¸‹æµ‹è¯• Hubotï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ä» <code>external-scripts.json</code> ä¸­åˆ é™¤ <code>hubot-redis-brain</code>ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/hubot</span></span><br><span class="line"><span class="meta">Hubot&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™å°†ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://hubot.github.com/docs/adapters/shell/">shell é€‚é…å™¨</a>å¯åŠ¨ hubotï¼Œè¿™å¯¹å¼€å‘éå¸¸æœ‰ç”¨ã€‚è®°ä¸‹ <code>Hubot&gt;</code>ï¼Œè¿™æ˜¯æ‚¨çš„ hubot å°†ç”¨å‘½ä»¤å“åº”çš„åç§°ã€‚ä¾‹å¦‚ï¼Œåˆ—å‡ºå¯ç”¨å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/hubot</span></span><br><span class="line"><span class="meta">hubot&gt;</span><span class="bash"> hubot <span class="built_in">help</span></span></span><br><span class="line">hubot adapter - Reply with the adapter</span><br><span class="line">hubot animate me &lt;query&gt; - The same thing as `image me`, except adds a few parameters to try to return an animated GIF instead.</span><br><span class="line">hubot echo &lt;text&gt; - Reply back with &lt;text&gt;</span><br><span class="line">hubot help - Displays all of the help commands that hubot knows about.</span><br><span class="line">hubot help &lt;query&gt; - Displays all help commands that match &lt;query&gt;.</span><br><span class="line">hubot image me &lt;query&gt; - The Original. Queries Google Images for &lt;query&gt; and returns a random top result.</span><br><span class="line">hubot map me &lt;query&gt; - Returns a map view of the area returned by `query`.</span><br><span class="line">hubot mustache me &lt;query&gt; - Searches Google Images for the specified query and mustaches it.</span><br><span class="line">hubot mustache me &lt;url&gt; - Adds a mustache to the specified URL.</span><br><span class="line">hubot ping - Reply with pong</span><br><span class="line">hubot pronounce &lt;phrase&gt; in &lt;language&gt; - Provides pronunciation of &lt;phrase&gt; (&lt;language&gt; is optional)</span><br><span class="line">hubot pug bomb N - get N pugs</span><br><span class="line">hubot pug me - Receive a pug</span><br><span class="line">hubot the rules - Make sure hubot still knows the rules.</span><br><span class="line">hubot time - Reply with current time</span><br><span class="line">hubot translate me &lt;phrase&gt; - Searches for a translation for the &lt;phrase&gt; and then prints that bad boy out.</span><br><span class="line">hubot translate me from &lt;source&gt; into &lt;target&gt; &lt;phrase&gt; - Translates &lt;phrase&gt; from &lt;source&gt; into &lt;target&gt;. Both &lt;source&gt; and &lt;target&gt; are optional</span><br><span class="line">hubot youtube me &lt;query&gt; - Searches YouTube for the query and returns the video embed link.</span><br><span class="line">ship it - Display a motivation squirrel</span><br></pre></td></tr></table></figure><p>æ‚¨åŸºæœ¬ä¸Šéƒ½ä¼šæƒ³è¦æ”¹å˜æ‚¨çš„ hubot çš„åå­—æ¥æ·»åŠ è§’è‰²ã€‚ bin/hubot éœ€è¦ä¸€ä¸ª <code>--name</code>ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">%</span><span class="bash"> bin/hubot --name myhubot</span></span><br><span class="line"><span class="meta">myhubot&gt;</span></span><br></pre></td></tr></table></figure><p>æ‚¨çš„ hubot ç°åœ¨å°†å“åº” <code>myhubot</code> ã€‚è¿™æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œå¯ä»¥ä»¥ <code>@</code> ä¸ºå‰ç¼€æˆ–ä»¥ <code>:</code>ä¸ºåç¼€ã€‚è¿™äº›æ˜¯ç­‰æ•ˆçš„ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MYHUBOT help</span><br><span class="line">myhubot help</span><br><span class="line">@myhubot help</span><br><span class="line">myhubot: help</span><br></pre></td></tr></table></figure><h3 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h3><p>Hubot çš„åŠ›é‡æ¥è‡ªäºè„šæœ¬ã€‚ç¤¾åŒºç¼–å†™å’Œç»´æŠ¤ç€å‡ ç™¾ä¸ªè„šæœ¬ã€‚é€šè¿‡ä½¿ç”¨ <code>hubot-scripts &lt;your-search-term&gt;</code> æŸ¥æ‰¾ <a target="_blank" rel="noopener" href="https://www.npmjs.com/browse/keyword/hubot-scripts">NPM registry</a> æ‰¾åˆ°å®ƒä»¬ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm search hubot-scripts github</span></span><br><span class="line">NAME                  DESCRIPTION</span><br><span class="line">hubot-deployer        Giving Hubot the ability to deploy GitHub repos to PaaS providers hubot hubot-scripts hubot-gith</span><br><span class="line">hubot-gh-release-pr   A hubot script to create GitHub&#x27;s PR for release</span><br><span class="line">hubot-github          Giving Hubot the ability to be a vital member of your github organization</span><br><span class="line">â€¦</span><br></pre></td></tr></table></figure><p>è¦ä½¿ç”¨ NPM åŒ…ä¸­çš„è„šæœ¬ï¼š</p><ol><li>è¿è¡Œ<code>npm install --save &lt;package-name&gt;</code>å»æ·»åŠ è¯¥åŒ…ä½œä¸ºä¾èµ–å¹¶å®‰è£…å®ƒã€‚</li><li>æ·»åŠ è¯¥åŒ…åˆ°<code>external-scripts.json</code>ã€‚</li><li>è¿è¡Œ<code>npm home &lt;package-name&gt;</code>ä»¥æ‰“å¼€è„šæœ¬ä¸»é¡µçš„æµè§ˆå™¨çª—å£ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æ‰¾åˆ°æœ‰å…³é…ç½®å’Œå®‰è£…è„šæœ¬çš„æ›´å¤šä¿¡æ¯ã€‚</li></ol><p>æ‚¨ä¹Ÿå¯ä»¥å°†æ‚¨è‡ªå·±çš„è„šæœ¬æ”¾åœ¨<code>scripts/</code>ç›®å½•ä¸‹ã€‚æ”¾åœ¨è¿™é‡Œçš„æ‰€æœ‰è„šæœ¬éƒ½å°†è¢« hubot è‡ªåŠ¨åŠ è½½å’Œä½¿ç”¨ã€‚é˜…è¯»æœ‰å…³é€šè¿‡<a target="_blank" rel="noopener" href="https://hubot.github.com/docs/scripting/">ç¼–å†™è‡ªå·±çš„è„šæœ¬</a>è‡ªå®šä¹‰ hubot çš„æ›´å¤šä¿¡æ¯ã€‚</p><h3 id="é€‚é…å™¨"><a href="#é€‚é…å™¨" class="headerlink" title="é€‚é…å™¨"></a>é€‚é…å™¨</h3><p>Hubot ä½¿ç”¨é€‚é…å™¨æ¨¡å¼æ¥æ”¯æŒå¤šä¸ªèŠå¤©åç«¯ã€‚è¿™æ˜¯<a target="_blank" rel="noopener" href="https://hubot.github.com/docs/adapters/">å¯ç”¨é€‚é…å™¨çš„åˆ—è¡¨</a>ï¼Œä»¥åŠå¦‚ä½•é…ç½®å®ƒä»¬çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><h3 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h3><p>æ‚¨å¯ä»¥å°† hubot éƒ¨ç½²åˆ° Herokuï¼Œè¿™æ˜¯å®˜æ–¹æ”¯æŒçš„æ–¹æ³•ã€‚æ­¤å¤–ï¼Œæ‚¨è¿˜å¯ä»¥å°† hubot éƒ¨ç½²åˆ°ç±»ä¼¼ UNIX çš„ç³»ç»Ÿæˆ– Windows ä¸­ã€‚è¯·æ³¨æ„ï¼Œéƒ¨ç½²åˆ° Windows çš„æ”¯æŒå°šæœªå¾—åˆ°å®˜æ–¹æ”¯æŒã€‚</p><ul><li><a target="_blank" rel="noopener" href="https://hubot.github.com/docs/deploying/heroku/">éƒ¨ç½² hubot åˆ° Heroku</a></li><li><a target="_blank" rel="noopener" href="https://hubot.github.com/docs/deploying/unix/">éƒ¨ç½² hubot åˆ° UNIX</a></li><li><a target="_blank" rel="noopener" href="https://hubot.github.com/docs/deploying/windows/">éƒ¨ç½² hubot åˆ° Windows</a></li></ul><h3 id="æ¨¡å¼"><a href="#æ¨¡å¼" class="headerlink" title="æ¨¡å¼"></a>æ¨¡å¼</h3><p>ä½¿ç”¨è‡ªå®šä¹‰è„šæœ¬ï¼Œæ‚¨å¯ä»¥å¿«é€Ÿè‡ªå®šä¹‰ hubotï¼Œä½¿ä»–ï¼ˆå¥¹ï¼‰æˆä¸ºæœ€å…·ç”Ÿå‘½åŠ›çš„æœºå™¨äººã€‚å½“æ‚¨æ•™æ‚¨çš„ hubot æ–°çš„æŠ€èƒ½ï¼Œé˜…è¯»<a target="_blank" rel="noopener" href="https://hubot.github.com/docs/patterns/">docs/patterns.md</a> é‡Œçš„ä¸€äº›æ¼‚äº®çš„æŠ€å·§ï¼Œå¯èƒ½ä¼šæ´¾ä¸Šç”¨åœºã€‚</p><h2 id="è„šæœ¬-1"><a href="#è„šæœ¬-1" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h2><p>å¼€ç®±å³ç”¨çš„ hubot ä¸ä¼šåšå¤ªå¤šï¼Œ ä½†å®ƒæ˜¯ä¸€ä¸ªå¯æ‰©å±•çš„ï¼Œå¯ç¼–è„šæœ¬çš„æœºå™¨äººæœ‹å‹ã€‚æœ‰<a target="_blank" rel="noopener" href="https://hubot.github.com/docs/#scripts">æ•°ä»¥ç™¾è®¡çš„è„šæœ¬ç”±ç¤¾åŒºç¼–å†™å’Œç»´æŠ¤</a>ï¼Œå¹¶ä¸”è‡ªå·±å†™èµ·æ¥ä¹Ÿå¾ˆå®¹æ˜“ã€‚æ‚¨å¯ä»¥åœ¨hubotçš„<code>scripts</code>ç›®å½•ä¸­åˆ›å»ºè‡ªå®šä¹‰è„šæœ¬ï¼Œæˆ–<a target="_blank" rel="noopener" href="https://hubot.github.com/docs/scripting/#creating-a-script-package">åˆ›å»ºä¸€ä¸ªè„šæœ¬åŒ…</a>ï¼Œä»¥ä¾¿ä¸ç¤¾åŒºå…±äº«ï¼</p><h3 id="è„šæœ¬å‰–æ"><a href="#è„šæœ¬å‰–æ" class="headerlink" title="è„šæœ¬å‰–æ"></a>è„šæœ¬å‰–æ</h3><p>å½“æ‚¨åˆ›å»º hubot æ—¶ï¼Œç”Ÿæˆå™¨è¿˜åˆ›å»ºäº†<code>scripts</code>ç›®å½•ã€‚å¦‚æœæ‚¨çœ‹äº†ä¸€ä¸‹é‚£é‡Œï¼Œæ‚¨ä¼šçœ‹åˆ°ä¸€äº›è„šæœ¬çš„ä¾‹å­ã€‚è„šæœ¬è¦æˆä¸ºè„šæœ¬ï¼Œå®ƒéœ€è¦ï¼š</p><ul><li>åœ¨ hubot è„šæœ¬åŠ è½½çš„ç›®å½•é‡Œï¼ˆé»˜è®¤ä¸º<code>src/scripts</code>å’Œ<code>scripts</code>ï¼‰</li><li>æ˜¯ä¸€ä¸ª<code>.coffee</code>æˆ–è€…<code>.js</code>æ–‡ä»¶</li><li>å¯¼å‡ºä¸€ä¸ªå‡½æ•°</li></ul><p>å¯¼å‡ºä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬çš„æ„æ€æ˜¯ï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  <span class="comment"># your code here</span></span><br></pre></td></tr></table></figure><p>æœºå™¨äººå‚æ•°æ˜¯æ‚¨çš„æœºå™¨äººæœ‹å‹çš„å®ä¾‹ã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹ç¼–å†™ä¸€äº›å¾ˆæ£’çš„è„šæœ¬ã€‚</p><h3 id="è†å¬å’Œå“åº”"><a href="#è†å¬å’Œå“åº”" class="headerlink" title="è†å¬å’Œå“åº”"></a>è†å¬å’Œå“åº”</h3><p>ç”±äºè¿™æ˜¯ä¸€ä¸ªèŠå¤©æœºå™¨äººï¼Œæœ€å¸¸è§çš„äº¤äº’æ˜¯åŸºäºæ¶ˆæ¯ã€‚Hubot å¯ä»¥<code>hear</code>åœ¨æˆ¿é—´é‡Œè¯´çš„æ¶ˆæ¯ï¼Œæˆ–ç›´æ¥<code>response</code>ä¸“é—¨ä¼ è¾¾ç»™å®ƒçš„æ¶ˆæ¯ã€‚è¿™ä¸¤ç§æ–¹æ³•éƒ½ä»¥ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å’Œä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  robot.hear <span class="regexp">/badger/i</span>, <span class="function"><span class="params">(res)</span> -&gt;</span></span><br><span class="line">    <span class="comment"># your code here</span></span><br><span class="line"></span><br><span class="line">  robot.respond <span class="regexp">/open the pod bay doors/i</span>, <span class="function"><span class="params">(res)</span> -&gt;</span></span><br><span class="line">    <span class="comment"># your code here</span></span><br></pre></td></tr></table></figure><p>æ¯å½“ä¸€ä¸ªæ¶ˆæ¯çš„æ–‡æœ¬åŒ¹é…æ—¶ï¼Œ<code>robot.hear /badger/</code>çš„å›è°ƒå°±ä¼šè¢«è°ƒç”¨ã€‚ä¾‹å¦‚ï¼š</p><ul><li>Stop badgering the witness</li><li>badger me</li><li>what exactly is a badger anyways</li></ul><p><code>robot.respond /open the pod bay doors/i</code> çš„å›è°ƒä»…å½“æ¶ˆæ¯ç´§è·Ÿç€æœºå™¨äººçš„åå­—æˆ–è€…åˆ«åè¢«è°ƒç”¨ã€‚å¦‚æœæœºå™¨äººçš„åç§°æ˜¯ HALï¼Œåˆ«åæ˜¯ /ï¼Œåˆ™æ­¤å›è°ƒå°†è¢«ä»¥ä¸‹è§¦å‘ï¼š</p><ul><li>hal open the pod bay doors</li><li>HAL: open the pod bay doors</li><li>@HAL open the pod bay doors</li><li>/open the pod bay doors</li></ul><p>å®ƒä¸ä¼šè¢«è°ƒç”¨ï¼š</p><ul><li>HAL: please open the pod bay doors<ul><li>å› ä¸ºå®ƒçš„å“åº”ä¸æœºå™¨äººåç§°åç´§æ¥ç€çš„æ–‡æœ¬ç»‘å®š</li></ul></li><li>has anyone ever mentioned how lovely you are when you open the pod bay doors?<ul><li>å› ä¸ºå®ƒç¡®å°‘æœºå™¨äººçš„åå­—</li></ul></li></ul><h3 id="å‘é€å’Œå›å¤"><a href="#å‘é€å’Œå›å¤" class="headerlink" title="å‘é€å’Œå›å¤"></a>å‘é€å’Œå›å¤</h3><p><code>res</code>å‚æ•°æ˜¯<code>Response</code>çš„å®ä¾‹ï¼ˆåœ¨å†å²ä¸Šï¼Œè¿™ä¸ªå‚æ•°æ˜¯ <code>msg</code>ï¼Œæ‚¨å¯èƒ½ä¼šçœ‹åˆ°å…¶ä»–è„šæœ¬ä½¿ç”¨å®ƒï¼‰ã€‚æœ‰äº†å®ƒï¼Œæ‚¨å¯ä»¥å°†æ¶ˆæ¯<code>send</code>å› <code>res</code>æ¥çš„æˆ¿é—´ï¼Œ<code>emote</code>ä¸€ä¸ªæ¶ˆæ¯åˆ°ä¸€ä¸ªæˆ¿é—´ï¼ˆå¦‚æœç»™å®šçš„é€‚é…å™¨æ”¯æŒå®ƒï¼‰ï¼Œæˆ–<code>reply</code>å‘é€æ¶ˆæ¯çš„äººã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  robot.hear <span class="regexp">/badger/i</span>, <span class="function"><span class="params">(res)</span> -&gt;</span></span><br><span class="line">    res.send <span class="string">&quot;Badgers? BADGERS? WE DON&#x27;T NEED NO STINKIN BADGERS&quot;</span></span><br><span class="line"></span><br><span class="line">  robot.respond <span class="regexp">/open the pod bay doors/i</span>, <span class="function"><span class="params">(res)</span> -&gt;</span></span><br><span class="line">    res.reply <span class="string">&quot;I&#x27;m afraid I can&#x27;t let you do that.&quot;</span></span><br><span class="line"></span><br><span class="line">  robot.hear <span class="regexp">/I like pie/i</span>, <span class="function"><span class="params">(res)</span> -&gt;</span></span><br><span class="line">    res.emote <span class="string">&quot;makes a freshly baked pie&quot;</span></span><br></pre></td></tr></table></figure><p><code>robot.hear /badgers/</code>çš„å›è°ƒå‘é€æŒ‡å®šçš„æ¶ˆæ¯ï¼Œè€Œä¸ç®¡å‘è°è¯´ï¼š â€œBadgers? BADGERS? WE DONâ€™T NEED NO STINKIN BADGERSâ€ã€‚</p><p>å¦‚æœä¸€ä¸ªç”¨æˆ· Dave è¯´ â€œHAL: open the pod bay doorsâ€ï¼Œ <code>robot.respond /open the pod bay doors/i</code> çš„å›è°ƒå‘é€ä¸€ä¸ªæ¶ˆæ¯<code>Dave: Iâ€™m afraid I canâ€™t let you do that.</code></p><h3 id="ç»™æˆ¿é—´æˆ–ç”¨æˆ·çš„æ¶ˆæ¯"><a href="#ç»™æˆ¿é—´æˆ–ç”¨æˆ·çš„æ¶ˆæ¯" class="headerlink" title="ç»™æˆ¿é—´æˆ–ç”¨æˆ·çš„æ¶ˆæ¯"></a>ç»™æˆ¿é—´æˆ–ç”¨æˆ·çš„æ¶ˆæ¯</h3><p>æ¶ˆæ¯å¯ä»¥ä½¿ç”¨ <code>messageRoom</code> åŠŸèƒ½å‘é€ç»™æŒ‡å®šçš„æˆ¿é—´æˆ–ç”¨æˆ·ã€‚</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line"></span><br><span class="line">  robot.hear <span class="regexp">/green eggs/i</span>, <span class="function"><span class="params">(res)</span> -&gt;</span></span><br><span class="line">    room = <span class="string">&quot;mytestroom&quot;</span></span><br><span class="line">    robot.messageRoom room, <span class="string">&quot;I do not like green eggs and ham.  I do not like them sam-I-am.&quot;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦ï¼Œå¯ä»¥æ˜ç¡®æŒ‡å®šç”¨æˆ·åï¼Œæˆ–ä½¿ç”¨å“åº”å¯¹è±¡ï¼Œå¯ä»¥å‘åŸå§‹å‘ä»¶äººå‘é€ç§äººæ¶ˆæ¯ã€‚</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">robot.respond <span class="regexp">/I don&#x27;t like Sam-I-am/i</span>, <span class="function"><span class="params">(res)</span> -&gt;</span></span><br><span class="line">  room =  <span class="string">&#x27;joemanager&#x27;</span></span><br><span class="line">  robot.messageRoom room, <span class="string">&quot;Someone does not like Dr. Seus&quot;</span></span><br><span class="line">  res.reply  <span class="string">&quot;That Sam-I-am\nThat Sam-I-am\nI do not like\nthat Sam-I-am&quot;</span></span><br><span class="line"></span><br><span class="line">robot.hear <span class="regexp">/Sam-I-am/i</span>, <span class="function"><span class="params">(res)</span> -&gt;</span></span><br><span class="line">  room =  res.envelope.user.name</span><br><span class="line">  robot.messageRoom room, <span class="string">&quot;That Sam-I-am\nThat Sam-I-am\nI do not like\nthat Sam-I-am&quot;</span></span><br></pre></td></tr></table></figure><h3 id="æ•è·æ•°æ®"><a href="#æ•è·æ•°æ®" class="headerlink" title="æ•è·æ•°æ®"></a>æ•è·æ•°æ®</h3><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„è„šæœ¬å·²ç»æœ‰é™æ€å“åº”ï¼Œè¿™è™½ç„¶æœ‰è¶£ï¼Œåœ¨åŠŸèƒ½æ–¹é¢å´å¾ˆè–„å¼±ã€‚<code>res.match</code>çš„ç»“æœæ˜¯å°†ä¼ å…¥çš„æ¶ˆæ¯ä¸æ­£åˆ™è¡¨è¾¾è¿›è¡ŒåŒ¹é…ã€‚è¿™åªæ˜¯ä¸€ä¸ª <a target="_blank" rel="noopener" href="http://www.w3schools.com/jsref/jsref_match.asp">JavaScript thing</a>ï¼Œ å®ƒæœ€ç»ˆæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œ ç´¢å¼•0æ˜¯ä¸è¡¨è¾¾å¼åŒ¹é…çš„å…¨æ–‡ã€‚å¦‚æœåŒ…æ‹¬æ•è·ç»„ï¼Œè¿™äº›ç»„å°†å¡«å…… <code>res.match</code>ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æ›´æ–°è„šæœ¬ï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">robot.respond <span class="regexp">/open the (.*) doors/i</span>, <span class="function"><span class="params">(res)</span> -&gt;</span></span><br><span class="line">    <span class="comment"># your code here</span></span><br></pre></td></tr></table></figure><p>å¦‚æœDaveè¯´â€œHAL: open the pod bay doorsâ€ï¼Œ<code>res.match[0]</code>å°±æˆäº†<code>open the pod bay doors</code>ï¼Œ<code>res.match[1]</code>åˆ™ä¸º<code>pod bay</code>ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹åšæ›´å¤šåŠ¨æ€çš„ä¸œè¥¿äº†ï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">robot.respond <span class="regexp">/open the (.*) doors/i</span>, <span class="function"><span class="params">(res)</span> -&gt;</span></span><br><span class="line">  doorType = res.match[<span class="number">1</span>]</span><br><span class="line">  <span class="keyword">if</span> doorType <span class="keyword">is</span> <span class="string">&quot;pod bay&quot;</span></span><br><span class="line">    res.reply <span class="string">&quot;I&#x27;m afraid I can&#x27;t let you do that.&quot;</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    res.reply <span class="string">&quot;Opening <span class="subst">#&#123;doorType&#125;</span> doors&quot;</span></span><br></pre></td></tr></table></figure><h3 id="è°ƒç”¨-HTTP"><a href="#è°ƒç”¨-HTTP" class="headerlink" title="è°ƒç”¨ HTTP"></a>è°ƒç”¨ HTTP</h3><p>Hubot å¯ä»¥ä¸ºæ‚¨è¿›è¡Œ HTTP è¯·æ±‚ï¼Œä»¥é›†æˆå’Œæ•´åˆç¬¬ä¸‰æ–¹ API ã€‚è¿™èƒ½å¤Ÿé€šè¿‡ä¸€ä¸ªåœ¨<code>robot.http</code>çš„<a target="_blank" rel="noopener" href="https://github.com/technoweenie/node-scoped-http-client">node-scoped-http-client</a>å®ä¾‹è¿›è¡Œã€‚æœ€ç®€å•çš„ä¾‹å­å¦‚ï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">robot.http(<span class="string">&quot;https://midnight-train&quot;</span>)</span><br><span class="line">    .get() (err, res, body) -&gt;</span><br><span class="line">      <span class="comment"># your code here</span></span><br></pre></td></tr></table></figure><p>post è¯·æ±‚ä¾‹å¦‚ï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">data = <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">  foo: <span class="string">&#x27;bar&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line">robot.http(<span class="string">&quot;https://midnight-train&quot;</span>)</span><br><span class="line">  .header(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;application/json&#x27;</span>)</span><br><span class="line">  .post(data) (err, res, body) -&gt;</span><br><span class="line">    <span class="comment"># your code here</span></span><br></pre></td></tr></table></figure><p>å¦‚æœé‡åˆ°é”™è¯¯ï¼Œ<code>err</code> å°±æ˜¯æ‚¨æ‰€é‡åˆ°çš„é”™è¯¯ã€‚æ‚¨é€šå¸¸ä¼šæƒ³è¦æ£€æŸ¥è¿™ä¸€ç‚¹ï¼Œå¹¶ç›¸åº”åœ°å¤„ç†ï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">robot.http(<span class="string">&quot;https://midnight-train&quot;</span>)</span><br><span class="line">  .get() (err, res, body) -&gt;</span><br><span class="line">    <span class="keyword">if</span> err</span><br><span class="line">      res.send <span class="string">&quot;Encountered an error :( <span class="subst">#&#123;err&#125;</span>&quot;</span></span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    <span class="comment"># your code here, knowing it was successful</span></span><br></pre></td></tr></table></figure><p><code>res</code>æ˜¯nodeçš„<a target="_blank" rel="noopener" href="http://nodejs.org/api/http.html#http_class_http_serverresponse">http.ServerResponse</a>çš„ä¸€ä¸ªå®ä¾‹ã€‚ä½¿ç”¨node-scoped-http-clientçš„æ—¶å€™å¤§å¤šæ•°æ–¹æ³•ä¸æ˜¯ç‰¹åˆ«å…³é”®ï¼Œ ä½†æ˜¯æœ‰æ„æ€çš„æ˜¯<code>statusCode</code>å’Œ<code>getHeader</code>ã€‚ä½¿ç”¨<code>statusCode</code>å»æ£€æŸ¥HTTPçš„çŠ¶æ€ç ï¼Œå½“ä¸æ˜¯200çŠ¶æ€ç çš„æ—¶å€™æ„å‘³ç€ç³Ÿç³•çš„äº‹æƒ…å‘ç”Ÿäº†ã€‚ä½¿ç”¨<code>getHeader</code>æŸ¥çœ‹headerï¼Œä¾‹å¦‚å»æ£€æŸ¥æœåŠ¡é™æµï¼ˆ<code>X-RateLimit-Limit:1 //æ¯ç§’1æ¬¡è¯·æ±‚</code>ï¼‰ï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">robot.http(<span class="string">&quot;https://midnight-train&quot;</span>)</span><br><span class="line">  .get() (err, res, body) -&gt;</span><br><span class="line">    <span class="comment"># pretend there&#x27;s error checking code here</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> res.statusCode <span class="keyword">isnt</span> <span class="number">200</span></span><br><span class="line">      res.send <span class="string">&quot;Request didn&#x27;t come back HTTP 200 :(&quot;</span></span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    rateLimitRemaining = <span class="built_in">parseInt</span> res.getHeader(<span class="string">&#x27;X-RateLimit-Limit&#x27;</span>) <span class="keyword">if</span> res.getHeader(<span class="string">&#x27;X-RateLimit-Limit&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> rateLimitRemaining <span class="keyword">and</span> rateLimitRemaining &lt; <span class="number">1</span></span><br><span class="line">      res.send <span class="string">&quot;Rate Limit hit, stop believing for awhile&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># rest of your code</span></span><br></pre></td></tr></table></figure><p><code>body</code> æ˜¯å“åº”ä½“å­—ç¬¦ä¸²ï¼Œåº”è¯¥æ˜¯æ‚¨æœ€å…³å¿ƒçš„ä¸œè¥¿ã€‚</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">robot.http(<span class="string">&quot;https://midnight-train&quot;</span>)</span><br><span class="line">  .get() (err, res, body) -&gt;</span><br><span class="line">    <span class="comment"># error checking code here</span></span><br><span class="line"></span><br><span class="line">    res.send <span class="string">&quot;Got back <span class="subst">#&#123;body&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><h4 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h4><p>ä¸ API äº¤æµï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯ JSONï¼Œå› ä¸ºå®ƒä¸éœ€è¦ä»»ä½•é¢å¤–çš„ä¾èµ–ã€‚å½“ä½¿ç”¨<code>robot.http</code>è¯·æ±‚ï¼Œæ‚¨é€šå¸¸åº”è¯¥è®¾ç½®<code>Accept</code>å¤´å»ç»™APIä¸€ä¸ªå¸Œæœ›å¾—åˆ°ä»€ä¹ˆçš„çº¿ç´¢ã€‚ä¸€æ—¦æ‚¨å¾—åˆ°äº†è¿”å›çš„<code>body</code>ï¼Œæ‚¨å°±å¯ä»¥ä½¿ç”¨ <code>JSON.parse</code>ï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">robot.http(<span class="string">&quot;https://midnight-train&quot;</span>)</span><br><span class="line">  .header(<span class="string">&#x27;Accept&#x27;</span>, <span class="string">&#x27;application/json&#x27;</span>)</span><br><span class="line">  .get() (err, res, body) -&gt;</span><br><span class="line">    <span class="comment"># error checking code here</span></span><br><span class="line"></span><br><span class="line">    data = <span class="built_in">JSON</span>.parse body</span><br><span class="line">    res.send <span class="string">&quot;<span class="subst">#&#123;data.passenger&#125;</span> taking midnight train going <span class="subst">#&#123;data.destination&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°çš„è¿”å›ä¹Ÿå¯èƒ½ä¸æ˜¯JSONï¼Œå°±åƒå¦‚æœè¿™APIé‡åˆ°ä¸€ä¸ªé”™è¯¯å¹¶ä¸”å®ƒè¯•å›¾æ¸²æŸ“ä¸€ä¸ªæ­£å¸¸çš„ HTML é”™è¯¯ï¼Œè€Œä¸æ˜¯ JSONã€‚ä¸ºäº†å®‰å…¨èµ·è§ï¼Œæ‚¨åº”è¯¥æ£€æŸ¥å†…å®¹ç±»å‹ï¼Œå¹¶åœ¨è§£ææ—¶å‘ç°ä»»ä½•é”™è¯¯ã€‚</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">robot.http(<span class="string">&quot;https://midnight-train&quot;</span>)</span><br><span class="line">  .header(<span class="string">&#x27;Accept&#x27;</span>, <span class="string">&#x27;application/json&#x27;</span>)</span><br><span class="line">  .get() (err, res, body) -&gt;</span><br><span class="line">    <span class="comment"># err &amp; response status checking code here</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> response.getHeader(<span class="string">&#x27;Content-Type&#x27;</span>) <span class="keyword">isnt</span> <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">      res.send <span class="string">&quot;Didn&#x27;t get back JSON :(&quot;</span></span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    data = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">      data = <span class="built_in">JSON</span>.parse body</span><br><span class="line">    <span class="keyword">catch</span> error</span><br><span class="line">     res.send <span class="string">&quot;Ran into an error parsing JSON :(&quot;</span></span><br><span class="line">     <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># your code here</span></span><br></pre></td></tr></table></figure><h4 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h4><p>XML API æ¯”è¾ƒéš¾ï¼Œå› ä¸ºæ²¡æœ‰æ†ç»‘çš„ XML è§£æåº“ã€‚è¯¦ç»†ä»‹ç»æ­¤æ–‡æ¡£çš„èŒƒå›´è¶…å‡ºäº†æ­¤èŒƒå›´ï¼Œä½†ä¸‹é¢æœ‰ä¸€äº›å¯ä»¥æŸ¥çœ‹çš„åº“ï¼š</p><ul><li><a target="_blank" rel="noopener" href="https://github.com/buglabs/node-xml2json">xml2json</a> (simplest to use, but has some limitations)</li><li><a target="_blank" rel="noopener" href="https://github.com/tmpvar/jsdom">jsdom</a> (JavaScript implementation of the W3C DOM)</li><li><a target="_blank" rel="noopener" href="https://github.com/Leonidas-from-XIV/node-xml2js">xml2js</a></li></ul><h4 id="è¤å¹•æŠ“å–"><a href="#è¤å¹•æŠ“å–" class="headerlink" title="è¤å¹•æŠ“å–"></a>è¤å¹•æŠ“å–</h4><p>å¯¹äºæ²¡æœ‰ API çš„æ—¶ä»£ï¼Œæ€»æœ‰å¯èƒ½è¿›è¡Œè¤å¹•æŠ“å–ã€‚è¯¦ç»†ä»‹ç»æ­¤æ–‡æ¡£çš„èŒƒå›´è¶…å‡ºäº†æ­¤èŒƒå›´ï¼Œä½†ä¸‹é¢æ˜¯ä¸€äº›å¯ä»¥æŸ¥çœ‹çš„åº“ï¼š</p><ul><li><a target="_blank" rel="noopener" href="https://github.com/MatthewMueller/cheerio">cheerio</a> (familiar syntax and API to jQuery)</li><li><a target="_blank" rel="noopener" href="https://github.com/tmpvar/jsdom">jsdom</a> (JavaScript implementation of the W3C DOM)</li></ul><h4 id="é«˜çº§-HTTP-å’Œ-HTTPS-è®¾ç½®"><a href="#é«˜çº§-HTTP-å’Œ-HTTPS-è®¾ç½®" class="headerlink" title="é«˜çº§ HTTP å’Œ HTTPS è®¾ç½®"></a>é«˜çº§ HTTP å’Œ HTTPS è®¾ç½®</h4><p>å‰é¢æåˆ°ï¼Œhubot ä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/technoweenie/node-scoped-http-client">node-scoped-http-client</a>æ¥æä¾›ä¸€ä¸ªç®€å•çš„æ¥å£å»å‘èµ·HTTPå’ŒHTTPSè¯·æ±‚ã€‚å®ƒå°è£…äº†nodeçš„<a target="_blank" rel="noopener" href="http://nodejs.org/api/http.html">http</a>å’Œ<a target="_blank" rel="noopener" href="http://nodejs.org/api/https.html">https</a>åº“ï¼Œä½†ä¸ºå¸¸è§çš„äº¤äº’ç±»å‹æä¾›äº†ä¸€ä¸ªç®€å•çš„DSLï¼ˆDomain Specific Language é¢†åŸŸä¸“ç”¨è¯­è¨€ï¼‰ã€‚</p><p>å¦‚æœæ‚¨éœ€è¦ç›´æ¥æ§åˆ¶httpå’Œhttpsçš„é€‰é¡¹ï¼Œæ‚¨ä¼ ç¬¬äºŒä¸ªå‚æ•°ç»™<code>robot.http</code>ï¼Œå®ƒå°†é€šè¿‡ node-scoped-http-client ä¼ é€’ç»™ http æˆ–è€… httpsï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">options =</span><br><span class="line">  <span class="comment"># don&#x27;t verify server certificate against a CA, SCARY!</span></span><br><span class="line">  rejectUnauthorized: <span class="literal">false</span></span><br><span class="line">robot.http(<span class="string">&quot;https://midnight-train&quot;</span>, options)</span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œå¦‚æœnode-scoped-http-clientå¹¶ä¸é€‚åˆæ‚¨ï¼Œæ‚¨å¯ä»¥ç›´æ¥ä½¿ç”¨<a target="_blank" rel="noopener" href="http://nodejs.org/api/http.html">http</a>å’Œ<a target="_blank" rel="noopener" href="http://nodejs.org/api/https.html">https</a>ï¼Œæˆ–è€…å…¶å®ƒçš„nodeåº“ï¼Œä¾‹å¦‚ï¼š<a target="_blank" rel="noopener" href="https://github.com/request/request">request</a></p><h3 id="éšæœº"><a href="#éšæœº" class="headerlink" title="éšæœº"></a>éšæœº</h3><p>ä¸€ç§å¸¸è§çš„æ¨¡å¼æ˜¯è†å¬æˆ–å“åº”å‘½ä»¤ï¼Œå¹¶å‘é€éšæœºæœ‰è¶£çš„å›¾åƒæˆ–æ–‡æœ¬ä»ä¸€ä¸ªåŒ…å«å¯èƒ½æ€§çš„æ•°ç»„ã€‚ç›´æ¥ä½¿ç”¨JavaScriptå’ŒCoffeeScriptæ¥å®ç°æ¯”è¾ƒéº»çƒ¦ï¼Œ æ‰€ä»¥ hubot åŒ…æ‹¬ä¸€ä¸ªæ–¹ä¾¿çš„æ–¹æ³•ï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lulz = [<span class="string">&#x27;lol&#x27;</span>, <span class="string">&#x27;rofl&#x27;</span>, <span class="string">&#x27;lmao&#x27;</span>]</span><br><span class="line"></span><br><span class="line">res.send res.random lulz</span><br></pre></td></tr></table></figure><h3 id="ä¸»é¢˜"><a href="#ä¸»é¢˜" class="headerlink" title="ä¸»é¢˜"></a>ä¸»é¢˜</h3><p>Hubot å¯ä»¥å“åº”ä¸€ä¸ªæˆ¿é—´çš„ä¸»é¢˜å˜åŒ–ï¼Œå‡è®¾é€‚é…å™¨æ”¯æŒå®ƒï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  robot.topic (res) -&gt;</span><br><span class="line">    res.send <span class="string">&quot;<span class="subst">#&#123;res.message.text&#125;</span>? That&#x27;s a Paddlin&#x27;&quot;</span></span><br></pre></td></tr></table></figure><h3 id="åŠ å…¥å’Œç¦»å¼€"><a href="#åŠ å…¥å’Œç¦»å¼€" class="headerlink" title="åŠ å…¥å’Œç¦»å¼€"></a>åŠ å…¥å’Œç¦»å¼€</h3><p>Hubot èƒ½å¤Ÿè§‚å¯Ÿç”¨æˆ·çš„åŠ å…¥å’Œç¦»å¼€ï¼Œå‡è®¾é€‚é…å™¨æ”¯æŒå®ƒã€‚</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">enterReplies = [<span class="string">&#x27;Hi&#x27;</span>, <span class="string">&#x27;Target Acquired&#x27;</span>, <span class="string">&#x27;Firing&#x27;</span>, <span class="string">&#x27;Hello friend.&#x27;</span>, <span class="string">&#x27;Gotcha&#x27;</span>, <span class="string">&#x27;I see you&#x27;</span>]</span><br><span class="line">leaveReplies = [<span class="string">&#x27;Are you still there?&#x27;</span>, <span class="string">&#x27;Target lost&#x27;</span>, <span class="string">&#x27;Searching&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  robot.enter (res) -&gt;</span><br><span class="line">    res.send res.random enterReplies</span><br><span class="line">  robot.leave (res) -&gt;</span><br><span class="line">    res.send res.random leaveReplies</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰ç›‘å¬å™¨"><a href="#è‡ªå®šä¹‰ç›‘å¬å™¨" class="headerlink" title="è‡ªå®šä¹‰ç›‘å¬å™¨"></a>è‡ªå®šä¹‰ç›‘å¬å™¨</h3><p>è™½ç„¶ä¸Šé¢çš„ helpers æ¶µç›–äº†æ™®é€šç”¨æˆ·éœ€è¦çš„å¤§éƒ¨åˆ†åŠŸèƒ½ï¼ˆè†å¬ã€å“åº”ã€åŠ å…¥ã€ç¦»å¼€ã€ä¸»é¢˜ï¼‰ï¼Œæœ‰æ—¶æ‚¨æƒ³ä¸ºç›‘å¬å™¨èµ‹äºˆç‰¹å®šçš„åŒ¹é…é€»è¾‘ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>listen</code>æ¥æŒ‡å®šè‡ªå®šä¹‰åŒ¹é…å‡½æ•°æ¥æ›¿ä»£æ­£åˆ™è¡¨è¾¾ã€‚</p><p>å¦‚æœç›‘å¬å™¨å›è°ƒè¦è¢«æ‰§è¡Œï¼ŒåŒ¹é…å‡½æ•°å¿…é¡»è¿”å›çœŸå®å€¼ã€‚ç„¶åå°†åŒ¹é…å‡½æ•°çš„çœŸå®è¿”å›å€¼ç”¨<code>response.match</code>ä¼ é€’ç»™å›è°ƒã€‚</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  robot.listen(</span><br><span class="line">    <span class="function"><span class="params">(message)</span> -&gt;</span> <span class="comment"># Match function</span></span><br><span class="line">      <span class="comment"># Occassionally respond to things that Steve says</span></span><br><span class="line">      message.user.name <span class="keyword">is</span> <span class="string">&quot;Steve&quot;</span> <span class="keyword">and</span> <span class="built_in">Math</span>.random() &gt; <span class="number">0.8</span></span><br><span class="line">    (response) -&gt; <span class="comment"># Standard listener callback</span></span><br><span class="line">      <span class="comment"># Let Steve know how happy you are that he exists</span></span><br><span class="line">      response.reply <span class="string">&quot;HI STEVE! YOU&#x27;RE MY BEST FRIEND! (but only like <span class="subst">#&#123;response.match * <span class="number">100</span>&#125;</span>% of the time)&quot;</span></span><br><span class="line">  )</span><br></pre></td></tr></table></figure><p>æœ‰å…³å¤æ‚çš„åŒ¹é…å™¨ç¤ºä¾‹ï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://hubot.github.com/docs/patterns/">è®¾è®¡æ¨¡å¼æ–‡æ¡£</a>ã€‚</p><h3 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h3><p>Hubot å¯ä»¥ä½¿ç”¨<a target="_blank" rel="noopener" href="http://nodejs.org/api/process.html#process_process_env">process.env</a>è®¿é—®ä»–è¿è¡Œçš„ç¯å¢ƒï¼Œå°±åƒä»»ä½•å…¶ä»–nodeç¨‹åºä¸€æ ·ã€‚è¿™å¯ç”¨äºé…ç½®è„šæœ¬çš„è¿è¡Œæ–¹å¼ï¼Œçº¦å®šä½¿ç”¨<code>HUBOT_</code>å‰ç¼€ã€‚</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">answer = process.env.HUBOT_ANSWER_TO_THE_ULTIMATE_QUESTION_OF_LIFE_THE_UNIVERSE_AND_EVERYTHING</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  robot.respond <span class="regexp">/what is the answer to the ultimate question of life/</span>, <span class="function"><span class="params">(res)</span> -&gt;</span></span><br><span class="line">    res.send <span class="string">&quot;<span class="subst">#&#123;answer&#125;</span>, but what is the question?&quot;</span></span><br></pre></td></tr></table></figure><p>å°å¿ƒçš„å»ç¡®ä¿ç¯å¢ƒå˜é‡æ²¡æœ‰å®šä¹‰æ—¶è„šæœ¬å¯ä»¥åŠ è½½ï¼Œç»™ hubot å¼€å‘è€…å»å®šä¹‰è¯¥ç¯å¢ƒå˜é‡çš„æç¤ºï¼Œæˆ–è€…é»˜è®¤çš„ä¸€äº›ä¸œè¥¿ã€‚ç”±è„šæœ¬ç¼–å†™è€…æ¥å†³å®šè¿™æ˜¯å¦åº”è¯¥æ˜¯ä¸€ä¸ªè‡´å‘½çš„é”™è¯¯ï¼ˆe.g. hubot é€€å‡ºï¼‰ï¼Œä¹Ÿå¯ä»¥åˆ¶ä½œä»»ä½•ä¾èµ–äºå®ƒçš„è„šæœ¬ï¼Œå»è¡¨æ˜å®ƒéœ€è¦é…ç½®ã€‚åœ¨å°½å¯èƒ½å’Œæœ‰æ„ä¹‰æ—¶ï¼Œè„šæœ¬è¿ä½œä¸éœ€è¦ä»»ä½•å…¶å®ƒçš„é…ç½®æ›´å¥½ã€‚</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥é»˜è®¤çš„ä¸œè¥¿ï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">answer = process.env.HUBOT_ANSWER_TO_THE_ULTIMATE_QUESTION_OF_LIFE_THE_UNIVERSE_AND_EVERYTHING <span class="keyword">or</span> <span class="number">42</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  robot.respond <span class="regexp">/what is the answer to the ultimate question of life/</span>, <span class="function"><span class="params">(res)</span> -&gt;</span></span><br><span class="line">    res.send <span class="string">&quot;<span class="subst">#&#123;answer&#125;</span>, but what is the question?&quot;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœç¯å¢ƒå˜é‡æ²¡æœ‰å®šä¹‰ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬é€€å‡ºï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">answer = process.env.HUBOT_ANSWER_TO_THE_ULTIMATE_QUESTION_OF_LIFE_THE_UNIVERSE_AND_EVERYTHING</span><br><span class="line"><span class="keyword">unless</span> answer?</span><br><span class="line">  <span class="built_in">console</span>.log <span class="string">&quot;Missing HUBOT_ANSWER_TO_THE_ULTIMATE_QUESTION_OF_LIFE_THE_UNIVERSE_AND_EVERYTHING in environment: please set and try again&quot;</span></span><br><span class="line">  process.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  robot.respond <span class="regexp">/what is the answer to the ultimate question of life/</span>, <span class="function"><span class="params">(res)</span> -&gt;</span></span><br><span class="line">    res.send <span class="string">&quot;<span class="subst">#&#123;answer&#125;</span>, but what is the question?&quot;</span></span><br></pre></td></tr></table></figure><p>æœ€åï¼Œ æˆ‘ä»¬æ›´æ–°<code>robot.repond</code>å»æ£€æŸ¥å®ƒï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">answer = process.env.HUBOT_ANSWER_TO_THE_ULTIMATE_QUESTION_OF_LIFE_THE_UNIVERSE_AND_EVERYTHING</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  robot.respond <span class="regexp">/what is the answer to the ultimate question of life/</span>, <span class="function"><span class="params">(res)</span> -&gt;</span></span><br><span class="line">    <span class="keyword">unless</span> answer?</span><br><span class="line">      res.send <span class="string">&quot;Missing HUBOT_ANSWER_TO_THE_ULTIMATE_QUESTION_OF_LIFE_THE_UNIVERSE_AND_EVERYTHING in environment: please set and try again&quot;</span></span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    res.send <span class="string">&quot;<span class="subst">#&#123;answer&#125;</span>, but what is the question?&quot;</span></span><br></pre></td></tr></table></figure><h3 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h3><p>Hubot ä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/isaacs/npm">npm</a>å»ç®¡ç†å®ƒçš„ä¾èµ–ã€‚è¦å»æ·»åŠ é¢å¤–çš„åŒ…ï¼Œæ·»åŠ å®ƒä»¬åˆ°<code>package.json</code>æ–‡ä»¶çš„<code>dependencies</code>ä¸­ã€‚ä¾‹å¦‚ï¼Œæ·»åŠ <code>lolimadeupthispackage 1.2.3</code>ï¼Œå¦‚ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">  <span class="attr">&quot;hubot&quot;</span>:         <span class="string">&quot;2.5.5&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;lolimadeupthispackage&quot;</span>: <span class="string">&quot;1.2.3&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚¨ä½¿ç”¨ hubot-scripts ä¸­çš„è„šæœ¬ï¼Œè®°ä¸‹è¦æ·»åŠ çš„è„šæœ¬ä¸­çš„<code>Dependencies</code>æ–‡æ¡£ã€‚å®ƒä»¬ä»¥å¯ä»¥å¤åˆ¶ç²˜è´´è¿›<code>package.json</code>çš„æ ¼å¼åˆ—å‡ºï¼Œåªéœ€ç¡®ä¿æ ¹æ®éœ€è¦æ·»åŠ é€—å·ä½¿å…¶æˆä¸ºæœ‰æ•ˆ JSONå³å¯ã€‚</p><h3 id="è¶…æ—¶å’Œé—´éš”"><a href="#è¶…æ—¶å’Œé—´éš”" class="headerlink" title="è¶…æ—¶å’Œé—´éš”"></a>è¶…æ—¶å’Œé—´éš”</h3><blockquote><p>è¯‘è€…æ³¨ï¼šè¿™é‡Œæ™®åŠJavaScriptçš„<code>setTimeout</code>å’Œ<code>setInterval</code>è¯­æ³•ã€‚</p></blockquote><p>Hubotå¯ä»¥ä½¿ç”¨JavaScriptå†…ç½®çš„<a target="_blank" rel="noopener" href="http://nodejs.org/api/timers.html#timers_settimeout_callback_delay_arg">setTimeout</a>æ¥å»¶è¿Ÿè¿è¡Œä»£ç ã€‚</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  robot.respond <span class="regexp">/you are a little slow/</span>, <span class="function"><span class="params">(res)</span> -&gt;</span></span><br><span class="line">    <span class="built_in">setTimeout</span> () -&gt;</span><br><span class="line">      res.send <span class="string">&quot;Who you calling &#x27;slow&#x27;?&quot;</span></span><br><span class="line">    , <span class="number">60</span> * <span class="number">1000</span></span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œhubotå¯ä»¥ç”¨<a target="_blank" rel="noopener" href="http://nodejs.org/api/timers.html#timers_setinterval_callback_delay_arg">setInterval</a>æ¥é—´éš”è¿è¡Œä»£ç ã€‚å®ƒéœ€è¦å›è°ƒæ–¹æ³•ï¼Œä»¥åŠè°ƒç”¨ä¹‹é—´çš„ç­‰å¾…æ—¶é—´ï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  robot.respond <span class="regexp">/annoy me/</span>, <span class="function"><span class="params">(res)</span> -&gt;</span></span><br><span class="line">    res.send <span class="string">&quot;Hey, want to hear the most annoying sound in the world?&quot;</span></span><br><span class="line">    <span class="built_in">setInterval</span> () -&gt;</span><br><span class="line">      res.send <span class="string">&quot;AAAAAAAAAAAEEEEEEEEEEEEEEEEEEEEEEEEIIIIIIIIHHHHHHHHHH&quot;</span></span><br><span class="line">    , <span class="number">1000</span></span><br></pre></td></tr></table></figure><p><code>setTimeout</code>å’Œ<code>setInterval</code>åˆ›å»ºæ—¶ï¼Œéƒ½è¿”å›è¶…æ—¶æˆ–é—´éš”çš„IDã€‚è¿™å¯ç”¨äº<code>clearTimeout</code>å’Œ<code>clearInterval</code>ã€‚</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  annoyIntervalId = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  robot.respond <span class="regexp">/annoy me/</span>, <span class="function"><span class="params">(res)</span> -&gt;</span></span><br><span class="line">    <span class="keyword">if</span> annoyIntervalId</span><br><span class="line">      res.send <span class="string">&quot;AAAAAAAAAAAEEEEEEEEEEEEEEEEEEEEEEEEIIIIIIIIHHHHHHHHHH&quot;</span></span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    res.send <span class="string">&quot;Hey, want to hear the most annoying sound in the world?&quot;</span></span><br><span class="line">    annoyIntervalId = <span class="built_in">setInterval</span> () -&gt;</span><br><span class="line">      res.send <span class="string">&quot;AAAAAAAAAAAEEEEEEEEEEEEEEEEEEEEEEEEIIIIIIIIHHHHHHHHHH&quot;</span></span><br><span class="line">    , <span class="number">1000</span></span><br><span class="line"></span><br><span class="line">  robot.respond <span class="regexp">/unannoy me/</span>, <span class="function"><span class="params">(res)</span> -&gt;</span></span><br><span class="line">    <span class="keyword">if</span> annoyIntervalId</span><br><span class="line">      res.send <span class="string">&quot;GUYS, GUYS, GUYS!&quot;</span></span><br><span class="line">      <span class="built_in">clearInterval</span>(annoyIntervalId)</span><br><span class="line">      annoyIntervalId = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      res.send <span class="string">&quot;Not annoying you right now, am I?&quot;</span></span><br></pre></td></tr></table></figure><h3 id="HTTP-ç›‘å¬å™¨"><a href="#HTTP-ç›‘å¬å™¨" class="headerlink" title="HTTP ç›‘å¬å™¨"></a>HTTP ç›‘å¬å™¨</h3><p>Hubot åŒ…æ‹¬æ”¯æŒ<a target="_blank" rel="noopener" href="http://expressjs.com/">express</a>ç½‘ç»œæ¡†æ¶ä»¥æ»¡è¶³HTTPè¯·æ±‚ã€‚å®ƒç›‘å¬<code>EXPRESS_PORT</code>æˆ–<code>PORT</code>ç¯å¢ƒå˜é‡æŒ‡å®šçš„ç«¯å£ï¼ˆæŒ‰è¯¥é¡ºåºé¦–é€‰ï¼‰ï¼Œé»˜è®¤å€¼è®¾ç½®ä¸º8080ã€‚ä¸€ä¸ªexpressåº”ç”¨çš„å®ä¾‹å¯åœ¨<code>robot.router</code>ä¸­ã€‚å¯ä»¥é€šè¿‡æŒ‡å®š<code>EXPRESS_USER</code>å’Œ<code>EXPRESS_PASSWORD</code>æ¥ä¿æŠ¤ç”¨æˆ·åå’Œå¯†ç ã€‚é€šè¿‡è®¾ç½®<code>EXPRESS_STATIC</code>å®ƒå¯ä»¥è‡ªåŠ¨ä¸ºé™æ€æ–‡ä»¶æœåŠ¡ã€‚</p><p>æœ€å¸¸è§çš„ç”¨é€”æ˜¯ä¸ºå¸¦æœ‰webhooksçš„æœåŠ¡æä¾›HTTPç«¯ç‚¹å»æ¨é€ï¼Œå¹¶è®©è¿™äº›å‡ºç°åœ¨èŠå¤©ä¸­ã€‚</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  <span class="comment"># the expected value of :room is going to vary by adapter, it might be a numeric id, name, token, or some other value</span></span><br><span class="line">  robot.router.post <span class="string">&#x27;/hubot/chatsecrets/:room&#x27;</span>, <span class="function"><span class="params">(req, res)</span> -&gt;</span></span><br><span class="line">    room   = req.params.room</span><br><span class="line">    data   = <span class="keyword">if</span> req.body.payload? <span class="keyword">then</span> <span class="built_in">JSON</span>.parse req.body.payload <span class="keyword">else</span> req.body</span><br><span class="line">    secret = data.secret</span><br><span class="line"></span><br><span class="line">    robot.messageRoom room, <span class="string">&quot;I have a secret: <span class="subst">#&#123;secret&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    res.send <span class="string">&#x27;OK&#x27;</span></span><br></pre></td></tr></table></figure><p>ç”¨curlæµ‹è¯•å®ƒï¼›å¦è¯·å‚é˜…ä¸‹é¢å…³äº<a target="_blank" rel="noopener" href="https://hubot.github.com/docs/scripting/#error-handling">error handling</a>çš„éƒ¨åˆ†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// raw json, must specify Content-Type: application/json</span><br><span class="line">curl -X POST -H &quot;Content-Type: application/json&quot; -d &#x27;&#123;&quot;secret&quot;:&quot;C-TECH Astronomy&quot;&#125;&#x27; http://127.0.0.1:8080/hubot/chatsecrets/general</span><br><span class="line"></span><br><span class="line">// defaults Content-Type: application/x-www-form-urlencoded, must st payload=...</span><br><span class="line">curl -d &#x27;payload=%7B%22secret%22%3A%22C-TECH+Astronomy%22%7D&#x27; http://127.0.0.1:8080/hubot/chatsecrets/general</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰çš„ç«¯ç‚¹URLsåº”è¯¥ä»¥<code>/hubot</code>èµ·å¤´ï¼ˆæ— è®ºæ‚¨çš„æœºå™¨äººåŠå«ä»€ä¹ˆåå­—ï¼‰ã€‚è¿™ç§ä¸€è‡´æ€§ä½¿å¾—è®¾ç½®webhooksï¼ˆå¯å¤åˆ¶ç²˜è´´çš„URLï¼‰æ›´åŠ å®¹æ˜“ï¼Œå¹¶ä¸”ä¿è¯URLsæ˜¯æœ‰æ•ˆçš„ï¼ˆå¹¶ä¸æ˜¯æ‰€æœ‰çš„botå‘½åéƒ½æ˜¯URLå®‰å…¨çš„ï¼‰ã€‚</p><h3 id="äº‹ä»¶"><a href="#äº‹ä»¶" class="headerlink" title="äº‹ä»¶"></a>äº‹ä»¶</h3><p>Hubot è¿˜å¯ä»¥å“åº”å¯ç”¨äºåœ¨è„šæœ¬ä¹‹é—´ä¼ é€’æ•°æ®çš„äº‹ä»¶ã€‚è¿™æ˜¯é€šè¿‡ä½¿ç”¨<code>robot.emit</code>å’Œ<code>robot.on</code>å°è£…node.jsçš„<a target="_blank" rel="noopener" href="http://nodejs.org/api/events.html#events_class_events_eventemitter">EventEmitter</a>å®ç°çš„ã€‚</p><p>å…¶ä¸­ä¸€ä¸ªç”¨ä¾‹æ˜¯ï¼Œæœ‰ä¸€ä¸ªè„šæœ¬ç”¨äºå¤„ç†ä¸æœåŠ¡çš„äº¤äº’ï¼Œç„¶ååœ¨äº‹ä»¶å‡ºç°æ—¶å‘é€ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªè„šæœ¬ä» GitHub <code>post-commit</code> é’©å­æ¥æ”¶æ•°æ®ï¼Œå½“ commits æ¥æ—¶å‘é€ commits äº‹ä»¶ï¼Œç„¶åå¯¹è¿™äº›æäº¤è¿›è¡Œå¦ä¸€ä¸ªè„šæœ¬è¡Œä¸ºã€‚</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># src/scripts/github-commits.coffee</span></span><br><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  robot.router.post <span class="string">&quot;/hubot/gh-commits&quot;</span>, <span class="function"><span class="params">(req, res)</span> -&gt;</span></span><br><span class="line">    robot.emit <span class="string">&quot;commit&quot;</span>, &#123;</span><br><span class="line">        user    : &#123;&#125;, <span class="comment">#hubot user object</span></span><br><span class="line">        repo    : <span class="string">&#x27;https://github.com/github/hubot&#x27;</span>,</span><br><span class="line">        hash  : <span class="string">&#x27;2e1951c089bd865839328592ff673d2f08153643&#x27;</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># src/scripts/heroku.coffee</span></span><br><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  robot.<span class="literal">on</span> <span class="string">&quot;commit&quot;</span>, <span class="function"><span class="params">(commit)</span> -&gt;</span></span><br><span class="line">    robot.send commit.user, <span class="string">&quot;Will now deploy <span class="subst">#&#123;commit.hash&#125;</span> from <span class="subst">#&#123;commit.repo&#125;</span>!&quot;</span></span><br><span class="line">    <span class="comment">#deploy code goes here</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚¨æä¾›ä¸€ä¸ªäº‹ä»¶ï¼Œå¼ºçƒˆå»ºè®®åœ¨å…¶æ•°æ®ä¸­åŒ…æ‹¬ hubot useræˆ–roomå¯¹è±¡ã€‚è¿™å°†å…è®¸hubot åœ¨èŠå¤©ä¸­é€šçŸ¥ç”¨æˆ·æˆ–æˆ¿é—´ã€‚</p><h3 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h3><p>æ²¡æœ‰å®Œç¾çš„ä»£ç ï¼Œå¹¶ä¸”é”™è¯¯å’Œæ„å¤–æ˜¯æ„æ–™ä¹‹ä¸­çš„ã€‚ä»¥å‰ï¼Œä¸€ä¸ªæœªæ•è·çš„å¼‚å¸¸ä¼šæ˜¯æ‚¨çš„hubotå®ä¾‹å´©æºƒã€‚Hubotç°åœ¨åŒ…å«äº†ä¸€ä¸ª<code>uncaughtException</code>å¤„ç†ç¨‹åºï¼Œå®ƒä¸ºè„šæœ¬æä¾›é’©å­ä»¥æ­¤æ¥è¿›è¡Œé”™è¯¯å¤„ç†ã€‚</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># src/scripts/does-not-compute.coffee</span></span><br><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  robot.error (err, res) -&gt;</span><br><span class="line">    robot.logger.error <span class="string">&quot;DOES NOT COMPUTE&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> res?</span><br><span class="line">      res.reply <span class="string">&quot;DOES NOT COMPUTE&quot;</span></span><br></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥åœ¨è¿™é‡Œåšä»»ä½•æ‚¨æƒ³åšçš„äº‹ï¼Œä½†æ‚¨ä¼šæƒ³é‡‡å–é¢å¤–çš„é¢„é˜²æªæ–½æ¥æ‹¯æ•‘å’Œè®°å½•é”™è¯¯ï¼Œç‰¹åˆ«æ˜¯å¼‚æ­¥ä»£ç ã€‚å¦åˆ™ï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°è‡ªå·±æœ‰é€’å½’çš„é”™è¯¯ï¼Œå´ä¸çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…ã€‚</p><p>åœ¨å¤´å·¾ä¹‹ä¸‹ï¼Œâ€˜errorâ€™äº‹ä»¶å‘å°„å‡ºæ¥ï¼Œä¼´éšç€çš„æ˜¯é”™è¯¯å¤„ç†ç¨‹åºæ¶ˆè´¹é‚£ä¸ªäº‹ä»¶ã€‚<code>uncaughtException</code>å¤„ç†ç¨‹åºï¼Œ<a target="_blank" rel="noopener" href="http://nodejs.org/api/process.html#process_event_uncaughtexception">ä»æŠ€æœ¯ä¸Šè®²ï¼Œ ä½¿è¿‡ç¨‹å¤„äºæœªçŸ¥çŠ¶æ€ã€‚</a>ã€‚å› æ­¤ï¼Œæ— è®ºä½•æ—¶æ‚¨åº”è¯¥å°½å¯èƒ½çš„æ‹¯æ•‘æ‚¨è‡ªå·±çš„å¼‚å¸¸ï¼Œå¹¶ä¸”è‡ªå·±å‘å‡ºå®ƒä»¬ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å‘å‡ºçš„é”™è¯¯ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç”Ÿæˆé”™è¯¯çš„å¯é€‰æ¶ˆæ¯ã€‚<br>ä½¿ç”¨å‰é¢çš„ä¾‹å­ï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">robot.router.post <span class="string">&#x27;/hubot/chatsecrets/:room&#x27;</span>, <span class="function"><span class="params">(req, res)</span> -&gt;</span></span><br><span class="line">  room = req.params.room</span><br><span class="line">  data = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">    data = <span class="built_in">JSON</span>.parse req.body.payload</span><br><span class="line">  <span class="keyword">catch</span> err</span><br><span class="line">    robot.emit <span class="string">&#x27;error&#x27;</span>, err</span><br><span class="line"></span><br><span class="line">  <span class="comment"># rest of the code here</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">robot.hear <span class="regexp">/midnight train/i</span>, <span class="function"><span class="params">(res)</span> -&gt;</span></span><br><span class="line">  robot.http(<span class="string">&quot;https://midnight-train&quot;</span>)</span><br><span class="line">    .get() (err, res, body) -&gt;</span><br><span class="line">      <span class="keyword">if</span> err</span><br><span class="line">        res.reply <span class="string">&quot;Had problems taking the midnight train&quot;</span></span><br><span class="line">        robot.emit <span class="string">&#x27;error&#x27;</span>, err, res</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      <span class="comment"># rest of code here</span></span><br></pre></td></tr></table></figure><p>å¯¹äºç¬¬äºŒä¸ªä¾‹å­ï¼Œå€¼å¾—æ€è€ƒçš„æ˜¯ç”¨æˆ·ä¼šçœ‹åˆ°å“ªäº›æ¶ˆæ¯ã€‚å¦‚æœæ‚¨æœ‰å›å¤ç”¨æˆ·çš„é”™è¯¯å¤„ç†ç¨‹åºï¼Œæ‚¨å¯èƒ½ä¸éœ€è¦æ·»åŠ è‡ªå®šä¹‰æ¶ˆæ¯ï¼Œå¹¶ä¸”å¯ä»¥å‘å›æä¾›ç»™get()è¯·æ±‚çš„é”™è¯¯æ¶ˆæ¯ï¼Œå½“ç„¶è¿™å–å†³äºæ‚¨æƒ³å¤šä¹ˆçš„å…¬å¼€æ‚¨çš„é”™è¯¯æŠ¥å‘Šã€‚</p><h3 id="è„šæœ¬æ–‡æ¡£"><a href="#è„šæœ¬æ–‡æ¡£" class="headerlink" title="è„šæœ¬æ–‡æ¡£"></a>è„šæœ¬æ–‡æ¡£</h3><p>Hubot è„šæœ¬å¯ä»¥ç”¨åœ¨å…¶æ–‡ä»¶é¡¶éƒ¨çš„æ³¨é‡Šç¼–å†™æ–‡æ¡£ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Description:</span></span><br><span class="line"><span class="comment">#   &lt;description of the scripts functionality&gt;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Dependencies:</span></span><br><span class="line"><span class="comment">#   &quot;&lt;module name&gt;&quot;: &quot;&lt;module version&gt;&quot;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Configuration:</span></span><br><span class="line"><span class="comment">#   LIST_OF_ENV_VARS_TO_SET</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Commands:</span></span><br><span class="line"><span class="comment">#   hubot &lt;trigger&gt; - &lt;what the respond trigger does&gt;</span></span><br><span class="line"><span class="comment">#   &lt;trigger&gt; - &lt;what the hear trigger does&gt;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Notes:</span></span><br><span class="line"><span class="comment">#   &lt;optional notes required for the script&gt;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Author:</span></span><br><span class="line"><span class="comment">#   &lt;github username of the original script author&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æœ€é‡è¦çš„å’Œç”¨æˆ·é¢å‘çš„æ˜¯<code>Commands</code>ã€‚åœ¨åŠ è½½æ—¶é—´ï¼ŒHubot æŸ¥çœ‹æ¯ä¸ªè„šæœ¬çš„å‘½ä»¤éƒ¨åˆ†ï¼Œå¹¶å»ºç«‹æ‰€æœ‰å‘½ä»¤çš„åˆ—è¡¨ã€‚åŒ…å«çš„<code>help.coffee</code>å…è®¸ç”¨æˆ·åœ¨æ‰€æœ‰å‘½ä»¤æˆ–æœç´¢ä¸­å¯»æ±‚å¸®åŠ©ã€‚å› æ­¤ï¼Œä¸ºè¿™äº›å‘½ä»¤åˆ¶ä½œæ–‡æ¡£ä½¿ç”¨æˆ·æ›´å®¹æ˜“å‘ç°è¿™äº›å‘½ä»¤ã€‚</p><p>ä¸ºå‘½ä»¤åˆ¶ä½œæ–‡æ¡£çš„æ—¶å€™ï¼Œè¿™é‡Œæœ‰ä¸€äº›æœ€ä½³å®è·µï¼š</p><ul><li>ä¿æŒåœ¨ä¸€è¡Œã€‚å¸®åŠ©å‘½ä»¤ä¼šè¢«æ’åºï¼Œå› æ­¤ç¬¬äºŒè¡Œå¯èƒ½ä¼šè¢«æ’åˆ°ä¸€ä¸ªå‡ºä¹æ„æ–™çš„çš„åœ°æ–¹ï¼Œä½¿å¾—å®ƒæ²¡æœ‰æ„ä¹‰ã€‚</li><li>å°† Hubot å‘½åä¸º hubotï¼Œå³ä½¿æ‚¨çš„ hubot è¢«å‘½åä¸ºå…¶å®ƒã€‚å®ƒå°†è¢«è‡ªåŠ¨æ›¿æ¢ä¸ºæ­£ç¡®çš„åå­—ã€‚è¿™ä½¿å¾—æ— éœ€æ›´æ–°æ–‡æ¡£å³å¯è½»æ¾å…±äº«è„šæœ¬ã€‚</li><li>å¯¹äº<code>robot.respond</code>æ–‡æ¡£ï¼Œæ€»æ˜¯ä»¥<code>hubot</code>ä½œä¸ºå‰ç¼€ã€‚Hubotå°†è‡ªåŠ¨ç”¨æ‚¨çš„æœºå™¨äººåå­—æˆ–è€…æœºå™¨äººçš„åˆ«åæ›¿æ¢ã€‚</li><li>æŸ¥çœ‹ man æ‰‹å†Œæ–‡æ¡£æ˜¯æ€æ ·åˆ¶ä½œè‡ªå·±çš„æ–‡æ¡£çš„ã€‚ç‰¹åˆ«æ˜¯ï¼Œæ‹¬å·è¡¨ç¤ºå¯é€‰é¡¹ï¼Œâ€â€¦â€è¡¨ç¤ºä»»æ„æ•°é‡çš„å‚æ•°ï¼Œç­‰ã€‚</li></ul><p>æ–‡æ¡£çš„å…¶å®ƒéƒ¨åˆ†ä¸botçš„å¼€å‘äººå‘˜æ›´ç›¸å…³ï¼Œå°¤å…¶æ˜¯ä¾èµ–ã€é…ç½®å˜é‡å’Œè¯´æ˜ã€‚å¯¹<a target="_blank" rel="noopener" href="https://github.com/github/hubot-scripts">hubot-scripts</a>çš„æ‰€æœ‰è´¡çŒ®åº”åŒ…å«ä¸è„šæœ¬å¯åŠ¨å’Œè¿è¡Œç›¸å…³çš„æ‰€æœ‰è¿™äº›éƒ¨åˆ†ã€‚</p><h3 id="æŒä¹…åŒ–"><a href="#æŒä¹…åŒ–" class="headerlink" title="æŒä¹…åŒ–"></a>æŒä¹…åŒ–</h3><p>Hubotæš´éœ²<code>robot.brain</code>å†…å­˜é”®å€¼å­˜å‚¨ï¼Œå¯ç”¨äºé€šè¿‡è„šæœ¬å­˜å‚¨å’Œæ£€ç´¢æ•°æ®ã€‚</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">robot.respond <span class="regexp">/have a soda/i</span>, <span class="function"><span class="params">(res)</span> -&gt;</span></span><br><span class="line">  <span class="comment"># Get number of sodas had (coerced to a number).</span></span><br><span class="line">  sodasHad = robot.brain.get(<span class="string">&#x27;totalSodas&#x27;</span>) * <span class="number">1</span> <span class="keyword">or</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> sodasHad &gt; <span class="number">4</span></span><br><span class="line">    res.reply <span class="string">&quot;I&#x27;m too fizzy..&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    res.reply <span class="string">&#x27;Sure!&#x27;</span></span><br><span class="line"></span><br><span class="line">    robot.brain.set <span class="string">&#x27;totalSodas&#x27;</span>, sodasHad+<span class="number">1</span></span><br><span class="line">robot.respond <span class="regexp">/sleep it off/i</span>, <span class="function"><span class="params">(res)</span> -&gt;</span></span><br><span class="line">  robot.brain.set <span class="string">&#x27;totalSodas&#x27;</span>, <span class="number">0</span></span><br><span class="line">  msg.reply <span class="string">&#x27;zzzzz&#x27;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœè„šæœ¬éœ€è¦æ£€ç´¢ç”¨æˆ·æ•°æ®ï¼Œ<code>robot.brain</code>ä¸Šæœ‰äº›æ–¹æ³•é€šè¿‡idï¼Œnameï¼Œæˆ–è€…nameçš„æ¨¡ç³ŠåŒ¹é…ï¼š<code>userForName</code>, <code>userForId</code>, <code>userForFuzzyName</code>å’Œ<code>usersForFuzzyName</code>å»æŸ¥æ‰¾ä¸€ä¸ªæˆ–è€…å¤šä¸ªç”¨æˆ·ã€‚</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line"></span><br><span class="line">  robot.respond <span class="regexp">/who is @?([\w .\-]+)\?*$/i</span>, <span class="function"><span class="params">(res)</span> -&gt;</span></span><br><span class="line">    name = res.match[<span class="number">1</span>].trim()</span><br><span class="line"></span><br><span class="line">    users = robot.brain.usersForFuzzyName(name)</span><br><span class="line">    <span class="keyword">if</span> users.length <span class="keyword">is</span> <span class="number">1</span></span><br><span class="line">      user = users[<span class="number">0</span>]</span><br><span class="line">      <span class="comment"># Do something interesting here..</span></span><br><span class="line"></span><br><span class="line">      res.send <span class="string">&quot;<span class="subst">#&#123;name&#125;</span> is user - <span class="subst">#&#123;user&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><h3 id="è„šæœ¬åŠ è½½"><a href="#è„šæœ¬åŠ è½½" class="headerlink" title="è„šæœ¬åŠ è½½"></a>è„šæœ¬åŠ è½½</h3><p>åŠ è½½è„šæœ¬æœ‰ä¸‰ä¸ªä¸»è¦æ¥æºï¼š</p><ul><li><code>scripts/</code>ç›®å½•ä¸‹çš„æ‰€æœ‰è„šæœ¬éƒ½ä¸æ‚¨çš„ hubot ç»‘å®šã€‚</li><li><code>hubot-scripts.json</code>ä¸­æŒ‡å®šçš„ç¤¾åŒºè„šæœ¬ï¼Œå¹¶å‘å¸ƒåœ¨ <code>hubot-scripts</code> npm åŒ…ã€‚</li><li>è„šæœ¬ä»å¤–éƒ¨ npm åŒ…åŠ è½½ï¼Œ å¹¶åœ¨ <code>external-scripts.json</code> ä¸­æŒ‡å®šã€‚</li></ul><p>ä»<code>scripts/</code>ç›®å½•ä¸­åŠ è½½çš„è„šæœ¬æŒ‰å­—æ¯é¡ºåºåŠ è½½ï¼Œå› æ­¤æ‚¨å¯ä»¥é¢„æœŸè„šæœ¬çš„ä¸€è‡´åŠ è½½é¡ºåºã€‚ä¾‹å¦‚ï¼š</p><ul><li><code>scripts/1-first.coffee</code></li><li><code>scripts/_second.coffee</code></li><li><code>scripts/third.coffee</code></li></ul><h3 id="åˆ†äº«è„šæœ¬"><a href="#åˆ†äº«è„šæœ¬" class="headerlink" title="åˆ†äº«è„šæœ¬"></a>åˆ†äº«è„šæœ¬</h3><p>ä¸€æ—¦æ‚¨æ„å»ºäº†ä¸€äº›æ–°çš„è„šæœ¬ï¼Œä»¥æ‰©å¤§æ‚¨çš„æœºå™¨äººæœ‹å‹çš„èƒ½åŠ›ï¼Œæ‚¨åº”è¯¥è€ƒè™‘ä¸ä¸–ç•Œåˆ†äº«ä»–ä»¬ï¼è‡³å°‘ï¼Œæ‚¨éœ€è¦æ‰“åŒ…è„šæœ¬å¹¶å°†å…¶æäº¤åˆ° <code>Node.js ç¨‹åºåŒ…ä»“åº“</code>ã€‚æ‚¨è¿˜åº”æŸ¥çœ‹ä»¥ä¸‹å…±äº«è„šæœ¬çš„æœ€ä½³å®è·µã€‚</p><h4 id="æŸ¥çœ‹è„šæœ¬æ˜¯å¦å·²å­˜åœ¨"><a href="#æŸ¥çœ‹è„šæœ¬æ˜¯å¦å·²å­˜åœ¨" class="headerlink" title="æŸ¥çœ‹è„šæœ¬æ˜¯å¦å·²å­˜åœ¨"></a>æŸ¥çœ‹è„šæœ¬æ˜¯å¦å·²å­˜åœ¨</h4><p>é¦–å…ˆ<a target="_blank" rel="noopener" href="https://hubot.github.com/docs/#scripts">æ£€æŸ¥åƒæ‚¨è¿™æ ·çš„è„šæœ¬çš„ NPM åŒ…æ˜¯å¦å·²ç»å­˜åœ¨</a>ã€‚å¦‚æœæ‚¨æ²¡æœ‰çœ‹åˆ°å¯ä»¥è´¡çŒ®çš„ç°æœ‰åŒ…ï¼Œåˆ™å¯ä»¥è½»æ¾åœ°å¼€å§‹ä½¿ç”¨ hubot è„šæœ¬ <a target="_blank" rel="noopener" href="http://yeoman.io/">yeoman</a> ç”Ÿæˆå™¨ã€‚</p><h4 id="åˆ›å»ºä¸€ä¸ªè„šæœ¬ç¨‹åºåŒ…"><a href="#åˆ›å»ºä¸€ä¸ªè„šæœ¬ç¨‹åºåŒ…" class="headerlink" title="åˆ›å»ºä¸€ä¸ªè„šæœ¬ç¨‹åºåŒ…"></a>åˆ›å»ºä¸€ä¸ªè„šæœ¬ç¨‹åºåŒ…</h4><p>ä¸º hubot åˆ›å»ºè„šæœ¬åŒ…éå¸¸ç®€å•ã€‚é¦–å…ˆå®‰è£…<a target="_blank" rel="noopener" href="http://yeoman.io/">yeoman</a>ç”Ÿæˆå™¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm install -g yo generator-hubot</span></span><br></pre></td></tr></table></figure><p>å®‰è£…hubotç”Ÿæˆå™¨åï¼Œåˆ›å»ºhubotè„šæœ¬ç±»ä¼¼äºåˆ›å»ºä¸€ä¸ªæ–°çš„hubotã€‚æ‚¨ä¸ºæ‚¨çš„hubotè„šæœ¬åˆ›å»ºç›®å½•ï¼Œå¹¶åœ¨å…¶ä¸­ç”Ÿæˆä¸€ä¸ªæ–°çš„<code>hubot:script</code>ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ª hubot è„šæœ¬å«â€œmy-awesome-scriptâ€:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir hubot-my-awesome-script</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> hubot-my-awesome-script</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yo hubot:script</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œæ‚¨ä¼šè¢«é—®åˆ°ä¸€äº›æœ‰å…³è„šæœ¬ä½œè€…çš„é—®é¢˜ï¼Œè„šæœ¬çš„åå­—ï¼ˆç”±ç›®å½•åçŒœæµ‹ï¼‰ï¼Œä¸€ä¸ªç®€çŸ­çš„æè¿°ï¼Œå’Œå»æŸ¥æ‰¾å®ƒçš„å…³é”®å­—ï¼ˆæˆ‘ä»¬å»ºè®®è‡³å°‘æœ‰<code>hubot</code>ï¼Œ<code>hubot-scripts</code>ï¼‰ã€‚</p><p>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ gitï¼Œç”Ÿæˆçš„ç›®å½•åŒ…å«ä¸€ä¸ª <code>.gitignore</code>ï¼Œå› æ­¤æ‚¨å¯ä»¥åˆå§‹åŒ–å¹¶æ·»åŠ æ‰€æœ‰å†…å®¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git init</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git add .</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git commit -m <span class="string">&quot;Initial commit&quot;</span></span></span><br></pre></td></tr></table></figure><p>æ‚¨ç°åœ¨æœ‰ä¸€ä¸ªå‡†å¤‡å¥½å»å¯åŠ¨çš„hubotè„šæœ¬åº“ã€‚è½»æ¾æ‰“å¼€é¢„åˆ›å»ºçš„<code>src/awesome-script.coffee</code>æ–‡ä»¶ï¼Œå¹¶å¼€å§‹æ„å»ºæ‚¨çš„è„šæœ¬ï¼å‡†å¤‡å¥½åï¼Œæ‚¨å¯ä»¥<a target="_blank" rel="noopener" href="https://docs.npmjs.com/getting-started/publishing-npm-packages">æŒ‰ç…§ä»–ä»¬çš„æ–‡æ¡£</a>å°†å…¶å‘å¸ƒåˆ° <a target="_blank" rel="noopener" href="http://npmjs.org/">npmjs</a>ï¼</p><p>æ‚¨å¯èƒ½éœ€è¦ä¸ºæ–°è„šæœ¬ç¼–å†™ä¸€äº›å•å…ƒæµ‹è¯•ã€‚æµ‹è¯•è„šæœ¬æ ·ä¾‹å†™åœ¨<code>test/awesome-script-test.coffee</code>ï¼Œæ‚¨å¯ä»¥ç”¨<code>grunt</code>è¿è¡Œã€‚æœ‰å…³æµ‹è¯•çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://hubot.github.com/docs/scripting/#testing-hubot-scripts">æµ‹è¯•Hubotè„šæœ¬</a>éƒ¨åˆ†ã€‚</p><h3 id="ç›‘å¬å™¨å…ƒæ•°æ®"><a href="#ç›‘å¬å™¨å…ƒæ•°æ®" class="headerlink" title="ç›‘å¬å™¨å…ƒæ•°æ®"></a>ç›‘å¬å™¨å…ƒæ•°æ®</h3><p>é™¤äº†æ­£åˆ™è¡¨è¾¾å’Œå›è°ƒï¼Œ<code>hear</code>å’Œ<code>respond</code>å‡½æ•°è¿˜æ¥å—ä¸€ä¸ªå¯é€‰çš„é€‰é¡¹å¯¹è±¡ï¼Œå®ƒå¯ä»¥è¢«ç”¨äºé™„åŠ ä»»æ„å…ƒæ•°æ®åˆ°ç”Ÿæˆçš„ç›‘å¬å™¨å¯¹è±¡ã€‚æ­¤å…ƒæ•°æ®å…è®¸åœ¨ä¸ä¿®æ”¹è„šæœ¬åŒ…çš„æƒ…å†µä¸‹è½»æ¾æ‰©å±•è„šæœ¬çš„è¡Œä¸ºã€‚</p><p>æœ€é‡è¦å’Œæœ€å¸¸ç”¨çš„å…ƒæ•°æ®é”®æ˜¯<code>id</code>ã€‚æ¯ä¸ªç›‘å¬å™¨åº”è¯¥è¢«èµ‹äºˆä¸€ä¸ªå”¯ä¸€çš„åå­—ï¼ˆoptions.idï¼Œé»˜è®¤æ˜¯<code>null</code>ï¼‰ã€‚åç§°åº”æŒ‰æ¨¡å—åˆ’åˆ†ï¼ˆe.g. â€˜my-module.my-listenerâ€™ï¼‰ã€‚è¿™äº›åç§°å…è®¸å…¶ä»–è„šæœ¬ç›´æ¥é’ˆå¯¹å•ä¸ªç›‘å¬å™¨ï¼Œå¹¶æ‰©å±•å®ƒä»¬çš„å…¶ä»–åŠŸèƒ½ï¼Œå¦‚æˆæƒå’Œé€Ÿç‡é™åˆ¶ã€‚</p><p>å…¶ä»–æ‰©å±•å¯ä»¥å®šä¹‰å’Œå¤„ç†å…¶ä»–å…ƒæ•°æ®é”®ã€‚æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://hubot.github.com/docs/scripting/#listener-middleware">Listener Middleware section</a>éƒ¨åˆ†ã€‚</p><p>å›åˆ°åˆ°è¾ƒæ—©çš„ç¤ºä¾‹ï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  robot.respond <span class="regexp">/annoy me/</span>, id:<span class="string">&#x27;annoyance.start&#x27;</span>, (msg)</span><br><span class="line">    <span class="comment"># code to annoy someone</span></span><br><span class="line"></span><br><span class="line">  robot.respond <span class="regexp">/unannoy me/</span>, id:<span class="string">&#x27;annoyance.stop&#x27;</span>, (msg)</span><br><span class="line">    <span class="comment"># code to stop annoying someone</span></span><br></pre></td></tr></table></figure><p>è¿™äº›èŒƒå›´æ ‡è¯†ç¬¦å…è®¸æ‚¨å¤–éƒ¨æŒ‡å®šæ–°è¡Œä¸ºï¼Œå¦‚ï¼š</p><ul><li>æˆæƒæ”¿ç­–ï¼š â€œå…è®¸<code>annoyers</code>ç»„ä¸­çš„æ¯ä¸ªäººæ‰§è¡Œ<code>annoyance.*</code>å‘½ä»¤â€</li><li>é™é€Ÿï¼šâ€œåªå…è®¸30åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡<code>annoyance.start</code>â€</li></ul><h3 id="ä¸­é—´ä»¶"><a href="#ä¸­é—´ä»¶" class="headerlink" title="ä¸­é—´ä»¶"></a>ä¸­é—´ä»¶</h3><p>æœ‰ä¸‰ç§ä¸­é—´ä»¶ï¼š Receive, Listener and Responseã€‚</p><p>åœ¨ç›‘å¬å™¨è¢«æŸ¥çœ‹ä¹‹å‰ï¼ŒReceive ä¸­é—´ä»¶æ‰§è¡Œä¸€æ¬¡ã€‚Listener ä¸­é—´ä»¶åœ¨ç›‘å¬å™¨åŒ¹é…åˆ°ä¿¡æ¯åæ‰§è¡Œã€‚Response ä¸­é—´ä»¶åœ¨æ¯æ¬¡å“åº”ä¸€ä¸ªæ¶ˆæ¯æ—¶è¿è¡Œã€‚</p><h4 id="æ‰§è¡Œè¿‡ç¨‹å’Œ-API"><a href="#æ‰§è¡Œè¿‡ç¨‹å’Œ-API" class="headerlink" title="æ‰§è¡Œè¿‡ç¨‹å’Œ API"></a>æ‰§è¡Œè¿‡ç¨‹å’Œ API</h4><p>ç±»ä¼¼äº<a target="_blank" rel="noopener" href="http://expressjs.com/api.html#middleware">Express middleware</a>ï¼Œhubot æŒ‰å®šä¹‰é¡ºåºæ‰§è¡Œä¸­é—´ä»¶ã€‚æ¯ä¸ªä¸­é—´ä»¶å¯ä»¥ç»§ç»­é“¾ï¼ˆé€šè¿‡è°ƒç”¨<code>next</code>ï¼‰æˆ–ä¸­æ–­é“¾ï¼ˆé€šè¿‡è°ƒç”¨<code>done</code>ï¼‰ã€‚å¦‚æœæ‰€æœ‰ä¸­é—´ä»¶ç»§ç»­ï¼Œç›‘å¬å™¨å›è°ƒè¢«æ‰§è¡Œï¼Œå¹¶ä¸”<code>done</code>ä¼šè¢«è°ƒç”¨ã€‚ä¸­é—´ä»¶å¯ä»¥åŒ…è£…<code>done</code>çš„å›è°ƒï¼Œä»¥ä¾¿åœ¨è¿‡ç¨‹çš„ååŠéƒ¨åˆ†æ‰§è¡Œä»£ç ï¼ˆåœ¨æ‰§è¡Œäº†ç›‘å¬å™¨å›è°ƒæˆ–æ›´æ·±çš„ä¸­é—´ä»¶ä¸­æ–­ä¹‹åï¼‰ã€‚</p><p>ä¸­é—´ä»¶è¢«è°ƒç”¨ï¼š</p><ul><li><code>context</code><ul><li>æŸ¥çœ‹æ¯ä¸ªä¸­é—´ä»¶ç±»å‹çš„ APIï¼ŒæŸ¥çœ‹ä¸Šä¸‹æ–‡æš´éœ²çš„å†…å®¹ã€‚</li></ul></li><li><code>next</code><ul><li>ä¸€ä¸ªæ²¡æœ‰é¢å¤–çš„å±æ€§çš„å‡½æ•°ï¼Œå®ƒåº”è¯¥è¢«è°ƒç”¨ä»è€Œç»§ç»­åˆ°ä¸‹ä¸€å—ä¸­é—´ä»¶/æ‰§è¡Œç›‘å¬å™¨çš„å›è°ƒ</li><li><code>next</code>åº”è¯¥ç”¨ä¸€ä¸ªå•ç‹¬çš„ã€å¯é€‰çš„å‚æ•°è°ƒç”¨ï¼šè¦ä¹ˆæä¾›<code>done</code>å‡½æ•°ï¼Œè¦ä¹ˆä¸€ä¸ªæœ€ç»ˆè°ƒç”¨çš„æ—¶å€™å«<code>done</code>çš„æ–°å‡½æ•°ã€‚å¦‚æœå‚æ•°æ²¡æœ‰æŒ‡å®šï¼Œé‚£ä¹ˆå°†å‡å®šä¸º<code>done</code>ã€‚</li></ul></li><li><code>done</code><ul><li>ä¸€ä¸ªæ²¡æœ‰é™„åŠ å±æ€§çš„å‡½æ•°ï¼Œç”¨äºåœ¨ä¸­æ–­ä¸­é—´ä»¶æ‰§è¡Œæ—¶è°ƒç”¨ï¼Œå¹¶å¼€å§‹æ‰§è¡Œå®ŒæˆåŠŸèƒ½çš„é“¾ã€‚</li><li><code>done</code>åœ¨è°ƒç”¨æ—¶æ— éœ€ä»»ä½•å‚æ•°ã€‚</li></ul></li></ul><p>æ¯ä¸ªä¸­é—´ä»¶æ¥æ”¶ç›¸åŒçš„<code>context</code>ã€<code>next</code>å’Œ<code>done</code>çš„APIç­¾åã€‚ä¸åŒç§ç±»çš„ä¸­é—´ä»¶åœ¨<code>context</code>å¯¹è±¡ä¸­å¯èƒ½æ¥æ”¶åˆ°ä¸åŒçš„ä¿¡æ¯ã€‚è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æ¯ç§ç±»å‹çš„ä¸­é—´ä»¶çš„ APIã€‚</p><h4 id="é”™è¯¯å¤„ç†-1"><a href="#é”™è¯¯å¤„ç†-1" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h4><p>å¯¹äºåŒæ­¥ä¸­é—´ä»¶ï¼ˆä»ä¸äº§ç”Ÿäº‹ä»¶å¾ªç¯ï¼‰ï¼Œhubot ä¼šè‡ªåŠ¨æ•è·é”™è¯¯å¹¶å‘å‡º<code>error</code>äº‹ä»¶ï¼Œå°±åƒæ ‡å‡†çš„ç›‘å¬å™¨ä¸€æ ·ã€‚Hubot è¿˜å°†è‡ªåŠ¨è°ƒç”¨æœ€è¿‘<code>done</code>çš„å›è°ƒä»¥è§£é™¤ä¸­é—´ä»¶å †æ ˆã€‚å¼‚æ­¥ä¸­é—´ä»¶åº”è¡¥æ•è·è‡ªå·±çš„å¼‚å¸¸ï¼Œå‘å‡º<code>error</code>äº‹ä»¶ï¼Œå¹¶è°ƒç”¨<code>done</code>ã€‚ä»»ä½•æœªæ•è·çš„å¼‚å¸¸éƒ½ä¼šä¸­æ–­æ‰€æœ‰ä¸­é—´ä»¶å®Œæˆå›è°ƒçš„æ‰§è¡Œã€‚</p><h3 id="Listener-ä¸­é—´ä»¶"><a href="#Listener-ä¸­é—´ä»¶" class="headerlink" title="Listener ä¸­é—´ä»¶"></a>Listener ä¸­é—´ä»¶</h3><p>Listener ä¸­é—´ä»¶åœ¨åŒ¹é…æ¶ˆæ¯çš„ç›‘å¬å™¨å’Œç›‘å¬å™¨æ‰§è¡Œä¹‹é—´æ’å…¥é€»è¾‘ã€‚è¿™å…è®¸æ‚¨åˆ›å»ºä¸ºæ¯ä¸ªåŒ¹é…è„šæœ¬è¿è¡Œçš„æ‰©å±•ã€‚ç¤ºä¾‹åŒ…æ‹¬é›†ä¸­æˆæƒç­–ç•¥ã€é™é€Ÿã€è®°å½•å’ŒæŒ‡æ ‡ã€‚ä¸­é—´ä»¶åƒå…¶ä»– hubot è„šæœ¬ä¸€æ ·å®ç°ï¼šä¸­é—´ä»¶ä¸æ˜¯ä½¿ç”¨<code>hear</code>å’Œ<code>respond</code>æ–¹æ³•ï¼Œè€Œæ˜¯é€šè¿‡<code>listenerMiddleware</code>æ³¨å†Œã€‚</p><h4 id="Listener-ä¸­é—´ä»¶ç¤ºä¾‹"><a href="#Listener-ä¸­é—´ä»¶ç¤ºä¾‹" class="headerlink" title="Listener ä¸­é—´ä»¶ç¤ºä¾‹"></a>Listener ä¸­é—´ä»¶ç¤ºä¾‹</h4><p>åœ¨<a target="_blank" rel="noopener" href="https://github.com/michaelansel/hubot-rate-limit/blob/master/src/rate-limit.coffee">hubot-rate-limit</a>ä¸­å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„ä¾‹å­ã€‚</p><p>ä¸€ä¸ªä¸­é—´ä»¶loggingå‘½ä»¤æ‰§è¡Œçš„ç®€å•ç¤ºä¾‹ï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  robot.listenerMiddleware (context, next, done) -&gt;</span><br><span class="line">    <span class="comment"># Log commands</span></span><br><span class="line">    robot.logger.info <span class="string">&quot;<span class="subst">#&#123;context.response.message.user.name&#125;</span> asked me to <span class="subst">#&#123;context.response.message.text&#125;</span>&quot;</span></span><br><span class="line">    <span class="comment"># Continue executing middleware</span></span><br><span class="line">    next()</span><br></pre></td></tr></table></figure><p>åœ¨æ­¤ç¤ºä¾‹ï¼Œå°†ä¸ºä¸ç›‘å¬å™¨åŒ¹é…çš„æ¯ä¸ªèŠå¤©æ¶ˆæ¯å†™å…¥æ—¥å¿—æ¶ˆæ¯ã€‚</p><p>åšå‡ºé™é€Ÿå†³ç­–çš„æ›´å¤æ‚ç¤ºä¾‹ï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  <span class="comment"># Map of listener ID to last time it was executed</span></span><br><span class="line">  lastExecutedTime = &#123;&#125;</span><br><span class="line"></span><br><span class="line">  robot.listenerMiddleware (context, next, done) -&gt;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">      <span class="comment"># Default to 1s unless listener provides a different minimum period</span></span><br><span class="line">      minPeriodMs = context.listener.options?.rateLimits?.minPeriodMs? <span class="keyword">or</span> <span class="number">1000</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># See if command has been executed recently</span></span><br><span class="line">      <span class="keyword">if</span> lastExecutedTime.hasOwnProperty(context.listener.options.id) <span class="keyword">and</span></span><br><span class="line">         lastExecutedTime[context.listener.options.id] &gt; <span class="built_in">Date</span>.now() - minPeriodMs</span><br><span class="line">        <span class="comment"># Command is being executed too quickly!</span></span><br><span class="line">        done()</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        next -&gt;</span><br><span class="line">          lastExecutedTime[context.listener.options.id] = <span class="built_in">Date</span>.now()</span><br><span class="line">          done()</span><br><span class="line">    <span class="keyword">catch</span> err</span><br><span class="line">      robot.emit(<span class="string">&#x27;error&#x27;</span>, err, context.response)</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸­é—´ä»¶æ£€æŸ¥ç›‘å¬å™¨æ˜¯å¦åœ¨è¿‡å»1000msä¸­æ‰§è¡Œè¿‡ã€‚å¦‚æœæœ‰ï¼Œä¸­é—´ä»¶ç«‹é©¬è°ƒç”¨<code>done</code>ï¼Œé˜²æ­¢ç›‘å¬å™¨å›è°ƒè¢«è°ƒç”¨ã€‚å¦‚æœç›‘å¬å™¨å…è®¸è¢«æ‰§è¡Œï¼Œä¸­é—´ä»¶é™„åŠ ä¸€ä¸ª<code>done</code>å¤„ç†å™¨ï¼Œä»¥ä¾¿å®ƒå¯ä»¥è®°å½•ç›‘å¬å™¨å®Œæˆæ‰§è¡Œçš„æ—¶é—´ã€‚</p><p>æ­¤ç¤ºä¾‹è¿˜æ˜¾ç¤ºäº†å¦‚ä½•åˆ©ç”¨ç‰¹å®šäºç›‘å¬å™¨çš„å…ƒæ•°æ®åˆ›å»ºéå¸¸å¼ºå¤§çš„æ‰©å±•ï¼šè„šæœ¬å¼€å‘äººå‘˜åªéœ€æ·»åŠ ä¸­é—´ä»¶å¹¶è®¾ç½®ç›‘å¬å™¨é€‰é¡¹ï¼Œå³å¯ä½¿ç”¨é€Ÿç‡é™åˆ¶ä¸­é—´ä»¶å»ä»¥ä¸åŒé€Ÿç‡è½»æ¾ç‡é™åˆ¶å‘½ä»¤ã€‚</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  robot.hear <span class="regexp">/hello/</span>, id: <span class="string">&#x27;my-hello&#x27;</span>, rateLimits: &#123;minPeriodMs: <span class="number">10000</span>&#125;, <span class="function"><span class="params">(msg)</span> -&gt;</span></span><br><span class="line">    <span class="comment"># This will execute no faster than once every ten seconds</span></span><br><span class="line">    msg.reply <span class="string">&#x27;Why, hello there!&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="Listener-ä¸­é—´ä»¶-API"><a href="#Listener-ä¸­é—´ä»¶-API" class="headerlink" title="Listener ä¸­é—´ä»¶ API"></a>Listener ä¸­é—´ä»¶ API</h4><p>Listener ä¸­é—´ä»¶å›è°ƒæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œ<code>context</code>ã€<code>next</code>ã€<code>done</code>ã€‚æœ‰å…³<code>next</code>å’Œ<code>done</code>çš„æè¿°ï¼ŒæŸ¥çœ‹<a target="_blank" rel="noopener" href="https://hubot.github.com/docs/scripting/#execution-process-and-api">ä¸­é—´ä»¶API</a>ã€‚Listener ä¸­é—´ä»¶ä¸Šä¸‹æ–‡åŒ…å«è¿™äº›å­—æ®µï¼š</p><ul><li><code>listener</code><ul><li><code>options</code>ï¼šå®šä¹‰ç›‘å¬å™¨æ—¶è®¾ç½®çš„ä¸€ä¸ªç®€å•çš„åŒ…å«é€‰é¡¹çš„å¯¹è±¡ã€‚æŸ¥çœ‹<a target="_blank" rel="noopener" href="https://hubot.github.com/docs/scripting/#listener-metadata">ç›‘å¬å™¨å…ƒæ•°æ®</a>ã€‚</li><li>æ‰€æœ‰å…¶ä»–å±æ€§åº”è§†ä¸ºå†…éƒ¨å±æ€§ã€‚</li></ul></li><li><code>response</code><ul><li>æ ‡å‡†response API çš„æ‰€æœ‰éƒ¨åˆ†éƒ½åŒ…å«åœ¨ä¸­é—´ä»¶ API ä¸­ã€‚æŸ¥çœ‹<a target="_blank" rel="noopener" href="https://hubot.github.com/docs/scripting/#send--reply">å‘é€å’Œå›å¤</a>ã€‚</li><li>ä¸­é—´ä»¶å¯ä»¥ç”¨å…¶ä»–ä¿¡æ¯è£…é¥°ï¼ˆä½†ä¸ä¿®æ”¹ï¼‰å“åº”å¯¹è±¡ï¼ˆe.g. ä¾‹å¦‚å°†æºå¸¦ç”¨æˆ·çš„ LDAP ç»„çš„å±æ€§æ·»åŠ åˆ°<code>response.message.user</code>ï¼‰</li><li>æ³¨æ„ï¼šæ–‡æœ¬æ¶ˆæ¯ï¼ˆ<code>response.message.text</code>ï¼‰åœ¨ç›‘å¬å™¨ä¸­é—´ä»¶ä¸­åº”è¯¥è¢«è®¤ä¸ºæ˜¯ä¸å¯å˜çš„ã€‚</li></ul></li></ul><h3 id="Receive-ä¸­é—´ä»¶"><a href="#Receive-ä¸­é—´ä»¶" class="headerlink" title="Receive ä¸­é—´ä»¶"></a>Receive ä¸­é—´ä»¶</h3><p>åœ¨ä»»ä½•ç›‘å¬å™¨ä¹‹è¡Œä¹‹å‰ Receive ä¸­é—´ä»¶è¿è¡Œã€‚å®ƒé€‚ç”¨äºå°šæœªæ›´æ–°çš„é»‘åå•å‘½ä»¤ä»¥æ·»åŠ  IDã€æŒ‡æ ‡ç­‰ã€‚</p><h4 id="Receive-ä¸­é—´ä»¶ç¤ºä¾‹"><a href="#Receive-ä¸­é—´ä»¶ç¤ºä¾‹" class="headerlink" title="Receive ä¸­é—´ä»¶ç¤ºä¾‹"></a>Receive ä¸­é—´ä»¶ç¤ºä¾‹</h4><p>è¿™ä¸ªç®€å•çš„ä¸­é—´ä»¶ç¦æ­¢ç‰¹å®šç”¨æˆ·ä½¿ç”¨ hubotï¼ŒåŒ…æ‹¬<code>hear</code>ç›‘å¬å™¨ã€‚å¦‚æœç”¨æˆ·å°è¯•æ˜ç¡®åœ°è¿è¡Œå‘½ä»¤ï¼Œå®ƒå°†è¿”å›é”™è¯¯æ¶ˆæ¯ã€‚</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">BLACKLISTED_USERS = [</span><br><span class="line">  <span class="string">&#x27;12345&#x27;</span> <span class="comment"># Restrict access for a user ID for a contractor</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">robot.receiveMiddleware (context, next, done) -&gt;</span><br><span class="line">  <span class="keyword">if</span> context.response.message.user.id <span class="keyword">in</span> BLACKLISTED_USERS</span><br><span class="line">    <span class="comment"># Don&#x27;t process this message further.</span></span><br><span class="line">    context.response.message.finish()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># If the message starts with &#x27;hubot&#x27; or the alias pattern, this user was</span></span><br><span class="line">    <span class="comment"># explicitly trying to run a command, so respond with an error message.</span></span><br><span class="line">    <span class="keyword">if</span> context.response.message.text?.match(robot.respondPattern(<span class="string">&#x27;&#x27;</span>))</span><br><span class="line">      context.response.reply <span class="string">&quot;I&#x27;m sorry @<span class="subst">#&#123;context.response.message.user.name&#125;</span>, but I&#x27;m configured to ignore your commands.&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Don&#x27;t process further middleware.</span></span><br><span class="line">    done()</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    next(done)</span><br></pre></td></tr></table></figure><h4 id="Receive-ä¸­é—´ä»¶-API"><a href="#Receive-ä¸­é—´ä»¶-API" class="headerlink" title="Receive ä¸­é—´ä»¶ API"></a>Receive ä¸­é—´ä»¶ API</h4><p>Receive ä¸­é—´ä»¶å›è°ƒæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œ<code>context</code>ã€<code>next</code>ã€<code>done</code>ã€‚æœ‰å…³<code>next</code>å’Œ<code>done</code>çš„æè¿°ï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://hubot.github.com/docs/scripting/#execution-process-and-api">ä¸­é—´ä»¶ API</a>ã€‚Receive ä¸­é—´ä»¶ä¸Šä¸‹æ–‡åŒ…æ‹¬è¿™äº›å­—æ®µï¼š</p><ul><li><code>response</code><ul><li>response å¯¹è±¡æ²¡æœ‰<code>match</code>å¯¹è±¡ï¼Œå› ä¸ºè¿˜æ²¡æœ‰ç›‘å¬å™¨è¿è¡Œã€‚</li><li>ä¸­é—´ä»¶å¯èƒ½é€šè¿‡é™„åŠ ä¿¡æ¯ï¼ˆe.g. æ·»åŠ ä¸€ä¸ªæºå¸¦ç”¨æˆ·çš„LDAPç»„çš„å±æ€§åˆ°<code>response.message.user</code> ï¼‰æ¥ä¿®é¥°response å¯¹è±¡ã€‚</li><li>ä¸­é—´ä»¶å¯èƒ½ä¿®æ”¹<code>response.message</code>å¯¹è±¡ã€‚</li></ul></li></ul><h3 id="Response-ä¸­é—´ä»¶"><a href="#Response-ä¸­é—´ä»¶" class="headerlink" title="Response ä¸­é—´ä»¶"></a>Response ä¸­é—´ä»¶</h3><p>Response ä¸­é—´ä»¶ä¸ hubot å‘é€åˆ°èŠå¤©å®¤çš„æ¯ä¸ªæ¶ˆæ¯èƒŒé“è€Œé©°ã€‚å®ƒæœ‰åŠ©äºæ¶ˆæ¯æ ¼å¼åŒ–ã€é˜²æ­¢å¯†ç æ³„éœ²ã€åº¦é‡ç­‰ã€‚</p><h4 id="Response-ä¸­é—´ä»¶ç¤ºä¾‹"><a href="#Response-ä¸­é—´ä»¶ç¤ºä¾‹" class="headerlink" title="Response ä¸­é—´ä»¶ç¤ºä¾‹"></a>Response ä¸­é—´ä»¶ç¤ºä¾‹</h4><p>æ­¤ç®€å•ç¤ºä¾‹å°†å‘é€åˆ°èŠå¤©å®¤çš„é“¾æ¥æ ¼å¼ä»markdowné“¾æ¥ï¼ˆå¦‚<a target="_blank" rel="noopener" href="https://example.com/">ç¤ºä¾‹</a>ï¼‰æ›´æ”¹ä¸º <a target="_blank" rel="noopener" href="https://slack.com/">Slack</a> æ”¯æŒçš„æ ¼å¼ï¼Œ<a target="_blank" rel="noopener" href="https://example.com|ç¤ºä¾‹./">https://example.com|ç¤ºä¾‹ã€‚</a></p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  robot.responseMiddleware (context, next, done) -&gt;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">unless</span> context.plaintext?</span><br><span class="line">    context.strings = (string.replace(<span class="regexp">/\[([^\[\]]*?)\]\((https?:\/\/.*?)\)/</span>, <span class="string">&quot;&lt;$2|$1&gt;&quot;</span>) <span class="keyword">for</span> string <span class="keyword">in</span> context.strings)</span><br><span class="line">    next()</span><br></pre></td></tr></table></figure><h4 id="Response-ä¸­é—´ä»¶-API"><a href="#Response-ä¸­é—´ä»¶-API" class="headerlink" title="Response ä¸­é—´ä»¶ API"></a>Response ä¸­é—´ä»¶ API</h4><p>Response ä¸­é—´ä»¶å›è°ƒæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œ<code>context</code>ã€<code>next</code>ã€<code>done</code>ã€‚è¯·å‚é˜…ä¸­é—´ä»¶ API ä»¥äº†è§£<code>next</code>å’Œ<code>done</code>ã€‚Receive ä¸­é—´ä»¶çš„ä¸Šä¸‹æ–‡åŒ…æ‹¬è¿™äº›å­—æ®µï¼š</p><ul><li><code>response</code><ul><li>æ­¤å“åº”å¯¹è±¡å¯ç”¨äºä»ä¸­é—´ä»¶å‘é€æ–°æ¶ˆæ¯ã€‚åœ¨è¿™äº›æ–°å“åº”ä¸­ï¼Œå°†è°ƒç”¨ä¸­é—´ä»¶ã€‚å°å¿ƒä¸è¦åˆ›å»ºæ— é™å¾ªç¯ã€‚</li></ul></li><li><code>strings</code><ul><li>ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„è¢«å‘é€åˆ°èŠå¤©å®¤é€‚é…å™¨ã€‚æ‚¨å¯ä»¥ç¼–è¾‘è¿™äº›ï¼Œæˆ–è€…ä½¿ç”¨<code>context.strings = [&quot;new strings&quot;]</code>å»æ›¿ä»£å®ƒä»¬ã€‚</li></ul></li><li><code>method</code><ul><li>è¡¨ç¤ºç›‘å¬å™¨å‘é€çš„å“åº”æ¶ˆæ¯ç±»å‹çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚<code>send</code>ã€<code>reply</code>ã€<code>emot</code>æˆ–è€…<code>topic</code>ã€‚</li></ul></li><li><code>plaintext</code><ul><li><code>true</code>æˆ–è€…<code>undefined</code>ã€‚è¿™å°†è¢«è®¾ç½®ä¸º<code>true</code>ï¼Œå¦‚æœæ¶ˆæ¯æ˜¯æ­£å¸¸çš„çº¯æ–‡æœ¬ç±»å‹ï¼Œä¾‹å¦‚<code>send</code>å’Œ<code>reply</code>ã€‚æ­¤å±æ€§åº”è¢«è§†ä¸ºä»…è¯»ã€‚</li></ul></li></ul><h3 id="æµ‹è¯•-hubot-è„šæœ¬"><a href="#æµ‹è¯•-hubot-è„šæœ¬" class="headerlink" title="æµ‹è¯• hubot è„šæœ¬"></a>æµ‹è¯• hubot è„šæœ¬</h3><p><a target="_blank" rel="noopener" href="https://github.com/mtsmfm/hubot-test-helper">hubot-test-helper</a>æ˜¯ä¸€ä¸ªç”¨æ¥å•å…ƒæµ‹è¯•hubotè„šæœ¬çš„å¥½æ¡†æ¶ã€‚ï¼ˆè¯·æ³¨æ„ï¼Œä¸ºäº†ä½¿ç”¨ <code>hubot-test-helper,</code>ï¼Œæ‚¨éœ€è¦ä¸€ä¸ªæ”¯æŒPromisesçš„æœ€è¿‘Nodeç‰ˆæœ¬ã€‚ï¼‰</p><p>åœ¨ Hubot å®ä¾‹ä¸­å®‰è£…åŒ…ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hubot-test-helper --save-dev</span><br></pre></td></tr></table></figure><p>æ‚¨è¿˜éœ€è¦å®‰è£…ï¼š</p><ul><li>ä¸€ä¸ªJavaScriptæµ‹è¯•æ¡†æ¶ï¼Œä¾‹å¦‚<em>Mocha</em></li><li>ä¸€ä¸ªæ–­è¨€åº“ï¼Œä¾‹å¦‚<em>chai</em>æˆ–è€…<em>expect.js</em></li></ul><p>æ‚¨æˆ–è®¸è¿˜æƒ³å®‰è£…ï¼š</p><ul><li><em>coffee-script</em>ï¼ˆå¦‚æœæ‚¨ç”¨CoffeeScriptå†™æ‚¨çš„æµ‹è¯•è€Œä¸æ˜¯JavaScriptï¼‰</li><li>ä¸€ä¸ªmockingåº“ä¾‹å¦‚<em>Sinon.js</em>ï¼ˆå¦‚æœæ‚¨çš„è„šæœ¬æ‰§è¡Œç½‘ç»œè¯·æ±‚æˆ–å…¶ä»–å¼‚æ­¥æ“ä½œï¼‰</li></ul><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹è„šæœ¬ï¼Œæµ‹è¯• <a target="_blank" rel="noopener" href="https://github.com/github/generator-hubot/blob/master/generators/app/templates/scripts/example.coffee">Hubot ç¤ºä¾‹è„šæœ¬</a>ä¸­çš„å‰å‡ ä¸ªå‘½ä»¤ã€‚è¿™ä¸ªè„šæœ¬ä½¿ç”¨<em>Mocha</em>ã€<em>chai</em>ã€<em>coffeescript</em>ï¼Œå½“ç„¶è¿˜æœ‰<em>hubot-test-helper</em>ã€‚</p><p><strong>test/example-test.coffee</strong></p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Helper = <span class="built_in">require</span>(<span class="string">&#x27;hubot-test-helper&#x27;</span>)</span><br><span class="line">chai = <span class="built_in">require</span> <span class="string">&#x27;chai&#x27;</span></span><br><span class="line"></span><br><span class="line">expect = chai.expect</span><br><span class="line"></span><br><span class="line">helper = <span class="keyword">new</span> Helper(<span class="string">&#x27;../scripts/example.coffee&#x27;</span>)</span><br><span class="line"></span><br><span class="line">describe <span class="string">&#x27;example script&#x27;</span>, <span class="function">-&gt;</span></span><br><span class="line">  beforeEach -&gt;</span><br><span class="line">    @room = helper.createRoom()</span><br><span class="line"></span><br><span class="line">  afterEach -&gt;</span><br><span class="line">    @room.destroy()</span><br><span class="line"></span><br><span class="line">  it <span class="string">&#x27;doesn\&#x27;t need badgers&#x27;</span>, <span class="function">-&gt;</span></span><br><span class="line">    @room.user.say(<span class="string">&#x27;alice&#x27;</span>, <span class="string">&#x27;did someone call for a badger?&#x27;</span>).<span class="keyword">then</span> =&gt;</span><br><span class="line">      expect(@room.messages).to.eql [</span><br><span class="line">        [<span class="string">&#x27;alice&#x27;</span>, <span class="string">&#x27;did someone call for a badger?&#x27;</span>]</span><br><span class="line">        [<span class="string">&#x27;hubot&#x27;</span>, <span class="string">&#x27;Badgers? BADGERS? WE DON\&#x27;T NEED NO STINKIN BADGERS&#x27;</span>]</span><br><span class="line">      ]</span><br><span class="line"></span><br><span class="line">  it <span class="string">&#x27;won\&#x27;t open the pod bay doors&#x27;</span>, <span class="function">-&gt;</span></span><br><span class="line">    @room.user.say(<span class="string">&#x27;bob&#x27;</span>, <span class="string">&#x27;@hubot open the pod bay doors&#x27;</span>).<span class="keyword">then</span> =&gt;</span><br><span class="line">      expect(@room.messages).to.eql [</span><br><span class="line">        [<span class="string">&#x27;bob&#x27;</span>, <span class="string">&#x27;@hubot open the pod bay doors&#x27;</span>]</span><br><span class="line">        [<span class="string">&#x27;hubot&#x27;</span>, <span class="string">&#x27;@bob I\&#x27;m afraid I can\&#x27;t let you do that.&#x27;</span>]</span><br><span class="line">      ]</span><br><span class="line"></span><br><span class="line">  it <span class="string">&#x27;will open the dutch doors&#x27;</span>, <span class="function">-&gt;</span></span><br><span class="line">    @room.user.say(<span class="string">&#x27;bob&#x27;</span>, <span class="string">&#x27;@hubot open the dutch doors&#x27;</span>).<span class="keyword">then</span> =&gt;</span><br><span class="line">      expect(@room.messages).to.eql [</span><br><span class="line">        [<span class="string">&#x27;bob&#x27;</span>, <span class="string">&#x27;@hubot open the dutch doors&#x27;</span>]</span><br><span class="line">        [<span class="string">&#x27;hubot&#x27;</span>, <span class="string">&#x27;@bob Opening dutch doors&#x27;</span>]</span><br><span class="line">      ]</span><br></pre></td></tr></table></figure><p><strong>è¾“å‡ºç¤ºä¾‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ mocha --compilers &quot;coffee:coffee-script/register&quot; test/*.coffee</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  example script</span><br><span class="line">    âœ“ doesn&#x27;t need badgers</span><br><span class="line">    âœ“ won&#x27;t open the pod bay doors</span><br><span class="line">    âœ“ will open the dutch doors</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  3 passing (212ms)</span><br></pre></td></tr></table></figure><h2 id="æ¨¡å¼-1"><a href="#æ¨¡å¼-1" class="headerlink" title="æ¨¡å¼"></a>æ¨¡å¼</h2><p>ç”¨å…±äº«æ¨¡å¼å¤„ç†å¸¸è§hubotåœºæ™¯ã€‚</p><h3 id="é‡å‘½åhubotå®ä¾‹"><a href="#é‡å‘½åhubotå®ä¾‹" class="headerlink" title="é‡å‘½åhubotå®ä¾‹"></a>é‡å‘½åhubotå®ä¾‹</h3><p>å½“æ‚¨é‡å‘½åhubotæ—¶ï¼Œä»–å°†ä¸å†å›åº”ä»–ä»¥å‰çš„åå­—ã€‚ä¸ºäº†è®­ç»ƒç”¨æˆ·ä½¿ç”¨æ–°åç§°ï¼Œæ‚¨å¯ä»¥é€‰æ‹©åœ¨ç”¨æˆ·å°è¯•è¯´å‡ºæ—§åç§°æ—¶æ·»åŠ å¼ƒç”¨é€šçŸ¥ã€‚è¿™é‡Œçš„æ¨¡å¼é€»è¾‘æ˜¯ï¼š</p><ul><li>æ”¶å¬æ‰€æœ‰ä»¥æ—§åç§°å¼€å¤´çš„æ¶ˆæ¯</li><li>å›å¤ç”¨æˆ·ï¼Œè®©ä»–ä»¬çŸ¥é“æ–°åç§°</li></ul><p>è®¾ç½®è¿™ä¸ªéå¸¸ç®€å•ï¼š</p><ol><li>åœ¨æ‚¨çš„ hubot å®ä¾‹çš„<code>scripts/</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<a target="_blank" rel="noopener" href="https://hubot.github.com/docs/scripting/">æ†ç»‘è„šæœ¬</a>ï¼Œå«<code>rename-hubot.coffee</code></li><li>æ·»åŠ ä»¥ä¸‹ä»£ç ï¼Œæ ¹æ®æ‚¨çš„éœ€è¦ä¿®æ”¹ï¼š</li></ol><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Description:</span></span><br><span class="line"><span class="comment">#   Tell people hubot&#x27;s new name if they use the old one</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Commands:</span></span><br><span class="line"><span class="comment">#   None</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  robot.hear <span class="regexp">/^hubot:? (.+)/i</span>, <span class="function"><span class="params">(res)</span> -&gt;</span></span><br><span class="line">    response = <span class="string">&quot;Sorry, I&#x27;m a diva and only respond to <span class="subst">#&#123;robot.name&#125;</span>&quot;</span></span><br><span class="line">    response += <span class="string">&quot; or <span class="subst">#&#123;robot.alias&#125;</span>&quot;</span> <span class="keyword">if</span> robot.alias</span><br><span class="line">    res.reply response</span><br><span class="line">    <span class="keyword">return</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°æ¨¡å¼ä¸­ï¼Œä¿®æ”¹ hubot ç›‘å¬å™¨å’Œå“åº”æ¶ˆæ¯ä»¥æ»¡è¶³æ‚¨çš„éœ€æ±‚ã€‚</p><p>æ­¤å¤–ï¼Œè¯·åŠ¡å¿…æ³¨æ„ï¼Œç›‘å¬å™¨åº”è¯¥åŸºäº hubot å®é™…å¬åˆ°çš„å†…å®¹ï¼Œè€Œä¸æ˜¯åœ¨ hubot é€‚é…å™¨å¤„ç†ä¹‹å‰é”®å…¥åˆ°èŠå¤©ç¨‹åºä¸­çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/hipchat/hubot-hipchat">HipChat Adapter</a>è½¬æ¢<code>@hubot</code>ä¸º<code>hubot:</code>åœ¨ä¼ é€’ç»™hubotä¹‹å‰ã€‚</p><h3 id="å¼ƒç”¨æˆ–é‡å‘½åç›‘å¬å™¨"><a href="#å¼ƒç”¨æˆ–é‡å‘½åç›‘å¬å™¨" class="headerlink" title="å¼ƒç”¨æˆ–é‡å‘½åç›‘å¬å™¨"></a>å¼ƒç”¨æˆ–é‡å‘½åç›‘å¬å™¨</h3><p>å¦‚æœæ‚¨åˆ é™¤è„šæœ¬æˆ–æ›´æ”¹äº†è„šæœ¬çš„å‘½ä»¤ï¼Œè®©ç”¨æˆ·çŸ¥é“æ›´æ”¹å¯èƒ½ä¼šæœ‰ç”¨ã€‚ä¸€ç§æ–¹å¼æ˜¯åœ¨èŠå¤©ä¸­å‘Šè¯‰ä»–ä»¬ï¼Œæˆ–è€…è®©ä»–ä»¬é€šè¿‡å°è¯•ä½¿ç”¨ä¸å†å­˜åœ¨çš„å‘½ä»¤æ¥å‘ç°å˜åŒ–ã€‚å¦ä¸€ç§æ–¹å¼æ˜¯ä½¿ Hubot è®©äººä»¬çŸ¥é“ä»–ä»¬ä½•æ—¶ä½¿ç”¨äº†ä¸å†å·¥ä½œçš„å‘½ä»¤ã€‚</p><p>æ­¤æ¨¡å¼ç±»ä¼¼äºä¸Šè¿°é‡å‘½å Hubot å®ä¾‹æ¨¡å¼ï¼š</p><ul><li>æ”¶å¬ä¸æ—§å‘½ä»¤åŒ¹é…çš„æ‰€æœ‰æ¶ˆæ¯</li><li>å›å¤ç”¨æˆ·ï¼Œè®©ä»–ä»¬çŸ¥é“ï¼Œå®ƒå·²è¢«å¼ƒç”¨</li></ul><p>è®¾ç½®å¦‚ä¸‹ï¼š</p><ol><li>åœ¨hubotå®ä¾‹çš„<code>scripts/</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªå«<code>deprecations.coffee</code>çš„<a target="_blank" rel="noopener" href="https://hubot.github.com/docs/scripting/">æ†ç»‘è„šæœ¬</a></li><li>å¤åˆ¶ä¸€åˆ‡æ—§çš„å‘½ä»¤ç›‘å¬å™¨ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°è¯¥æ–‡ä»¶ä¸­ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å‡ºäºæŸç§ç³Šæ¶‚çš„åŸå› é‡æ–°å‘½åå¸®åŠ©å‘½ä»¤ï¼š<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Description:</span></span><br><span class="line"><span class="comment">#   Tell users when they have used commands that are deprecated or renamed</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Commands:</span></span><br><span class="line"><span class="comment">#   None</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  robot.respond <span class="regexp">/help\s*(.*)?$/i</span>, <span class="function"><span class="params">(res)</span> -&gt;</span></span><br><span class="line">    res.reply <span class="string">&quot;That means nothing to me anymore. Perhaps you meant `docs` instead?&quot;</span></span><br><span class="line">    <span class="keyword">return</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="é€šè¿‡ä»£ç†è½¬å‘æ‰€æœ‰-HTTP-è¯·æ±‚"><a href="#é€šè¿‡ä»£ç†è½¬å‘æ‰€æœ‰-HTTP-è¯·æ±‚" class="headerlink" title="é€šè¿‡ä»£ç†è½¬å‘æ‰€æœ‰ HTTP è¯·æ±‚"></a>é€šè¿‡ä»£ç†è½¬å‘æ‰€æœ‰ HTTP è¯·æ±‚</h3><p>åœ¨è®¸å¤šä¼ä¸šç¯å¢ƒä¸­ï¼Œè®¿é—®äº’è”ç½‘å’Œï¼ˆæˆ–ï¼‰å—ä¿æŠ¤çš„èµ„æºéœ€è¦ç½‘ç»œä»£ç†ã€‚å¯¹äºä¸€æ¬¡æ€§çš„æ§åˆ¶ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ª<a target="_blank" rel="noopener" href="https://nodejs.org/api/http.html">Agent</a>ä¸<code>robot.http</code>ä¸€èµ·ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œè¿™éœ€è¦ä¿®æ”¹æ‚¨çš„æœºå™¨äººç”¨äºæŒ‡å‘ä»£ç†çš„æ¯ä¸ªè„šæœ¬ã€‚ç›¸åï¼Œæ‚¨å¯ä»¥åœ¨å…¨å±€å±‚æ¬¡æŒ‡å®šä»£ç†ï¼Œå¹¶é»˜è®¤ä½¿æ‰€æœ‰ HTTP è¯·æ±‚ä½¿ç”¨ä»£ç†ã€‚</p><p>ç”±äº node.js å¤„ç† HTTP å’Œ HTTPS è¯·æ±‚çš„æ–¹å¼ï¼Œæ‚¨éœ€è¦ä¸ºæ¯ä¸€ç§åè®®æŒ‡å®šä¸€ä¸ªä¸åŒçš„ Agentã€‚ScopedHTTPClient å°†è‡ªåŠ¨çš„é€‰æ‹©æ­£ç¡®çš„ ProxyAgent ä¸ºæ¯ç§è¯·æ±‚ã€‚</p><ol><li>å®‰è£… ProxyAgentã€‚<code>npm install proxy-agent</code></li><li>åœ¨æ‚¨çš„ hubot å®ä¾‹çš„<code>scripts/</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<a target="_blank" rel="noopener" href="https://hubot.github.com/docs/scripting/">æ†ç»‘è„šæœ¬</a></li><li>æ·»åŠ åé¢çš„ä»£ç ï¼Œå¹¶æŒ‰éœ€ä¿®æ”¹ï¼š</li></ol><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">proxy = <span class="built_in">require</span> <span class="string">&#x27;proxy-agent&#x27;</span></span><br><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  robot.globalHttpOptions.httpAgent  = proxy(<span class="string">&#x27;http://my-proxy-server.internal&#x27;</span>, <span class="literal">false</span>)</span><br><span class="line">  robot.globalHttpOptions.httpsAgent = proxy(<span class="string">&#x27;http://my-proxy-server.internal&#x27;</span>, <span class="literal">true</span>)</span><br></pre></td></tr></table></figure><h3 id="æ¶ˆæ¯çš„åŠ¨æ€åŒ¹é…"><a href="#æ¶ˆæ¯çš„åŠ¨æ€åŒ¹é…" class="headerlink" title="æ¶ˆæ¯çš„åŠ¨æ€åŒ¹é…"></a>æ¶ˆæ¯çš„åŠ¨æ€åŒ¹é…</h3><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¸Œæœ›åŠ¨æ€åŒ¹é…ä¸åŒçš„æ¶ˆæ¯ï¼ˆe.g. factoids, JIRA projectsï¼‰ã€‚è€Œä¸æ˜¯å®šä¹‰ä¸€ä¸ªè¿‡äºå®½æ³›çš„æ€»æ˜¯åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾ï¼Œæ‚¨å¯ä»¥å‘Šè¯‰ hubot åªæœ‰åœ¨æ»¡è¶³æŸäº›æ¡ä»¶æ—¶æ‰åŒ¹é…ã€‚</p><p>åœ¨ä¸€ä¸ªç®€å•çš„æœºå™¨äººä¸­ï¼Œè¿™ä¸ä»…ä»…æŠŠæ¡ä»¶æ”¾åœ¨ç›‘å¬å™¨å›è°ƒä¸­æ²¡ä»€ä¹ˆä¸åŒï¼Œä½†æ˜¯åœ¨å¤„ç†ä¸­é—´ä»¶æ—¶å´æœ‰å¾ˆå¤§çš„ä¸åŒï¼šç”¨åŸºæœ¬çš„æ¨¡å‹ï¼Œæ­£åˆ™è¡¨è¾¾å¼æ¯æ¬¡åŒ¹é…ä¸­é—´ä»¶å°†æ‰§è¡Œã€‚ç”¨è¿™ä¸ªåŠ¨æ€åŒ¹é…æ¨¡å‹ï¼Œä¸­é—´ä»¶ä»…å½“åŠ¨æ€æ¡ä»¶åŒ¹é…æ—¶æ‰§è¡Œã€‚</p><p>ä¾‹å¦‚ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/github/hubot-scripts/blob/bd810f99f9394818a9dcc2ea3729427e4101b96d/src/scripts/factoid.coffee#L95-L99">factoid lookup command</a>å¯ä»¥è¢«é‡æ–°å®ç°ä¸ºï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  <span class="comment"># Dynamically populated list of factoids</span></span><br><span class="line">  facts =</span><br><span class="line">    fact1: <span class="string">&#x27;stuff&#x27;</span></span><br><span class="line">    fact2: <span class="string">&#x27;other stuff&#x27;</span></span><br><span class="line"></span><br><span class="line">  robot.listen(</span><br><span class="line">    <span class="comment"># Matcher</span></span><br><span class="line">    (message) -&gt;</span><br><span class="line">      match = message.match(<span class="regexp">/^~(.*)$/</span>)</span><br><span class="line">      <span class="comment"># Only match if there is a matching factoid</span></span><br><span class="line">      <span class="keyword">if</span> match <span class="keyword">and</span> match[<span class="number">1</span>] <span class="keyword">in</span> facts</span><br><span class="line">        match[<span class="number">1</span>]</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="literal">false</span></span><br><span class="line">    <span class="comment"># Callback</span></span><br><span class="line">    (response) -&gt;</span><br><span class="line">      fact = response.match</span><br><span class="line">      res.reply <span class="string">&quot;<span class="subst">#&#123;fact&#125;</span> is <span class="subst">#&#123;facts[fact]&#125;</span>&quot;</span></span><br><span class="line">  )</span><br></pre></td></tr></table></figure><h3 id="é™åˆ¶å‘½ä»¤è®¿é—®"><a href="#é™åˆ¶å‘½ä»¤è®¿é—®" class="headerlink" title="é™åˆ¶å‘½ä»¤è®¿é—®"></a>é™åˆ¶å‘½ä»¤è®¿é—®</h3><p>Hubot çš„ä¸€ä¸ªäº†ä¸èµ·çš„ç‰¹è‰²æ˜¯å®ƒèƒ½å¤Ÿé€šè¿‡ä¸€æ¡èŠå¤©æ¶ˆæ¯æ”¹å˜ç”Ÿäº§ç¯å¢ƒã€‚ä½†æ˜¯ï¼Œå¹¶éæ¯ä¸ªè®¿é—®æ‚¨çš„èŠå¤©æœåŠ¡çš„äººéƒ½èƒ½å¤Ÿè§¦å‘ç”Ÿäº§ç¯å¢ƒæ”¹å˜ã€‚</p><p>æœ‰å¤šç§ä¸åŒçš„æ¨¡å¼æ¥é™åˆ¶è®¿é—®ï¼Œæ‚¨å¯ä»¥æ ¹æ®æ‚¨çš„éœ€æ±‚æ¥é€‰æ‹©ï¼š</p><ul><li>ä¸¤ä¸ªè®¿é—® bucketsï¼šå®Œæ•´çš„å’Œç”¨é»‘ç™½åå•é™åˆ¶çš„</li><li>ä¸ºæ¯ä¸ªå‘½ä»¤å®šåˆ¶è®¿é—®è§„åˆ™ï¼ˆåŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ï¼‰</li><li>ç‰¹å®šæˆ¿é—´çš„é»‘ç™½åå•å‘½ä»¤</li></ul><h4 id="ç®€å•çš„æ¯ä¸ªç›‘å¬å™¨è®¿é—®"><a href="#ç®€å•çš„æ¯ä¸ªç›‘å¬å™¨è®¿é—®" class="headerlink" title="ç®€å•çš„æ¯ä¸ªç›‘å¬å™¨è®¿é—®"></a>ç®€å•çš„æ¯ä¸ªç›‘å¬å™¨è®¿é—®</h4><p>åœ¨æŸäº›ç»„ç»‡ä¸­ï¼Œå‡ ä¹æ‰€æœ‰å‘˜å·¥éƒ½è·å¾—äº†ç›¸åŒçº§åˆ«çš„è®¿é—®æƒé™ï¼Œåªæœ‰å°‘æ•°å‘˜å·¥éœ€è¦å—åˆ°é™åˆ¶ï¼ˆe.g. æ–°å‘˜å·¥ï¼Œå¤–åŒ…å‘˜å·¥ç­‰ï¼‰ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ‚¨åˆ’åˆ†æ‰€æœ‰ç›‘å¬å™¨é›†åˆï¼Œå°†â€œæƒåŠ›å‘½ä»¤ï¼ˆpower commandsï¼‰â€ä¸â€œå¸¸è§„å‘½ä»¤ï¼ˆnormal commandsï¼‰â€åˆ†å¼€ã€‚</p><p>ä¸€æ—¦æ‚¨å°†ç›‘å¬å™¨åˆ†å¼€äº†ï¼Œæ‚¨éœ€è¦å›´ç»•é»‘ç™½åå•ç”¨æˆ·å’Œç›‘å¬å™¨åšå‡ºä¸€äº›æƒè¡¡ã€‚</p><p>é€‰æ‹©ç”¨æˆ·ç™½åå•æ¨¡å¼ä¸ç”¨æˆ·é»‘åå•æ¨¡å¼çš„å…³é”®å› ç´ æ˜¯ï¼šæ¯ä¸ªç±»åˆ«ä¸­çš„ç”¨æˆ·æ•°é‡ã€ä»»ä¸€ç±»åˆ«çš„å˜åŒ–é¢‘ç‡ä»¥åŠæ‚¨çš„ç»„ç»‡æ„¿æ„æ¥å—çš„å®‰å…¨é£é™©çº§åˆ«ã€‚</p><ul><li>ç™½åå•ç”¨æˆ·æ¨¡å¼ï¼ˆç”¨æˆ·Xã€Yã€Zæœ‰æƒè®¿é—®æƒåŠ›å‘½ä»¤ï¼›æ‰€æœ‰çš„å…¶ä»–ç”¨æˆ·åªèƒ½è®¿é—®å¸¸è§„å‘½ä»¤ï¼‰æ˜¯ä¸€ç§æ›´å®‰å…¨çš„è®¿é—®æ–¹æ³•ï¼ˆæ–°ç”¨æˆ·æ²¡æœ‰é»˜è®¤çš„æƒé™å»æ‰§è¡ŒæƒåŠ›å‘½ä»¤ï¼‰ï¼Œä½†æœ‰æ›´é«˜çš„ç»´æŠ¤æˆæœ¬ï¼ˆæ‚¨éœ€è¦å°†æ¯ä¸ªæ–°ç”¨æˆ·æ·»åŠ åˆ°â€å®¡æ‰¹â€åˆ—è¡¨ä¸­ï¼‰</li><li>é»‘åå•ç”¨æˆ·æ¨¡å¼ï¼ˆæ‰€æœ‰çš„ç”¨æˆ·éƒ½å¯ä»¥æ‰§è¡ŒæƒåŠ›å‘½ä»¤ï¼Œé™¤äº†ç”¨æˆ·Xã€Yã€Zåªèƒ½è®¿é—®å¸¸è§„å‘½ä»¤ï¼‰æ˜¯ä¸€ç§ä¸å¤ªå®‰å…¨çš„æ–¹æ³•ï¼ˆæ–°çš„ç”¨æˆ·é»˜è®¤æœ‰æƒæ‰§è¡ŒæƒåŠ›å‘½ä»¤é™¤éä»–ä»¬è¢«åŠ å…¥äº†é»‘åå•ï¼‰ï¼Œå´æœ‰è¾ƒä½çš„ç»´æŠ¤æˆæœ¬ï¼Œåœ¨é»‘åå•æ˜¯å°æˆ–è€…å¾ˆå°‘æ”¹å˜çš„æƒ…å†µä¸‹ã€‚</li></ul><p>å†³å®šä½¿ç”¨é€‰æ‹©æ€§çš„å…è®¸ç›‘å¬å™¨å’Œé™åˆ¶ç›‘å¬å™¨çš„å…³é”®å› ç´ æ˜¯ï¼šåœ¨æ¯ä¸ªåˆ†ç±»ä¸­ç›‘å¬å™¨çš„æ•°é‡ã€å†…éƒ¨å’Œå¤–éƒ¨è„šæœ¬çš„æ¯”ä¾‹ä»¥åŠæ‚¨çš„ç»„ç»‡æ„¿æ„æ¥å—çš„å®‰å…¨é£é™©çº§åˆ«ã€‚</p><ul><li>é€‰æ‹©æ€§çš„å…è®¸ç›‘å¬å™¨ï¼ˆæ‰€æœ‰çš„ç›‘å¬å™¨éƒ½æ˜¯æƒåŠ›å‘½ä»¤ï¼Œé™¤äº†ç›‘å¬å™¨Aã€Bã€Cè¢«è§†ä¸ºå¸¸è§„å‘½ä»¤ï¼‰æ˜¯æ›´å®‰å…¨çš„ï¼ˆæ–°çš„ç›‘å¬å™¨é»˜è®¤è¢«é™åˆ¶ï¼‰ï¼Œä½†ç»´æŠ¤æˆæœ¬å´é«˜å¾—å¤šï¼ˆæ¯ä¸ªæ„šè ¢/æœ‰è¶£çš„ç›‘å¬å™¨éœ€è¦è¢«æ˜ç¡®çš„é™çº§åˆ°â€œå¸¸è§„â€çŠ¶æ€ï¼‰ã€‚</li><li>é€‰æ‹©æ€§çš„é™åˆ¶ç›‘å¬å™¨ï¼ˆç›‘å¬å™¨Aã€Bã€Cæ˜¯æƒåŠ›å‘½ä»¤ï¼Œå…¶å®ƒçš„éƒ½æ˜¯å¸¸è§„å‘½ä»¤ï¼‰æ˜¯å®‰å…¨æ€§æ›´å·®çš„ä¸€ç§æ–¹å¼ï¼ˆæ–°çš„ç›‘å¬å™¨é»˜è®¤è¢«æ”¾è¿›å¸¸è§„åˆ†ç±»ï¼Œå®ƒèƒ½å¤Ÿè¢«æ„æƒ³ä¸åˆ°çš„è®¿é—®ï¼›å¤–éƒ¨è„šæœ¬åœ¨è¿™é‡Œç‰¹åˆ«å¯æ€•ï¼‰ï¼Œä¸è¿‡æœ‰æ›´ä½çš„ç»´æŠ¤æˆæœ¬ï¼ˆæ— éœ€ä¿®æ”¹/åˆ—ä¸¾è®¿é—®ç­–ç•¥ä¸­çš„æ‰€æœ‰fun/cultureè„šæœ¬ï¼‰ã€‚</li></ul><p>ä½œä¸ºé¢å¤–çš„è€ƒè™‘ï¼Œå¤§å¤šæ•°è„šæœ¬ç›®å‰æ²¡æœ‰ç›‘å¬å™¨ IDï¼Œå› æ­¤æ‚¨å¯èƒ½éœ€è¦æ‰“å¼€æ‚¨ä½¿ç”¨çš„å¤–éƒ¨è„šæœ¬çš„ PRsï¼ˆæˆ– forkï¼‰æ¥æ·»åŠ ç›‘å¬å™¨ IDã€‚å®é™…ä¿®æ”¹å¾ˆå®¹æ˜“ï¼Œä½†ä¸è®¸å¤šç»´æŠ¤äººå‘˜åè°ƒå¯èƒ½å¾ˆè´¹æ—¶ã€‚</p><p>ä¸€æ—¦æ‚¨å†³å®šéµå¾ªè¿™å››ç§æ¨¡å‹çš„æŸä¸€ç§ï¼Œæ‚¨éœ€è¦æ„å»ºé€‚å½“çš„ç”¨æˆ·å’Œç›‘å¬å™¨åˆ—è¡¨ï¼Œä»¥æ’å…¥åˆ°æ‚¨çš„æˆæƒä¸­é—´ä»¶ã€‚</p><p>ä¾‹å¦‚ï¼šç”¨ç™½åå•ç”¨æˆ·æ¨¡å¼å»é€‰æ‹©æ€§çš„é™åˆ¶æƒåŠ›å‘½ä»¤ã€‚</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">POWER_COMMANDS = [</span><br><span class="line">  <span class="string">&#x27;deploy.web&#x27;</span> <span class="comment"># String that matches the listener ID</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">POWER_USERS = [</span><br><span class="line">  <span class="string">&#x27;jdoe&#x27;</span> <span class="comment"># String that matches the user ID set by the adapter</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  robot.listenerMiddleware (context, next, done) -&gt;</span><br><span class="line">    <span class="keyword">if</span> context.listener.options.id <span class="keyword">in</span> POWER_COMMANDS</span><br><span class="line">      <span class="keyword">if</span> context.response.message.user.id <span class="keyword">in</span> POWER_USERS</span><br><span class="line">        <span class="comment"># User is allowed access to this command</span></span><br><span class="line">        next()</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="comment"># Restricted command, but user isn&#x27;t in whitelist</span></span><br><span class="line">        context.response.reply <span class="string">&quot;I&#x27;m sorry, @<span class="subst">#&#123;context.response.message.user.name&#125;</span>, but you don&#x27;t have access to do that.&quot;</span></span><br><span class="line">        done()</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="comment"># This is not a restricted command; allow everyone</span></span><br><span class="line">      next()</span><br></pre></td></tr></table></figure><p>è®°ä½æ‰€æœ‰åŒ¹é…ç»™å®šæ¶ˆæ¯çš„ç›‘å¬å™¨ï¼ˆåŒ…æ‹¬<code>robot.hear /.+/</code>ï¼‰æ‰§è¡Œçš„ä¸­é—´ä»¶ï¼Œåœ¨å¯¹ç›‘å¬å™¨è¿›è¡Œåˆ†ç±»æ—¶ï¼Œè¯·ç¡®ä¿åŒ…å«å®ƒä»¬ã€‚</p><h4 id="æ¯ä¸ªç›‘å¬å™¨ç‰¹å®šçš„è®¿é—®è§„åˆ™"><a href="#æ¯ä¸ªç›‘å¬å™¨ç‰¹å®šçš„è®¿é—®è§„åˆ™" class="headerlink" title="æ¯ä¸ªç›‘å¬å™¨ç‰¹å®šçš„è®¿é—®è§„åˆ™"></a>æ¯ä¸ªç›‘å¬å™¨ç‰¹å®šçš„è®¿é—®è§„åˆ™</h4><p>å¯¹äºè¾ƒå¤§çš„ç»„ç»‡ï¼Œè®¿é—®çš„äºŒå…ƒåˆ†ç±»é€šå¸¸æ˜¯ä¸å¤Ÿçš„ï¼Œéœ€è¦æ›´å¤æ‚çš„è®¿é—®è§„åˆ™ã€‚</p><p>è®¿é—®ç­–ç•¥ç¤ºä¾‹ï¼š</p><ul><li>æ¯ä¸ªå¼€å‘å›¢é˜Ÿéƒ½æœ‰æƒç¼–è¯‘å¤„äºæŸä¸ªçŠ¶æ€çš„ä»£ç (cut releases)å¹¶éƒ¨ç½²å…¶æœåŠ¡</li><li>è¿è¥ç»„æœ‰æƒéƒ¨ç½²æ‰€æœ‰æœåŠ¡ï¼ˆä½†æ˜¯ä¸èƒ½ cut releasesï¼‰</li><li>å‰å°æ— æ³•cut releasesæˆ–éƒ¨ç½²æœåŠ¡</li></ul><p>åƒè¿™æ ·çš„å¤æ‚æ”¿ç­–ç›®å‰æœ€å¥½ç›´æ¥åœ¨ä»£ç ä¸­å®ç°ï¼Œå°½ç®¡è¿™æ˜¯<a target="_blank" rel="noopener" href="https://github.com/michaelansel/hubot-rbac">æ­£åœ¨è¿›è¡Œä¸­çš„å·¥ä½œ</a>ä¸ºè®¿é—®ç®¡ç†å»ºç«‹ä¸€ä¸ªé€šç”¨çš„æ¡†æ¶ã€‚</p><h4 id="æ¯ä¸ªæˆ¿é—´ç‰¹å®šçš„è®¿é—®è§„åˆ™"><a href="#æ¯ä¸ªæˆ¿é—´ç‰¹å®šçš„è®¿é—®è§„åˆ™" class="headerlink" title="æ¯ä¸ªæˆ¿é—´ç‰¹å®šçš„è®¿é—®è§„åˆ™"></a>æ¯ä¸ªæˆ¿é—´ç‰¹å®šçš„è®¿é—®è§„åˆ™</h4><p>æ‹¥æœ‰å¤šä¸ªä¸åŒç”¨é€”çš„èŠå¤©å®¤çš„ç»„ç»‡é€šå¸¸å¸Œæœ›èƒ½å¤Ÿä½¿ç”¨ç›¸åŒçš„ hubot å®ä¾‹ï¼Œä½†æ¯ä¸ªæˆ¿é—´å…è®¸ä½¿ç”¨ä¸åŒçš„å‘½ä»¤é›†ã€‚</p><p>å¹¿æ³›çš„é»‘åå•çš„è§£å†³æ–¹æ¡ˆ<a target="_blank" rel="noopener" href="https://github.com/kristenmills/hubot-command-blacklist">æ­£åœ¨è¿›è¡Œä¸­</a>ã€‚ç™½åå•çš„è§£å†³æ–¹æ¡ˆå¯ä»¥é‡‡å–ç±»ä¼¼çš„æ–¹æ³•ã€‚</p><h2 id="é€‚é…å™¨-1"><a href="#é€‚é…å™¨-1" class="headerlink" title="é€‚é…å™¨"></a>é€‚é…å™¨</h2><p>é€‚é…å™¨æ˜¯æ‚¨å¸Œæœ› hubot æ‰€è¿è¡Œçš„æœåŠ¡çš„ç•Œé¢ã€‚</p><p>Hubot åŒ…å«ä¸¤ä¸ªå®˜æ–¹çš„é€‚é…å™¨ï¼š</p><ul><li><a target="_blank" rel="noopener" href="https://hubot.github.com/docs/adapters/shell/">Shell</a>ï¼Œç”¨äºå¼€å‘</li><li><a target="_blank" rel="noopener" href="https://hubot.github.com/docs/adapters/campfire/">Campfire</a></li></ul><p>å¯¹äºå¤§å¤šæ•°èŠå¤©æœåŠ¡ï¼Œæœ‰è®¸å¤šç¬¬ä¸‰æ–¹é€‚é…å™¨ã€‚è¿™æ˜¯å…¶ä¸­æœ€å—æ¬¢è¿çš„ä¸€äº›ï¼š</p><ul><li><a target="_blank" rel="noopener" href="https://github.com/huafu/hubot-gitter2">Gitter</a></li><li><a target="_blank" rel="noopener" href="https://github.com/hipchat/hubot-hipchat">HipChat</a></li><li><a target="_blank" rel="noopener" href="https://github.com/nandub/hubot-irc">IRC</a></li><li><a target="_blank" rel="noopener" href="https://github.com/RocketChat/hubot-rocketchat">Rocket.Chat</a></li><li><a target="_blank" rel="noopener" href="https://github.com/slackhq/hubot-slack">Slack</a></li><li><a target="_blank" rel="noopener" href="https://github.com/markstory/hubot-xmpp">XMPP</a></li></ul><p>æµè§ˆæ‰€æœ‰çš„ä»“åº“é€šè¿‡<a target="_blank" rel="noopener" href="https://github.com/search?q=topic:hubot-adapter&type=Repositories">åœ¨ Github ä¸Šçš„ <code>hubot-adapter</code> topic</a> æˆ–è€…<a target="_blank" rel="noopener" href="https://www.npmjs.com/search?q=hubot%20adapter&ranking=popularity">åœ¨ NPM ä¸Šæœç´¢é€‚é…å™¨</a>ã€‚æ·»åŠ <code>hubot-adapter</code> <a target="_blank" rel="noopener" href="https://help.github.com/articles/classifying-your-repository-with-topics/">topic</a>åˆ°æ‚¨Githubä¸Šçš„ä¸ªäººä»“åº“ï¼Œä»¥å°†å…¶åŒ…å«åœ¨æ­¤åˆ—è¡¨ä¸­ã€‚</p><h3 id="ç¼–å†™æ‚¨è‡ªå·±çš„é€‚é…å™¨"><a href="#ç¼–å†™æ‚¨è‡ªå·±çš„é€‚é…å™¨" class="headerlink" title="ç¼–å†™æ‚¨è‡ªå·±çš„é€‚é…å™¨"></a>ç¼–å†™æ‚¨è‡ªå·±çš„é€‚é…å™¨</h3><p>æœ‰å…´è¶£æ·»åŠ è‡ªå·±çš„é€‚é…å™¨ï¼ŸæŸ¥çœ‹æˆ‘ä»¬ç”¨äº<a target="_blank" rel="noopener" href="https://hubot.github.com/docs/adapters/development/">å¼€å‘é€‚é…å™¨</a>çš„æ–‡æ¡£ã€‚</p><h3 id="Campfire-é€‚é…å™¨"><a href="#Campfire-é€‚é…å™¨" class="headerlink" title="Campfire é€‚é…å™¨"></a>Campfire é€‚é…å™¨</h3><p><a target="_blank" rel="noopener" href="http://campfirenow.com/">Campfire</a>æ˜¯ä¸€ä¸ªç”±<a target="_blank" rel="noopener" href="http://37signals.com/">37signals</a>æ„å»ºçš„åŸºäº web çš„èŠå¤©åº”ç”¨ã€‚Campfire æ˜¯ hubot çš„ä¸€ä¸ªåŸè£…é€‚é…å™¨ã€‚</p><h4 id="èµ·æ­¥"><a href="#èµ·æ­¥" class="headerlink" title="èµ·æ­¥"></a>èµ·æ­¥</h4><p>æ‚¨å°†éœ€è¦ä¸€ä¸ªCampfireå¸æˆ·æ¥å¼€å§‹ï¼Œä½ å¯ä»¥<a target="_blank" rel="noopener" href="https://signup.37signals.com/campfire/free/signup/new">å…è´¹æ³¨å†Œ</a>ã€‚</p><p>ä¸‹ä¸€æ­¥ï¼Œä½ éœ€è¦ä¸ºä½ çš„ hubot åœ¨ Campfire è´¦æˆ·ä¸Šåˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼Œç„¶åç»™å®ƒè®¿é—®æƒé™ï¼Œä»¥ä¾¿å®ƒå¯ä»¥åŠ å…¥æ‚¨çš„æˆ¿é—´ã€‚å¦‚æœæ‚¨å°šæœªåˆ›å»ºæˆ¿é—´ï¼Œåˆ™éœ€è¦åˆ›å»ºä¸€ä¸ªæˆ¿é—´ã€‚</p><p>Hubot é»˜è®¤ä½¿ç”¨å®ƒçš„ <a target="_blank" rel="noopener" href="https://hubot.github.com/docs/adapters/shell/">shell</a>ï¼Œç”¨ Campfire æ›¿ä»£ï¼Œä½ éœ€è¦å¸¦ä¸Š <code>-a campfire</code> è¿è¡Œ hubotï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/hubot -a campfire</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä½ éƒ¨ç½²åˆ° Heroku æˆ–è€…ä½¿ç”¨ foremanï¼Œä½ éœ€è¦ç¡®ä¿åœ¨ <code>Procfile</code> ä¸­æºå¸¦<code>-a campfire</code> è¢«è°ƒç”¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web: bin/hubot -a campfire -n Hubot</span><br></pre></td></tr></table></figure><h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>é€‚é…å™¨éœ€è¦ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š</p><ul><li><code>HUBOT_CAMPFIRE_ACCOUNT</code></li><li><code>HUBOT_CAMPFIRE_TOKEN</code></li><li><code>HUBOT_CAMPFIRE_ROOMS</code></li></ul><h5 id="Campfire-API-ä»¤ç‰Œ"><a href="#Campfire-API-ä»¤ç‰Œ" class="headerlink" title="Campfire API ä»¤ç‰Œ"></a>Campfire API ä»¤ç‰Œ</h5><p>è¿™å¯ä»¥é€šè¿‡ç™»å½•æ‚¨çš„ hubot çš„å¸æˆ·ï¼Œç‚¹å‡» <code>My Info</code> é“¾æ¥æ¥æ‰¾åˆ°ï¼Œ å¹¶è®°ä¸‹ API ä»¤ç‰Œã€‚</p><h5 id="Campfire-æˆ¿é—´å·"><a href="#Campfire-æˆ¿é—´å·" class="headerlink" title="Campfire æˆ¿é—´å·"></a>Campfire æˆ¿é—´å·</h5><p>å¦‚æœä½ åŠ å…¥äº†ä½ å¸Œæœ›ä½ çš„hubotåŠ å…¥çš„æˆ¿é—´ï¼Œä½ å¯ä»¥çœ‹è§åœ¨URLä¸­çš„æˆ¿é—´çš„æ•°å­— IDã€‚è®°ä¸‹ä½ æƒ³ä½ çš„ hubot åŠ å…¥çš„æ¯ä¸ªæˆ¿é—´ IDã€‚</p><h5 id="Campfire-è´¦æˆ·"><a href="#Campfire-è´¦æˆ·" class="headerlink" title="Campfire è´¦æˆ·"></a>Campfire è´¦æˆ·</h5><p>è¿™åªæ˜¯æ‚¨è®¿é—® Campfire å¸æˆ·çš„åŸŸåçš„ç¬¬ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„ Campfire æ˜¯<code>hubot.campfirenow.com</code>ï¼Œä½ çš„äºŒçº§åŸŸåæ˜¯<code>hubot</code>ã€‚è®°ä¸‹è¿™ä¸ªäºŒçº§åŸŸåã€‚</p><h5 id="åœ¨-Heroku-ä¸Šé…ç½®ç¯å¢ƒå˜é‡"><a href="#åœ¨-Heroku-ä¸Šé…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="åœ¨ Heroku ä¸Šé…ç½®ç¯å¢ƒå˜é‡"></a>åœ¨ Heroku ä¸Šé…ç½®ç¯å¢ƒå˜é‡</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> heroku config:<span class="built_in">set</span> HUBOT_CAMPFIRE_TOKEN=<span class="string">&quot;...&quot;</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> heroku config:<span class="built_in">set</span> HUBOT_CAMPFIRE_ROOMS=<span class="string">&quot;123,321&quot;</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> heroku config:<span class="built_in">set</span> HUBOT_CAMPFIRE_ACCOUNT=<span class="string">&quot;...&quot;</span></span></span><br></pre></td></tr></table></figure><h5 id="åœ¨-Unix-ä¸Šé…ç½®ç¯å¢ƒå˜é‡"><a href="#åœ¨-Unix-ä¸Šé…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="åœ¨ Unix ä¸Šé…ç½®ç¯å¢ƒå˜é‡"></a>åœ¨ Unix ä¸Šé…ç½®ç¯å¢ƒå˜é‡</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> HUBOT_CAMPFIRE_TOKEN=<span class="string">&quot;...&quot;</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> HUBOT_CAMPFIRE_ROOMS=<span class="string">&quot;123,321&quot;</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> HUBOT_CAMPFIRE_ACCOUNT=<span class="string">&quot;...&quot;</span></span></span><br></pre></td></tr></table></figure><h5 id="åœ¨-Windows-ä¸Šé…ç½®ç¯å¢ƒå˜é‡"><a href="#åœ¨-Windows-ä¸Šé…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="åœ¨ Windows ä¸Šé…ç½®ç¯å¢ƒå˜é‡"></a>åœ¨ Windows ä¸Šé…ç½®ç¯å¢ƒå˜é‡</h5><p>ä½¿ç”¨ PowerShellï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">setx HUBOT_CAMPFIRE_TOKEN &quot;...&quot; /m</span><br><span class="line"></span><br><span class="line">setx HUBOT_CAMPFIRE_ROOMS &quot;123,321&quot; /m</span><br><span class="line"></span><br><span class="line">setx HUBOT_CAMPFIRE_ACCOUNT &quot;...&quot; /m</span><br></pre></td></tr></table></figure><h3 id="Shell-é€‚é…å™¨"><a href="#Shell-é€‚é…å™¨" class="headerlink" title="Shell é€‚é…å™¨"></a>Shell é€‚é…å™¨</h3><p>Shell é€‚é…å™¨æä¾›ä¸€ä¸ªç®€å•çš„è¯»å–æ‰“å°å¾ªç¯ï¼Œç”¨äºä¸æœ¬åœ° hubot è¿›è¡Œäº¤äº’ã€‚å®ƒå¯ç”¨äºåœ¨hubot ä¸Šä½¿ç”¨è„šæœ¬ä¹‹å‰æµ‹è¯•è„šæœ¬ã€‚</p><h4 id="èµ·æ­¥-1"><a href="#èµ·æ­¥-1" class="headerlink" title="èµ·æ­¥"></a>èµ·æ­¥</h4><p>è¦ä½¿ç”¨å¤–å£³é€‚é…å™¨ï¼Œæ‚¨å¯ä»¥åœ¨è¿è¡Œ hubot æ—¶ç®€å•åœ°çœç•¥ -a é€‰é¡¹ï¼Œå› ä¸ºå®ƒé»˜è®¤ä¼šä½¿ç”¨ Shell é€‚é…å™¨ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/hubot</span></span><br></pre></td></tr></table></figure><h4 id="é…ç½®-1"><a href="#é…ç½®-1" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>è¿™ä¸ªé€‚é…å™¨ä¸éœ€è¦ä»»ä½•é…ç½®ã€‚</p><p>å®ƒæ”¯æŒä¸¤ä¸ªç¯å¢ƒå˜é‡ä»¥æ”¯æŒä½œä¸ºä¸åŒçš„ç”¨æˆ·æµ‹è¯•è„šæœ¬ï¼š</p><ul><li>HUBOT_SHELL_USER_ID: default is 1</li><li>HUBOT_SHELL_USER_NAME: default is Shell</li></ul><h3 id="å¼€å‘é€‚é…å™¨"><a href="#å¼€å‘é€‚é…å™¨" class="headerlink" title="å¼€å‘é€‚é…å™¨"></a>å¼€å‘é€‚é…å™¨</h3><h4 id="é€‚é…å™¨åŸºç¡€"><a href="#é€‚é…å™¨åŸºç¡€" class="headerlink" title="é€‚é…å™¨åŸºç¡€"></a>é€‚é…å™¨åŸºç¡€</h4><p>æ‰€æœ‰é€‚é…å™¨ç»§æ‰¿è‡ªåœ¨ <code>src/adapter.coffee</code> æ–‡ä»¶ä¸­çš„é€‚é…å™¨ç±»ã€‚æœ‰æ˜ç¡®çš„ä½ æƒ³å»é‡å†™çš„æ–¹æ³•ã€‚ä¸‹é¢æ˜¯æ‰©å±•é€‚é…å™¨ç±»çš„åŸºæœ¬æ¡©ä»£ç ï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sample</span> <span class="keyword">extends</span> <span class="title">Adapter</span></span></span><br><span class="line"></span><br><span class="line">  constructor: <span class="function">-&gt;</span></span><br><span class="line">    <span class="built_in">super</span></span><br><span class="line">    @robot.logger.info <span class="string">&quot;Constructor&quot;</span></span><br><span class="line"></span><br><span class="line">  send: <span class="function"><span class="params">(envelope, strings...)</span> -&gt;</span></span><br><span class="line">    @robot.logger.info <span class="string">&quot;Send&quot;</span></span><br><span class="line"></span><br><span class="line">  reply: <span class="function"><span class="params">(envelope, strings...)</span> -&gt;</span></span><br><span class="line">    @robot.logger.info <span class="string">&quot;Reply&quot;</span></span><br><span class="line"></span><br><span class="line">  run: <span class="function">-&gt;</span></span><br><span class="line">    @robot.logger.info <span class="string">&quot;Run&quot;</span></span><br><span class="line">    @emit <span class="string">&quot;connected&quot;</span></span><br><span class="line">    user = <span class="keyword">new</span> User <span class="number">1001</span>, name: <span class="string">&#x27;Sample User&#x27;</span></span><br><span class="line">    message = <span class="keyword">new</span> TextMessage user, <span class="string">&#x27;Some Sample Message&#x27;</span>, <span class="string">&#x27;MSG-001&#x27;</span></span><br><span class="line">    @robot.receive message</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.use = <span class="function"><span class="params">(robot)</span> -&gt;</span></span><br><span class="line">  <span class="keyword">new</span> Sample robot</span><br></pre></td></tr></table></figure><h4 id="é…ç½®æ‚¨çš„å¼€å‘ç¯å¢ƒ"><a href="#é…ç½®æ‚¨çš„å¼€å‘ç¯å¢ƒ" class="headerlink" title="é…ç½®æ‚¨çš„å¼€å‘ç¯å¢ƒ"></a>é…ç½®æ‚¨çš„å¼€å‘ç¯å¢ƒ</h4><ol><li>ä¸ºæ‚¨çš„é€‚é…å™¨<code>hubot-sample</code>åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ã€‚<ul><li><code>mkdir hubot-sample</code></li></ul></li><li>åˆ‡æ¢æ‚¨çš„å·¥ä½œè·¯å¾„åˆ°<code>hubot-sample</code><ul><li><code>cd hubot-sample</code></li></ul></li><li>è¿è¡Œ<code>npm init</code>å»åˆ›å»ºæ‚¨çš„ package.json<ul><li>ç¡®ä¿å…¥å£æ˜¯<code>src/sample.coffee</code></li></ul></li><li>æ·»åŠ æ‚¨çš„<code>.gitignore</code>å»åŒ…å«<code>node_modules</code>ã€‚</li><li>ç¼–è¾‘ <code>src/sample.coffee</code> æ–‡ä»¶ä¸ºæ‚¨çš„é€‚é…å™¨å»åŒ…å«ä¸Šè¿°çš„æ¡©ä»£ç ã€‚</li><li>ç¼–è¾‘<code>package.json</code>å»ä¸ºhubotæ·»åŠ  peer ä¾èµ–ã€‚<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;peerDependencies&quot;</span>: &#123;</span><br><span class="line">  <span class="attr">&quot;hubot&quot;</span>: <span class="string">&quot;&gt;=2.0&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">  <span class="attr">&quot;coffee-script&quot;</span>: <span class="string">&quot;&gt;=1.2.0&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>ç”¨<code>yo hubot</code><a target="_blank" rel="noopener" href="https://hubot.github.com/docs/">å‘½ä»¤</a>ç”Ÿæˆæ‚¨çš„hubotã€‚</li><li>åˆ‡æ¢å·¥ä½œç›®å½•åˆ°<code>hubot</code>ä½ åœ¨ç¬¬ä¸ƒæ­¥åˆ›å»ºçš„ã€‚</li><li>ç°åœ¨æ‰§è¡Œ<code>npm link</code>å»æ·»åŠ æ‚¨çš„é€‚é…å™¨åˆ°<code>hubot</code><ul><li><code>npm link ../hubot-sample</code></li></ul></li><li>è¿è¡Œ<code>hubot -a sample</code>ã€‚</li></ol><h4 id="Gochas"><a href="#Gochas" class="headerlink" title="Gochas"></a>Gochas</h4><p>åœ¨ node ç¤¾åŒºæœ‰ä¸€ä¸ªå¼€æ”¾çš„è®®é¢˜å›´ç»•<a target="_blank" rel="noopener" href="https://github.com/npm/npm/issues/5875">npm é“¾æ¥çš„ peer ä¾èµ–ä¸å·¥ä½œ</a>ã€‚è¦è®©æˆ‘ä»¬çš„é¡¹ç›®å·¥ä½œï¼Œæ‚¨çš„ä»£ç éœ€è¦åšä¸€äº›å°çš„ä¿®æ”¹ã€‚</p><ol><li>å¼•å…¥æ‚¨çš„ <code>hubot-sample</code> é€‚é…å™¨ï¼Œæ·»åŠ ä¸‹é¢çš„ä»£ç ï¼š<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">  &#123;Robot,Adapter,TextMessage,User&#125; = <span class="built_in">require</span> <span class="string">&#x27;hubot&#x27;</span></span><br><span class="line"><span class="keyword">catch</span></span><br><span class="line">  prequire = <span class="built_in">require</span>(<span class="string">&#x27;parent-require&#x27;</span>)</span><br><span class="line">  &#123;Robot,Adapter,TextMessage,User&#125; = prequire <span class="string">&#x27;hubot&#x27;</span></span><br></pre></td></tr></table></figure></li><li>åœ¨æ‚¨çš„<code>hubot-sample</code>æ–‡ä»¶å¤¹ï¼Œä¿®æ”¹<code>package.json</code>å»åŒ…å«ä¸‹é¢çš„ä¾èµ–ä»¥è‡³äºè¿™ç§è‡ªå®šä¹‰å¯¼å…¥æœºåˆ¶å°†èµ·ä½œç”¨<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">  <span class="attr">&quot;parent-require&quot;</span>: <span class="string">&quot;^1.0.0&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>ç°åœ¨å°è¯•å†è¿è¡Œ<code>hubot -a sample</code>å¹¶çœ‹åˆ°å¼•å…¥æ­£å¸¸åŠ è½½äº†ã€‚</li><li>ä¸€æ—¦è¿™å·¥ä½œæ­£å¸¸ï¼Œæ‚¨å¯ä»¥æ ¹æ®æ‚¨è®¤ä¸ºåˆé€‚çš„æƒ…å†µæ„å»ºé€‚é…å™¨çš„åŠŸèƒ½ã€‚çœ‹çœ‹å…¶ä»–ä¸€äº›é€‚é…å™¨ï¼Œè·å–ä¸€äº›å®ç°æƒ³æ³•ã€‚<ul><li>ä¸€æ—¦é€šè¿‡ <code>npm</code> è¿›è¡Œæ‰“åŒ…å’Œéƒ¨ç½²ï¼Œæ‚¨å°±ä¸å†éœ€è¦åœ¨ <code>hubot</code> ä¸­çš„ä¾èµ–æ€§äº†ï¼Œå› ä¸º peer ä¾èµ–åº”è¯¥ä½œä¸ºå®˜æ–¹æ¨¡å—å·¥ä½œã€‚</li></ul></li></ol><h2 id="éƒ¨ç½²-1"><a href="#éƒ¨ç½²-1" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><h3 id="éƒ¨ç½²åˆ°-Heroku"><a href="#éƒ¨ç½²åˆ°-Heroku" class="headerlink" title="éƒ¨ç½²åˆ° Heroku"></a>éƒ¨ç½²åˆ° Heroku</h3><p>å¦‚æœä½ ä¸€ç›´è·Ÿç€<a target="_blank" rel="noopener" href="https://hubot.github.com/docs/">å®˜æ–¹æ–‡æ¡£</a>åˆ°äº†è¿™é‡Œï¼Œæ˜¯æ—¶å€™éƒ¨ç½²äº†ï¼Œè¿™æ ·ä½ å°±ä¸ä»…åœ¨ä½ çš„æœ¬åœ°æœºå™¨èƒ½ä½¿ç”¨å®ƒäº†ã€‚<a target="_blank" rel="noopener" href="http://www.heroku.com/">Heroku</a>æ˜¯éƒ¨ç½²hubotçš„æœ€ç®€å•å’Œæ”¯æŒçš„æ–¹å¼ã€‚</p><p>å®‰è£… <a target="_blank" rel="noopener" href="https://toolbelt.heroku.com/">Heroku Toolbelt</a> å»å¼€å§‹ï¼Œç„¶åè·Ÿç€ä»–ä»¬çš„â€œGetting Startedâ€æ“ä½œæŒ‡å—ï¼ŒåŒ…æ‹¬ç¬¬ä¸€æ¬¡ç™»å½•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ heroku login</span><br><span class="line">Enter your Heroku credentials.</span><br><span class="line">Email: youremail@example.com</span><br><span class="line">Password:</span><br><span class="line">Could not find an existing public key.</span><br><span class="line">Would you like to generate one? [Yn]</span><br><span class="line">Generating new SSH public key.</span><br><span class="line">Uploading ssh public key /Users/you/.ssh/id_rsa.pub</span><br></pre></td></tr></table></figure><p>åœ¨æ–°çš„ hubot ç›®å½•ä¸­ï¼Œè¯·ç¡®ä¿æ‚¨åˆ›å»ºäº† git ä»“åº“ï¼Œå¹¶ä¸”æ‚¨çš„ä»£ç å·²ç»è¢« commitï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git init</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git add .</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git commit -m <span class="string">&quot;Initial commit&quot;</span></span></span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ª Heroku åº”ç”¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> heroku create</span></span><br><span class="line">Creating rosemary-britches-123... done, stack is cedar</span><br><span class="line">http://rosemary-britches-123.herokuapp.com/ | git@heroku.com:rosemary-britches-123.git</span><br><span class="line">Git remote heroku added</span><br></pre></td></tr></table></figure><p>åœ¨æ‚¨éƒ¨ç½²åº”ç”¨ä¹‹å‰ï¼Œæ‚¨éœ€è¦é…ç½®ä¸€äº›ç¯å¢ƒå˜é‡ï¼Œä¾› hubot ä½¿ç”¨ã€‚æ‚¨éœ€è¦çš„ç‰¹å®šå˜é‡å–å†³äºæ‚¨æ­£åœ¨ä½¿ç”¨çš„é€‚é…å™¨å’Œè„šæœ¬ã€‚å¯¹äº Campfireï¼Œæ²¡æœ‰å…¶å®ƒè„šæœ¬çš„è¯ï¼Œä½ éœ€è¦å»è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> heroku config:<span class="built_in">set</span> HUBOT_CAMPFIRE_ACCOUNT=yourcampfireaccount</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> heroku config:<span class="built_in">set</span> HUBOT_CAMPFIRE_TOKEN=yourcampfiretoken</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> heroku config:<span class="built_in">set</span> HUBOT_CAMPFIRE_ROOMS=comma,separated,list,of,rooms,to,join</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œæ‚¨å·²å‡†å¤‡å¥½éƒ¨ç½²å¹¶å¼€å§‹èŠå¤©ã€‚ä½¿ç”¨ Herokuï¼Œå°±æ˜¯æ‰§è¡Œ git pushï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git push heroku master</span></span><br></pre></td></tr></table></figure><p>æ‚¨ä¼šçœ‹åˆ°ä¸€äº›æ–‡æœ¬é£è¿‡ï¼Œæœ€ç»ˆæ˜¯æˆåŠŸçš„ã€‚æ­¤æ—¶æ‚¨åº”è¯¥å¯ä»¥åœ¨æ‚¨é…ç½®çš„èŠå¤©å®¤ï¼Œçœ‹è§æ‚¨çš„æœºå™¨äººã€‚å¦‚æœæ²¡æœ‰ï¼Œæ‚¨å¯ä»¥çœ‹ä¸€çœ‹æ—¥å¿—å»è°ƒè¯•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> heroku logs</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚¨å¯¹æ‚¨çš„ hubot åšäº†ä¸€äº›æ”¹å˜ï¼Œåœ¨ push å®ƒä»¬ä¹‹å‰ï¼Œcommit ä¸€ä¸‹å°±å¥½ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git commit -am <span class="string">&quot;Awesome scripts OMG&quot;</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git push heroku master</span></span><br></pre></td></tr></table></figure><p>ä¸€äº›è„šæœ¬éœ€è¦ redis æ¥è¿è¡Œï¼ŒHeroku æä¾›ä¸€ä¸ªå« <a target="_blank" rel="noopener" href="https://addons.heroku.com/rediscloud">Redis Cloud</a> çš„é™„åŠ è£…ç½®ï¼Œå®ƒæ˜¯æœ‰å…è´¹è®¡åˆ’çš„ã€‚ä½¿ç”¨å®ƒï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> heroku addons:create rediscloud</span></span><br></pre></td></tr></table></figure><p>åœ¨Herokuä¸Šçš„å…è´¹çš„dynoåœ¨<a target="_blank" rel="noopener" href="https://devcenter.heroku.com/articles/dyno-sleeping">ä¸æ´»è·ƒ30åˆ†é’Ÿåå°†ä¼‘çœ </a>ã€‚é‚£æ„å‘³ç€æ‚¨çš„hubotå°†ç¦»å¼€èŠå¤©å®¤å¹¶ä¸”ä»…é‡æ–°åŠ å…¥å½“å®ƒè·å¾—æµé‡ã€‚è¿™æ˜¯æåº¦ä¸æ–¹ä¾¿çš„å› ä¸ºå¤§å¤šæ•°äº¤äº’éƒ½æ˜¯é€šè¿‡èŠå¤©å®Œæˆçš„ï¼Œhubot å¿…é¡»åœ¨çº¿ã€åœ¨æˆ¿é—´é‡Œå›å¤æ¶ˆæ¯ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªä¸´æ—¶æ–¹æ¡ˆæ˜¯ï¼Œä½ å¯ä»¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/hubot-scripts/hubot-heroku-keepalive">hubot-heroku-keepalive</a>è„šæœ¬ï¼Œå®ƒå¯ä»¥è®©æ‚¨å…è´¹çš„dynoæ´»è·ƒæ—¶é—´æå‡åˆ°18å°æ—¶æ¯å¤©ã€‚å¦‚æœä½ ä¸æƒ³ä½ çš„ hubot ä¼‘çœ ï¼Œä½ å¯èƒ½å°±éœ€è¦<a target="_blank" rel="noopener" href="https://www.heroku.com/pricing">å‡çº§åˆ° Heroku çš„ bobby è®¡åˆ’</a>ã€‚</p><h3 id="éƒ¨ç½²åˆ°-Unix"><a href="#éƒ¨ç½²åˆ°-Unix" class="headerlink" title="éƒ¨ç½²åˆ° Unix"></a>éƒ¨ç½²åˆ° Unix</h3><p>ç”±äº Linux çš„å˜ç§å¾ˆå¤šï¼Œä»¥åŠ UNIXï¼Œå› æ­¤ hubot å›¢é˜Ÿå¾ˆéš¾æ‹¥æœ‰è§„èŒƒæ–‡æ¡£ï¼Œç”¨äºå®‰è£…å’Œéƒ¨ç½²åˆ°æ¯ä¸ªç‰ˆæœ¬ã€‚å› æ­¤ï¼Œè¿™è¯•å›¾æ¦‚è¿°éƒ¨ç½²æ‰€éœ€çš„å†…å®¹ã€‚</p><p>æœ‰3ä¸ªä¸»è¦çš„ä¸œè¥¿å»éƒ¨ç½²å’Œè¿è¡Œ hubotï¼š</p><ul><li>node å’Œ npm</li><li>åœ¨æœåŠ¡å™¨ä¸Šæ›´æ–°æºä»£ç çš„æ–¹æ³•</li><li>å¯åŠ¨ hubot çš„æ–¹æ³•ï¼Œ åœ¨å´©æºƒæ—¶å¯åŠ¨å®ƒï¼Œ å¹¶åœ¨ä»£ç æ›´æ–°æ—¶é‡æ–°å¯åŠ¨å®ƒ</li></ul><h4 id="node-å’Œ-npm"><a href="#node-å’Œ-npm" class="headerlink" title="node å’Œ npm"></a>node å’Œ npm</h4><p>é¦–å…ˆï¼Œæ‚¨çš„ UNIX æœåŠ¡å™¨å°†éœ€è¦ node å’Œ npmã€‚æŸ¥çœ‹node.js çš„ wikiï¼š<a target="_blank" rel="noopener" href="https://github.com/joyent/node/wiki/Installing-Node.js-via-package-manager">é€šè¿‡åŒ…ç®¡ç†å™¨å®‰è£… Node.js</a>ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/joyent/node/wiki/Installation#building-on-gnulinux-and-other-unix">åœ¨ GNU/Linux å’Œ å…¶å®ƒ UNIX ä¸Šç¼–è¯‘</a>ã€‚</p><h4 id="åœ¨æœåŠ¡å™¨ä¸Šæ›´æ–°ä»£ç "><a href="#åœ¨æœåŠ¡å™¨ä¸Šæ›´æ–°ä»£ç " class="headerlink" title="åœ¨æœåŠ¡å™¨ä¸Šæ›´æ–°ä»£ç "></a>åœ¨æœåŠ¡å™¨ä¸Šæ›´æ–°ä»£ç </h4><p>æ›´æ–° hubot ä»£ç çš„æœ€ç®€å•æ–¹æ³•æ˜¯å¯¹ hubot çš„æºä»£ç è¿›è¡Œ git checkoutï¼ˆæ‚¨åœ¨é˜…è¯»<a target="_blank" rel="noopener" href="https://hubot.github.com/docs/">å®˜æ–¹æ–‡æ¡£</a>æœŸé—´åˆ›å»ºçš„æºä»£ç ï¼Œè€Œä¸æ˜¯ github/hubot ä»“åº“ï¼‰ï¼Œåªéœ€ git pull å³å¯è·å–æ›´æ”¹ã€‚è¿™å¯èƒ½æ„Ÿè§‰ä¸å¤Ÿä¼˜é›…ï¼Œä½†æ˜¯åˆšå¼€å§‹çš„æ—¶å€™æ˜¯æœ‰ç”¨çš„ã€‚</p><p>å¦‚æœæ‚¨æœ‰ Ruby èƒŒæ™¯ï¼Œä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/capistrano/capistrano">capistrano</a> ä¼šè®©æ‚¨æ„Ÿåˆ°æ›´èˆ’æœã€‚</p><p>å¦‚æœæ‚¨æœ‰ <a target="_blank" rel="noopener" href="http://www.chef.io/chef/">Chef</a> èƒŒæ™¯ï¼Œæœ‰ä¸€ä¸ªç”¨äºç®¡ç†éƒ¨ç½²çš„<a target="_blank" rel="noopener" href="https://docs.chef.io/resource_deploy.html">éƒ¨ç½²</a>èµ„æºã€‚</p><h4 id="å¯åŠ¨ã€åœæ­¢å’Œé‡å¯-hubot"><a href="#å¯åŠ¨ã€åœæ­¢å’Œé‡å¯-hubot" class="headerlink" title="å¯åŠ¨ã€åœæ­¢å’Œé‡å¯ hubot"></a>å¯åŠ¨ã€åœæ­¢å’Œé‡å¯ hubot</h4><p>æ¯ä¸ªhubotå®‰è£…æœ‰ä¸€ä¸ª<code>bin/hubot</code>è„šæœ¬æ¥å¤„ç†å¯åŠ¨hubotã€‚æ‚¨å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šçš„ git checkout å¤„è¿è¡Œæ­¤å‘½ä»¤ï¼Œä½†æ˜¯æ‚¨å¯èƒ½ä¼šé­é‡ä¸€äº›é—®é¢˜ï¼š</p><ul><li>ä½ æ–­å¼€ç»ˆç«¯è¿æ¥ï¼Œhubot æŒ‚æ‰</li><li>hubot å› ä¸ºä¸€äº›åŸå› æŒ‚æ‰ï¼Œä¸ä¼šè‡ªå·±é‡æ–°å¯åŠ¨</li><li>å®ƒä¸ä¼šå¼€æœºè‡ªå¯</li></ul><p>è¦å¤„ç†æ–­å¼€è¿æ¥ï¼Œä½ å¯ä»¥åœ¨<a target="_blank" rel="noopener" href="http://www.gnu.org/software/screen/">screen session</a>ä¸­è¿è¡Œ<code>bin/hubot</code>ï¼Œæˆ–è€…ä½¿ç”¨<a target="_blank" rel="noopener" href="http://linux.die.net/man/1/nohup">nohup</a>ã€‚</p><p>è¦å¤„ç† hubot æŒ‚æ‰ï¼Œå’Œè‡ªåŠ¨é‡å¯ï¼Œä½ å¯ä»¥æƒ³è±¡è¿è¡Œ<code>bin/hubot</code>åœ¨ä¸€ä¸ª<a target="_blank" rel="noopener" href="http://tldp.org/HOWTO/Bash-Prog-Intro-HOWTO-7.html#ss7.3">bash while å¾ªç¯</a>ã€‚ä½†çœŸçš„ï¼Œä½ å¯èƒ½æƒ³è¦ä¸€äº›è¿›ç¨‹ç›‘æ§å·¥å…·ï¼Œ å¦‚ <a target="_blank" rel="noopener" href="http://mmonit.com/monit/">monit</a>ã€<a target="_blank" rel="noopener" href="http://godrb.com/">god</a>ã€<a target="_blank" rel="noopener" href="https://github.com/arya/bluepill">bluepill</a>ã€<a target="_blank" rel="noopener" href="http://upstart.ubuntu.com/">upstart</a>ã€<a target="_blank" rel="noopener" href="http://smarden.org/runit/">runit</a>ã€ <a target="_blank" rel="noopener" href="http://freedesktop.org/wiki/Software/systemd/">systemd</a>ã€‚</p><p>è¦å¤„ç†å¼€æœºè‡ªå¯ï¼Œæ‚¨å¯ä»¥åˆ›å»ºé€‚åˆ UNIX åˆ†å‘çš„åˆå§‹åŒ–è„šæœ¬ã€‚å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨ä¸Šé¢çš„è¿›ç¨‹ç›‘æ§å·¥å…·ä¹‹ä¸€ï¼Œè¯·ç¡®ä¿å®ƒåœ¨å¯åŠ¨æ—¶å¯åŠ¨ã€‚æœ‰å…³é…ç½®<a target="_blank" rel="noopener" href="https://github.com/github/hubot/tree/master/examples">ç¤ºä¾‹</a>ï¼Œè¯·å‚é˜…ç¤ºä¾‹ã€‚</p><h4 id="å»ºè®®"><a href="#å»ºè®®" class="headerlink" title="å»ºè®®"></a>å»ºè®®</h4><p>æœ¬æ–‡æ¡£æœ‰æ„æ·¡åŒ–å¼ºçƒˆå»ºè®®ã€‚ä¸è¿‡åœ¨é«˜å±‚æ¬¡ä¸Šï¼Œå¼ºçƒˆå»ºè®®é¿å…ä»»ä½•è¿‡äºæ‰‹åŠ¨å’Œä¸å¯å¤ç°çš„ä¸œè¥¿ã€‚å°½å¯èƒ½ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„åŒ…å’Œå·¥å…·ï¼Œå¹¶ä½¿ç”¨é€‚å½“çš„éƒ¨ç½²å·¥å…·æ¥æ›´æ–° hubotï¼Œä»¥åŠè¿›ç¨‹ç®¡ç†ä»¥ä¿æŒ hubot çš„è¿è¡Œã€‚</p><h3 id="éƒ¨ç½²åˆ°-Windows"><a href="#éƒ¨ç½²åˆ°-Windows" class="headerlink" title="éƒ¨ç½²åˆ° Windows"></a>éƒ¨ç½²åˆ° Windows</h3><p>å°šæœªå®Œå…¨æµ‹è¯• â€”â€” ä½ çš„å†ç¨‹å¯èƒ½æœ‰æ‰€ä¸åŒï¼ˆYMMVï¼‰</p><p>åœ¨ Windows æœºå™¨ä¸Šï¼Œæœ‰å››ä¸ªä¸»è¦çš„éƒ¨ç½²è¿è¡Œ hubot çš„æ­¥éª¤ï¼š</p><ul><li>node å’Œ npm</li><li>åœ¨æœåŠ¡å™¨ä¸Šæ›´æ–°æºä»£ç çš„æ–¹æ³•</li><li>ä¸º hubot è®¾ç½®ç¯å¢ƒå˜é‡</li><li>å¯åŠ¨ hubotï¼Œ åœ¨å´©æºƒæ—¶å¯åŠ¨å®ƒï¼Œåœ¨ä»£ç æ›´æ–°æ—¶é‡æ–°å¯åŠ¨å®ƒçš„æ–¹æ³•</li></ul><h4 id="node-å’Œ-npm-1"><a href="#node-å’Œ-npm-1" class="headerlink" title="node å’Œ npm"></a>node å’Œ npm</h4><p>é¦–å…ˆï¼Œæ‚¨çš„ windows server éœ€è¦ node å’Œ npmã€‚æœ€ä½³æ–¹å¼æ˜¯ç”¨ <a target="_blank" rel="noopener" href="http://chocolatey.org/">chocolately</a> ä½¿ç”¨ <a target="_blank" rel="noopener" href="http://chocolatey.org/packages/nodejs.install">nodejs.install</a> åŒ… ã€‚æˆ‘å‘ç°åœ¨ç³»ç»Ÿä¸Šçš„ path å˜é‡æ²¡æœ‰è®¾ç½®æ­£ç¡®ï¼›ç¡®ä¿ä½ èƒ½é€šè¿‡å‘½ä»¤è¡Œè¿è¡Œ node/npmã€‚å¦‚æœä½ éœ€è¦è®¾ç½® path å˜é‡ï¼Œå°±ç”¨â€œsetx PATH â€œ%PATH%;C:\Program Files\nodejsâ€â€ã€‚</p><p>ä½ ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡<a target="_blank" rel="noopener" href="https://nodejs.org/">NodeJS</a> å®‰è£…ï¼Œè¿™å¯ä»¥ä¸ºä½ è®¾ç½®path å˜é‡ã€‚</p><blockquote><p>è¯‘è€…æ³¨ï¼šchocolately å’Œ scoop éƒ½æ˜¯ windows ä¸‹çš„åŒ…ç®¡ç†è½¯ä»¶ï¼Œè¯‘è€…ä½¿ç”¨çš„æ˜¯ scoopã€‚</p></blockquote><h4 id="æ›´æ–°æœåŠ¡å™¨ä¸Šçš„ä»£ç "><a href="#æ›´æ–°æœåŠ¡å™¨ä¸Šçš„ä»£ç " class="headerlink" title="æ›´æ–°æœåŠ¡å™¨ä¸Šçš„ä»£ç "></a>æ›´æ–°æœåŠ¡å™¨ä¸Šçš„ä»£ç </h4><p>åœ¨æ‚¨çš„æœ¬åœ°æœºå™¨æˆ–ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šï¼Œå»è·å–æ‚¨æœåŠ¡å™¨ä¸Šçš„ä»£ç ï¼Œæ‚¨å¯ä»¥è·Ÿç€åœ¨<a target="_blank" rel="noopener" href="https://hubot.github.com/docs/">å®˜æ–¹æ–‡æ¡£</a>ä¸Šçš„æ“ä½œæŒ‡å—ã€‚å¦‚æœæ‚¨æœ¬åœ°æ„å»ºï¼Œæ¨é€æ‚¨çš„hubotåˆ°Githubå¹¶ä¸”å…‹éš†ä»“åº“åˆ°æ‚¨çš„æœåŠ¡å™¨ä¸Šã€‚ä¸è¦å…‹éš†è¿™æ ‡å‡†çš„<a target="_blank" rel="noopener" href="http://github.com/github/hubot">github/hubot repository</a>ï¼Œç¡®ä¿æ‚¨ç”¨ Yo Generator å»æ„å»ºæ‚¨è‡ªå·±çš„ hubotã€‚</p><h4 id="è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="è®¾ç½®ç¯å¢ƒå˜é‡"></a>è®¾ç½®ç¯å¢ƒå˜é‡</h4><p>æ‚¨ä¼šæƒ³è®¾ç½®æ‚¨çš„ hubot ç¯å¢ƒå˜é‡ï¼Œåœ¨å®ƒè¿è¡Œçš„æœåŠ¡å™¨ä¸Šã€‚æ‚¨å¯ä»¥å®ç°è¿™ä¸ªé€šè¿‡æ‰“å¼€ä¸€ä¸ªæœ‰ç®¡ç†å‘˜æƒé™çš„ PowerShell å¹¶ä¸”é”®å…¥å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Environment]::SetEnvironmentVariable(&quot;HUBOT_ADAPTER&quot;, &quot;Campfire&quot;, &quot;Machine&quot;)</span><br></pre></td></tr></table></figure><p>è¿™ç›¸å½“äºå»ç³»ç»Ÿèœå• -&gt; é€‰æ‹©é«˜çº§ç³»ç»Ÿè®¾ç½® -&gt; ç¯å¢ƒå˜é‡å¹¶ä¸”æ·»åŠ ä¸€ä¸ªæ–°çš„ç³»ç»Ÿå˜é‡å« HUBOT_ADAPTERï¼Œå€¼ä¸º Campfireã€‚</p><h4 id="å¯åŠ¨ã€åœæ­¢å’Œé‡å¯-hubot-1"><a href="#å¯åŠ¨ã€åœæ­¢å’Œé‡å¯-hubot-1" class="headerlink" title="å¯åŠ¨ã€åœæ­¢å’Œé‡å¯ hubot"></a>å¯åŠ¨ã€åœæ­¢å’Œé‡å¯ hubot</h4><p>æ¯ä¸ªhubotå®‰è£…æœ‰ä¸€ä¸ª <code>bin/hubot</code> è„šæœ¬å»å¤„ç†hubotçš„å¯åŠ¨ã€‚æ‚¨å¯ä»¥åœ¨æ‚¨çš„ hubot çš„æ–‡ä»¶å¤¹ä¸‹ç›´æ¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\bin\hubot â€“adapter campfire</span><br></pre></td></tr></table></figure><p>ä¸è¿‡ï¼Œå¦‚æœæ‚¨æ‰‹åŠ¨è°ƒç”¨ï¼Œåˆ™å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚</p><ul><li>ä½ æ–­å¼€è¿æ¥ï¼Œhubot ä¹ŸæŒ‚æ‰</li><li>hubot å› ä¸ºæŸäº›åŸå› æŒ‚æ‰ï¼Œä¸ä¼šé‡å¯</li><li>hubot ä¸å¼€æœºè‡ªå¯</li></ul><p>è§£å†³è¿™äº›ï¼Œæ‚¨å¯èƒ½æƒ³åˆ›å»ºä¸€ä¸ªæ‚¨å°†ä»æ‚¨çš„hubotè·¯å¾„è°ƒç”¨çš„ .ps1 æ–‡ä»¶ï¼Œç”¨æ‚¨å–œæ¬¢çš„åå­—ã€‚<a target="_blank" rel="noopener" href="https://hubot.github.com/_submodules/hubot/examples/hubot-start.ps1">æ­¤</a><code>examples</code>ç›®å½•ä¸­æœ‰æ­¤æ–‡ä»¶çš„å‰¯æœ¬ã€‚å®ƒåº”åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Write-Host &quot;Starting Hubot Watcher&quot;</span><br><span class="line">While (1)</span><br><span class="line">&#123;</span><br><span class="line">    Write-Host &quot;Starting Hubot&quot;</span><br><span class="line">    Start-Process powershell -ArgumentList &quot;.\bin\hubot â€“adapter slack&quot; -wait</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚¨ä½¿ç”¨ .ps1 æ–‡ä»¶æ¥è¿è¡Œ hubotï¼Œè®°å¾—å…è®¸æœ¬åœ°æœªç­¾åçš„ PowerShell è„šæœ¬ã€‚åœ¨ä¸€ä¸ªç®¡ç†å‘˜æƒé™çš„ PowerShell çª—å£è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-ExecutionPolicy RemoteSigned</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚¨æƒ³ç”¨ä¸€äº›å…¶å®ƒçš„æ–¹å¼å»å¯åŠ¨æ‚¨çš„è¿›ç¨‹ï¼Œæ‚¨å¯ä»¥è®¾ç½®è¿™ä¸ª .ps1 æ–‡ä»¶ä¸ºä¸€ä¸ªé¢„å¯åŠ¨é¡¹ã€‚</p><h4 id="æ‰©å……æ–‡æ¡£"><a href="#æ‰©å……æ–‡æ¡£" class="headerlink" title="æ‰©å……æ–‡æ¡£"></a>æ‰©å……æ–‡æ¡£</h4><p>è¿˜ä¸å¤Ÿå®Œæ•´ï¼Œæ„Ÿè°¢æ‚¨ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/github/hubot/pull/new/master">å¸®åŠ©è´¡çŒ®æäº¤ä¸€ä¸ª pull requestï¼Ÿ</a></p><h3 id="éƒ¨ç½²åˆ°-Azure"><a href="#éƒ¨ç½²åˆ°-Azure" class="headerlink" title="éƒ¨ç½²åˆ° Azure"></a>éƒ¨ç½²åˆ° Azure</h3><p>å¦‚æœä½ ä¸€ç›´è·Ÿéšç€<a target="_blank" rel="noopener" href="https://hubot.github.com/docs/">æœ¬æ–‡æ¡£</a>åˆ°ç°åœ¨ã€‚æ˜¯æ—¶å€™éƒ¨ç½²äº†ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥åœ¨æœ¬åœ°æœºå™¨ä¹‹å¤–ä½¿ç”¨å®ƒã€‚<a target="_blank" rel="noopener" href="http://azure.microsoft.com/">Azure</a>æ˜¯éƒ¨ç½² hubot çš„ä¸€ç§æ–¹å¼ï¼Œæ˜¯ Heroku çš„æ›¿ä»£æ–¹æ¡ˆã€‚</p><p>æŒ‰ç…§hubotçš„åˆå§‹è¯´æ˜è¿›è¡Œæ“ä½œåï¼Œæ‚¨å°†éœ€è¦é€šè¿‡npmå®‰è£…azure-cliã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g azure-cli</span><br></pre></td></tr></table></figure><p>åœ¨æ–°çš„ hubot ç›®å½•ä¸­ï¼Œè¯·ç¡®ä¿æ‚¨åˆ›å»ºäº† git ä»“åº“ï¼Œå¹¶ä¸”æ‚¨ä»£ç å·²ç» commitï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git init</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git add .</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git commit -m <span class="string">&quot;Initial commit&quot;</span></span></span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œä¸ºæ‚¨çš„ hubot åˆ›å»ºä¸€ä¸ª <a target="_blank" rel="noopener" href="https://help.github.com/articles/create-a-repo/">Github repository</a>ã€‚Azure å°±å¯ä»¥ä»è¿™ä¸ª git ä»“åº“ï¼Œè€Œä¸æ˜¯ç›´æ¥ä»æ‚¨çš„å¼€å‘æœºå™¨æ‹‰å–ä»£ç äº†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git remote add origin _your GitHub repo_</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git push -u origin master</span></span><br></pre></td></tr></table></figure><p>ä¸€æ—¦æ‚¨æ‹¥æœ‰äº†æ‚¨çš„ Github ä»“åº“ï¼Œåˆ›å»ºä¸€ä¸ª Azure ç½‘ç«™é“¾æ¥åˆ°æ‚¨çš„ä»“åº“ã€‚åœ¨ Azureï¼Œåˆ›å»ºä¸€ä¸ªç½‘ç«™å¹¶ä¸”é€‰æ‹©æºç æ§åˆ¶ã€‚å½“å®ƒè¯¢é—®â€œæ‚¨çš„æºç æ§åˆ¶åœ¨å“ªé‡Œâ€ï¼Œé€‰æ‹© Github å¹¶ä¸”é“¾æ¥è¿™ä¸ªç½‘ç«™åˆ°æ‚¨åœ¨ä¸Šä¸€æ­¥åˆ›å»ºçš„ git ä»“åº“ã€‚å¦‚æœä½ ä¸‹è½½è¿‡ Azure PowerShell æ¨¡å—ï¼Œä½ å¯ä»¥é€šè¿‡PowerShell åšè¿™äº›ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ $creds = Get-Credential</span><br><span class="line">$ New-AzureWebsite mynewhubot -github -githubrepository yourgithubaccount/yourhubotreponame -githubcredentials $creds</span><br></pre></td></tr></table></figure><p>ä¸€æ—¦æ‚¨å®Œæˆäº†è¿™ä¸ªï¼ŒAzure å°†åœ¨æ‚¨ä»»ä½•æ—¶é—´æ¨é€ä»£ç åˆ° Github éƒ¨ç½²æ‚¨çš„ç½‘ç«™ã€‚ä¸è¿‡æ‚¨çš„ hubot è¿˜ä¸èƒ½æ­£å¸¸è¿è¡Œã€‚ä¸‹ä¸€æ­¥ï¼Œæ‚¨éœ€è¦æ‚¨é…ç½®éƒ¨ç½²ï¼Œ å‘Šè¯‰ Azure å¦‚ä½•è¿è¡Œhubotã€‚</p><p>é¦–å…ˆï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤å»æ·»åŠ  <code>deploy.cmd</code> åˆ°æ‚¨çš„hubotè·¯å¾„ã€‚è¿™æ˜¯ Azure ç”¨æ¥çŸ¥é“å¦‚ä½•éƒ¨ç½² node åº”ç”¨ç¨‹åºçš„æ–‡ä»¶ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> azure site deploymentscript --node</span></span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œç¼–è¾‘æ­¤æ–‡ä»¶å¹¶æŸ¥æ‰¾ä¸ºæ‚¨æä¾›æ­¥éª¤ 1ã€2 å’Œ 3 çš„éƒ¨åˆ†ã€‚æ‚¨å°†æ·»åŠ ç¬¬ 4 æ­¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:: 4. Create Hubot file with a coffee extension</span><br><span class="line">copy /Y &quot;%DEPLOYMENT_TARGET%\node_modules\hubot\bin\hubot&quot; &quot;%DEPLOYMENT_TARGET%\node_modules\hubot\bin\hubot.coffee&quot;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œåœ¨hubotçš„æ ¹è·¯å¾„ä¸‹åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶å«<code>server.js</code>ï¼Œå¹¶æ·»åŠ ä¸‹åˆ—ä¸¤è¡Œï¼š</p><figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;coffee-script/register&#x27;</span>);</span><br><span class="line"><span class="built_in">module</span>.<span class="built_in">exports</span> = <span class="built_in">require</span>(<span class="string">&#x27;hubot/bin/hubot.coffee&#x27;</span>);</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œæ‚¨éœ€è¦æ·»åŠ ç¯å¢ƒå˜é‡åˆ°ç½‘ç«™å»ç¡®ä¿å®ƒèƒ½å¤Ÿè¿è¡Œã€‚ä¸‹é¢çš„é…ç½®ï¼Œæ‚¨ä¹Ÿå¯ä»¥é€šè¿‡å›¾åƒç•Œé¢æ¥é…ç½®ï¼Œæˆ–è€…ç”¨ Azure PowerShell å‘½ä»¤è¡Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼ˆç¤ºä¾‹æ˜¾ç¤ºï¼šé€‚é…å™¨ä¸ºslackï¼Œ ç½‘ç«™åç§°ä¸ºmynewhubotï¼‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ $settings = New-Object Hashtable</span><br><span class="line">$ $settings[&quot;HUBOT_ADAPTER&quot;] = &quot;Slack&quot;</span><br><span class="line">$ $settings[&quot;HUBOT_SLACK_TOKEN&quot;] = &quot;yourslackapikey&quot;</span><br><span class="line">$ Set-AzureWebsite -AppSettings $settings mynewhubot</span><br></pre></td></tr></table></figure><p>Commit ä½ çš„æ”¹å˜åœ¨git ä»“åº“ï¼Œå¹¶æ¨é€åˆ°Githubï¼ŒAzure å°†è‡ªåŠ¨è·å–æ”¹å˜å¹¶ä¸”éƒ¨ç½²åˆ°ç½‘ç«™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -m &quot;Add Azure settings for hubot&quot;</span><br><span class="line">$ git push</span><br></pre></td></tr></table></figure><p>Azure æä¾›äº†ä¸€ä¸ªå¸‚åœºï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­ä½¿ç”¨ Redis Labs æä¾›çš„ Redis Cloud ä½¿ç”¨é»˜è®¤çš„ heroku-redis-brainã€‚æˆ–è€…ï¼Œè¦æ·»åŠ  Azure å­˜å‚¨å¤§è„‘ï¼Œæ‚¨éœ€è¦åˆ›å»º Azure å­˜å‚¨å¸æˆ·å’Œå¸æˆ·å¯†é’¥ã€‚ç„¶åæ‚¨å¯ä»¥åœ¨æ‚¨çš„ hubot æ ¹ç›®å½•ä¸­æ‰§è¡Œä»¥ä¸‹æ“ä½œã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm install hubot-azure-scripts --save</span></span><br></pre></td></tr></table></figure><p>ç„¶å <code>external-scripts.json</code> ä¸­æ·»åŠ ä»¥ä¸‹è¡Œä»¥åŠå…¶å®ƒå¤–éƒ¨è„šæœ¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;hubot-azure-scripts/brain/storage-blob-brain&quot;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œåœ¨æ‚¨çš„ç½‘ç«™ä¸­å†æ·»åŠ ä¸¤ä¸ªç¯å¢ƒå˜é‡ã€‚æ‚¨å¯ä»¥é€šè¿‡å›¾å½¢ç•Œé¢æˆ–ä»¥ä¸‹PowerShellå‘½ä»¤åšåˆ°è¿™ä¸€ç‚¹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ $settings = New-Object Hashtable</span><br><span class="line">$ $settings[&quot;HUBOT_BRAIN_AZURE_STORAGE_ACCOUNT&quot;] = &quot;your Azure storage account&quot;</span><br><span class="line">$ $settings[&quot;HUBOT_BRAIN_AZURE_STORAGE_ACCESS_KEY&quot;] = &quot;your Azure storage account key&quot;</span><br><span class="line">$ Set-AzureWebsite -AppSettings $settings mynewhubot</span><br></pre></td></tr></table></figure><p>ç°åœ¨ä»»ä½•éœ€è¦å¤§è„‘çš„è„šæœ¬éƒ½å¯ä»¥è¿è¡Œã€‚æ‚¨åº”è¯¥æŸ¥æ‰¾å…¶ä»–è„šæœ¬æˆ–é€šè¿‡æŸ¥çœ‹<a target="_blank" rel="noopener" href="https://hubot.github.com/docs/scripting/">æ–‡æ¡£</a>ç¼–å†™è‡ªå·±çš„è„šæœ¬ã€‚ Hubot çš„æ‰€æœ‰æ™®é€šè„šæœ¬éƒ½ä¸ Azure ä¸Šçš„æ‰˜ç®¡ hubot å…¼å®¹ã€‚</p><h4 id="æ•…éšœæ’é™¤æç¤ºå’ŒæŠ€å·§"><a href="#æ•…éšœæ’é™¤æç¤ºå’ŒæŠ€å·§" class="headerlink" title="æ•…éšœæ’é™¤æç¤ºå’ŒæŠ€å·§"></a>æ•…éšœæ’é™¤æç¤ºå’ŒæŠ€å·§</h4><p>ç”±äº Azure åŸºäº Windowsï¼Œæ‚¨å¯èƒ½ä¼šé‡åˆ°è·¯å¾„é•¿åº¦é—®é¢˜ã€‚è¦è§£å†³æ­¤é—®é¢˜ï¼Œæ‚¨å¯ä»¥å°†ç¯å¢ƒå˜é‡ <code>IN_PLACE_DEPLOYMENT</code> è®¾ç½®ä¸º 1ï¼Œå¹¶ä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/felixrieseberg/azure-npm3">è‡ªå®šä¹‰éƒ¨ç½²è„šæœ¬æ¥åˆ©ç”¨ NPM3</a> å’Œ flat æ¨¡å—å®‰è£…ã€‚</p><p>å¦‚æœä½¿ç”¨ Azure çš„å…è´¹ tierï¼Œè¿˜å¯ä»¥æ·»åŠ éƒ¨ç½²åæ­¥éª¤ï¼Œé€šè¿‡ä½¿ç”¨è¯¸å¦‚ <code>startup.sh</code> ä¹‹ç±»çš„è„šæœ¬ï¼ˆç›¸å¯¹äº src ç›®å½•ï¼‰è®¾ç½®ç¯å¢ƒå˜é‡ <code>POST_DEPLOYMENT_ACTION</code> æ¥åœ¨å¯åŠ¨æ—¶ ping æœåŠ¡å™¨ã€‚</p><p>å¯åŠ¨è„šæœ¬ç¤ºä¾‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let retrys=0</span><br><span class="line">while : ; do</span><br><span class="line">    STATUSCODE=$(curl --silent --output /dev/stderr --write-out &quot;%&#123;http_code&#125;&quot; https://$&#123;WEBSITE_SITE_NAME&#125;.azurewebsites.net/heroku/keepalive)</span><br><span class="line">    echo $STATUSCODE</span><br><span class="line">    [[ $retrys -ne 5 ]] || break</span><br><span class="line">    echo $retrys</span><br><span class="line">    ((retrys++))</span><br><span class="line">    [[ $STATUSCODE -ne 200 ]] || break</span><br><span class="line">done</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="followme"><span>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¶å®ƒå‘å¸ƒæ¸ é“</span><div class="social-list"><div class="social-item"><a target="_blank" class="social-link" href="/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-tags"><a href="/tags/hubot/" rel="tag"># hubot</a> <a href="/tags/chatops/" rel="tag"># chatops</a></div><div class="post-nav"><div class="post-nav-item"><a href="/leetcode-142/" rel="prev" title="ç¯å½¢é“¾è¡¨"><i class="fa fa-chevron-left"></i> ç¯å½¢é“¾è¡¨</a></div><div class="post-nav-item"></div></div></footer></article></div><div class="comments gitalk-container"></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">æ¸ICPå¤‡17015144å·</a></div><div class="copyright">&copy; 2018 â€“ <span itemprop="copyrightYear">2021</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">æ¨æ¬£é›¨</span></div></div></footer><script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script src="/js/third-party/search/local-search.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous"><script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"yangxyo","repo":"gitalk","client_id":"d132f60a332d75ac74e8","client_secret":"e1b396f1311291af51db16ed51308c275bc383e7","admin_user":"yangxyo","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js","integrity":"sha256-Pmj85ojLaPOWwRtlMJwmezB/Qg8BzvJp5eTzvXaYAfA="},"path_md5":"7e6e13a0b02d5bc3d23b7bcaa559faa3"}</script><script src="/js/third-party/comments/gitalk.js"></script></body></html>